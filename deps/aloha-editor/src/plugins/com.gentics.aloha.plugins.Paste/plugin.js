/*
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.PastePlugin=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.Paste");GENTICS.Aloha.PastePlugin.pasteHandlers=[];GENTICS.Aloha.PastePlugin.init=function(){var that=this;this.pasteDiv=jQuery('<div style="position:absolute; top:-100000px; left:-100000px"></div>');this.pasteDiv.attr("contentEditable","true");jQuery("body").append(this.pasteDiv);GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableCreated",function(event,editable){if(jQuery.browser.msie){editable.obj.bind("beforepaste",function(event){that.redirectPaste();event.stopPropagation()})}else{editable.obj.bind("paste",function(event){that.redirectPaste();window.setTimeout(function(){that.getPastedContent()},10);event.stopPropagation()})}});if(jQuery.browser.msie){this.pasteDiv.bind("paste",function(event){window.setTimeout(function(){that.getPastedContent()},10)})}};GENTICS.Aloha.PastePlugin.redirectPaste=function(){this.currentRange=new GENTICS.Utils.RangeObject(true);this.currentEditable=GENTICS.Aloha.activeEditable;var w=jQuery(window);this.scrollTop=w.scrollTop();this.scrollLeft=w.scrollLeft();this.height=jQuery(document).height();this.pasteDiv.text("");if(this.currentEditable){this.currentEditable.blur()}GENTICS.Utils.Dom.setCursorInto(this.pasteDiv.get(0));this.pasteDiv.focus()};GENTICS.Aloha.PastePlugin.getPastedContent=function(){var that=this;for(var i=0;i<this.pasteHandlers.length;++i){this.pasteHandlers[i].handlePaste(this.pasteDiv)}if(this.currentRange.deleteContents){this.currentRange.deleteContents()}if(this.currentRange&&this.currentEditable){var pasteDivContents=this.pasteDiv.contents();for(var i=pasteDivContents.length-1;i>=0;--i){that.pasteElement(pasteDivContents.get(i))}this.currentEditable.activate();this.currentEditable.obj.focus();if(pasteDivContents.length>0){GENTICS.Utils.Dom.setCursorAfter(pasteDivContents.get(pasteDivContents.length-1))}else{this.currentRange.select()}if(this.scrollTop!==false&&this.scrollLeft!==false&&this.height!==false){var w=jQuery(window);var heightDiff=jQuery(document).height()-this.height;w.scrollTop(this.scrollTop+heightDiff);w.scrollLeft(this.scrollLeft)}}this.currentRange=false;this.currentEditable=false;this.scrollTop=false;this.scollLeft=false;this.height=false;this.pasteDiv.text("")};GENTICS.Aloha.PastePlugin.pasteElement=function(object){var jqObject=jQuery(object);var that=this;if(!GENTICS.Utils.Dom.insertIntoDOM(jqObject,this.currentRange,this.currentEditable.obj,false)){var contents=jqObject.contents();if(GENTICS.Utils.Dom.isBlockLevelElement(object)||GENTICS.Utils.Dom.isListElement(object)){that.pasteElement(jQuery("<br/>").get(0))}for(var i=contents.length-1;i>=0;--i){that.pasteElement(contents[i])}}};GENTICS.Aloha.PastePlugin.register=function(pasteHandler){this.pasteHandlers.push(pasteHandler)};GENTICS.Aloha.PastePlugin.PasteHandler=function(){GENTICS.Aloha.PastePlugin.register(this)};GENTICS.Aloha.PastePlugin.PasteHandler.prototype.handlePaste=function(jqPasteDiv){};