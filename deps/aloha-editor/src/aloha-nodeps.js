/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
jQuery.fn.between=function(content,offset){if(this[0].nodeType!==3){if(offset>this.children().size()){offset=this.children().size()}if(offset<=0){this.prepend(content)}else{this.children().eq(offset-1).after(content)}}else{if(offset<=0){this.before(content)}else{if(offset>=this[0].length){this.after(content)}else{var fullText=this[0].data;this[0].data=fullText.substring(0,offset);this.after(fullText.substring(offset,fullText.length));this.after(content)}}}};jQuery.fn.removeCss=function(cssName){return this.each(function(){var oldstyle=jQuery(this).attr("style");var style=jQuery.grep(jQuery(this).attr("style").split(";"),function(curStyleAttr){var curStyleAttrName=curStyleAttr.split(":");if(curStyleAttrName[0]){if(curStyleAttrName[0].toUpperCase().trim().indexOf(cssName.toUpperCase())==-1){return curStyleAttr}}}).join(";").trim();jQuery(this).removeAttr("style");if(style.trim()){jQuery(this).attr("style",style)}return jQuery(this)})};jQuery.fn.contentEditable=function(b){var ce="contenteditable";if(jQuery.browser.msie&&parseInt(jQuery.browser.version)==7){ce="contentEditable"}if(b==undefined){return jQuery(this).attr(ce)}else{if(b===""){jQuery(this).removeAttr(ce)}else{if(b&&b!=="false"){b="true"}else{b="false"}jQuery(this).attr(ce,b)}}};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS=="undefined"||!GENTICS){var GENTICS={}}if(typeof GENTICS.Utils=="undefined"||!GENTICS){GENTICS.Utils={}}GENTICS.Utils.applyProperties=function(target,properties){var name;for(name in properties){if(properties.hasOwnProperty(name)){target[name]=properties[name]}}};GENTICS.Utils.uniqeString4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};GENTICS.Utils.guid=function(){var S4=GENTICS.Utils.uniqeString4;return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4())};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS=="undefined"||!GENTICS){var GENTICS={}}if(typeof GENTICS.Utils=="undefined"||!GENTICS){GENTICS.Utils={}}GENTICS.Utils.RangeObject=function(param){this.startContainer;this.startOffset;this.endContainer;this.endOffset;this.startParents=[];this.endParents=[];this.rangeTree=[];if(typeof param==="object"){if(param.startContainer!==undefined){this.startContainer=param.startContainer}if(param.startOffset!==undefined){this.startOffset=param.startOffset}if(param.endContainer!==undefined){this.endContainer=param.endContainer}if(param.endOffset!==undefined){this.endOffset=param.endOffset}}else{if(param===true){this.initializeFromUserSelection()}}};GENTICS.Utils.RangeObject.prototype.deleteContents=function(){var cac=jQuery(this.getCommonAncestorContainer());GENTICS.Utils.Dom.split(this,cac,false);GENTICS.Utils.Dom.split(this,cac,true);this.clearCaches();var rt=this.getRangeTree();for(var i=0;i<rt.length;i++){if(rt[i].type==="full"){jQuery(rt[i].domobj).remove()}}this.clearCaches();rt=this.getRangeTree();children=cac.children();if(children.length===0||(children.length===1&&children.get(0).nodeName==="BR")){this.commonAncestorContainer=this.startContainer=this.endContainer=cac.get(0);this.startOffset=0;this.endOffset=0}};GENTICS.Utils.RangeObject.prototype.log=function(message,obj){if(GENTICS&&GENTICS.Aloha&&GENTICS.Aloha.Log){GENTICS.Aloha.Log.debug(this,message);return false}if(console){console.log(message);if(obj){console.log(obj)}}};GENTICS.Utils.RangeObject.prototype.isCollapsed=function(){return(!this.endContainer||(this.startContainer===this.endContainer&&this.startOffset===this.endOffset))};GENTICS.Utils.RangeObject.prototype.getCommonAncestorContainer=function(){if(this.commonAncestorContainer){return this.commonAncestorContainer}this.updateCommonAncestorContainer();return this.commonAncestorContainer};GENTICS.Utils.RangeObject.prototype.getContainerParents=function(limit,fromEnd){var container=fromEnd?this.endContainer:this.startContainer;var parentStore=fromEnd?this.endParents:this.startParents;if(!container){return false}if(typeof limit=="undefined"){limit=jQuery("body")}if(!parentStore[limit.get(0)]){var parents;if(container.nodeType==3){parents=jQuery(container).parents()}else{parents=jQuery(container).parents();for(var i=parents.length;i>0;--i){parents[i]=parents[i-1]}parents[0]=container}var limitIndex=parents.index(limit);if(limitIndex>=0){parents=parents.slice(0,limitIndex)}parentStore[limit.get(0)]=parents}return parentStore[limit.get(0)]};GENTICS.Utils.RangeObject.prototype.getStartContainerParents=function(limit){return this.getContainerParents(limit,false)};GENTICS.Utils.RangeObject.prototype.getEndContainerParents=function(limit){return this.getContainerParents(limit,true)};GENTICS.Utils.RangeObject.prototype.updateCommonAncestorContainer=function(commonAncestorContainer){var parentsStartContainer=this.getStartContainerParents();var parentsEndContainer=this.getEndContainerParents();if(!commonAncestorContainer){if(!(parentsStartContainer.length>0&&parentsEndContainer.length>0)){GENTICS.Utils.RangeObject.prototype.log("could not find commonAncestorContainer");return false}for(var i=0;i<parentsStartContainer.length;i++){if(parentsEndContainer.index(parentsStartContainer[i])!=-1){this.commonAncestorContainer=parentsStartContainer[i];break}}}else{this.commonAncestorContainer=commonAncestorContainer}GENTICS.Utils.RangeObject.prototype.log(commonAncestorContainer?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully");return true};GENTICS.Utils.RangeObject.prototype.getCollapsedIERange=function(container,offset){var ieRange=document.body.createTextRange();var left=this.searchElementToLeft(container,offset);if(left.element){var tmpRange=document.body.createTextRange();tmpRange.moveToElementText(left.element);ieRange.setEndPoint("StartToEnd",tmpRange);if(left.characters!=0){ieRange.moveStart("character",left.characters)}else{ieRange.moveStart("character",1);ieRange.moveStart("character",-1)}}else{var right=this.searchElementToRight(container,offset);if(false&&right.element){var tmpRange=document.body.createTextRange();tmpRange.moveToElementText(right.element);ieRange.setEndPoint("StartToStart",tmpRange);if(right.characters!=0){ieRange.moveStart("character",-right.characters)}else{ieRange.moveStart("character",-1);ieRange.moveStart("character",1)}}else{var parent=container.nodeType==3?container.parentNode:container;var tmpRange=document.body.createTextRange();tmpRange.moveToElementText(parent);ieRange.setEndPoint("StartToStart",tmpRange);if(left.characters!=0){ieRange.moveStart("character",left.characters)}}}ieRange.collapse();return ieRange};GENTICS.Utils.RangeObject.prototype.select=document.createRange===undefined&&false?function(){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"Set selection to current range (IE version)")}if(this.startContainer.nodeType==3&&GENTICS.Utils.Dom.isBlockLevelElement(this.startContainer.nextSibling)){jQuery(this.startContainer).after("<br/>");if(this.endContainer===this.startContainer.parentNode&&GENTICS.Utils.Dom.getIndexInParent(this.startContainer)<this.endOffset){this.endOffset++}}var ieRange=document.body.createTextRange();var startRange=this.getCollapsedIERange(this.startContainer,this.startOffset);ieRange.setEndPoint("StartToStart",startRange);if(this.isCollapsed()){ieRange.collapse()}else{var endRange=this.getCollapsedIERange(this.endContainer,this.endOffset);ieRange.setEndPoint("EndToStart",endRange)}ieRange.select()}:function(){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"Set selection to current range (non IE version)")}var range=rangy.createRange();range.setStart(this.startContainer,this.startOffset);range.setEnd(this.endContainer,this.endOffset);var sel=rangy.getSelection();sel.setSingleRange(range)};GENTICS.Utils.RangeObject.prototype.searchElementToLeft=function(container,offset){var checkElement=undefined;var characters=0;if(container.nodeType==3){characters=offset;checkElement=container.previousSibling}else{if(offset>0){checkElement=container.childNodes[offset-1]}}while(checkElement&&checkElement.nodeType==3){characters+=checkElement.data.length;checkElement=checkElement.previousSibling}return{element:checkElement,characters:characters}};GENTICS.Utils.RangeObject.prototype.searchElementToRight=function(container,offset){var checkElement=undefined;var characters=0;if(container.nodeType==3){characters=container.data.length-offset;checkElement=container.nextSibling}else{if(offset<container.childNodes.length){checkElement=container.childNodes[offset]}}while(checkElement&&checkElement.nodeType==3){characters+=checkElement.data.length;checkElement=checkElement.nextSibling}return{element:checkElement,characters:characters}};GENTICS.Utils.RangeObject.prototype.update=function(event){GENTICS.Utils.RangeObject.prototype.log("==========");GENTICS.Utils.RangeObject.prototype.log("now updating rangeObject");this.initializeFromUserSelection(event);this.updateCommonAncestorContainer()};GENTICS.Utils.RangeObject.prototype.initializeFromUserSelection=function(event){var selection=rangy.getSelection();if(!selection){return false}if(selection.rangeCount==0){return false}var browserRange=selection.getRangeAt(0);if(!browserRange){return false}this.startContainer=browserRange.startContainer;this.endContainer=browserRange.endContainer;this.startOffset=browserRange.startOffset;this.endOffset=browserRange.endOffset;this.correctRange();return};GENTICS.Utils.RangeObject.prototype.correctRange=function(){this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType==1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType==3){this.startContainer=this.startContainer.childNodes[this.startOffset-1];this.startOffset=this.startContainer.data.length;this.endContainer=this.startContainer;this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType==1){var adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,true);if(adjacentTextNode){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=adjacentTextNode.data.length;return}adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,false);if(adjacentTextNode){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType==3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0;this.endContainer=this.startContainer;this.endOffset=0;return}}if(this.startContainer.nodeType==3&&this.startOffset==0){var adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer),true);if(adjacentTextNode){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=adjacentTextNode.data.length}}}else{if(this.startContainer.nodeType==1){if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType==3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0}else{if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType==1){var textNode=false;var checkedElement=this.startContainer.childNodes[this.startOffset];while(textNode===false&&checkedElement.childNodes&&checkedElement.childNodes.length>0){checkedElement=checkedElement.childNodes[0];if(checkedElement.nodeType==3){textNode=checkedElement}}if(textNode!==false){this.startContainer=textNode;this.startOffset=0}}}}if(this.startContainer.nodeType==3&&this.startOffset==this.startContainer.data.length){var adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer)+1,false);if(adjacentTextNode){this.startContainer=adjacentTextNode;this.startOffset=0}}if(this.endContainer.nodeType==3&&this.endOffset==0){if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType==3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else{if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType==1&&this.endContainer.parentNode){var parentNode=this.endContainer.parentNode;for(var offset=0;offset<parentNode.childNodes.length;++offset){if(parentNode.childNodes[offset]==this.endContainer){this.endOffset=offset;break}}this.endContainer=parentNode}}}if(this.endContainer.nodeType==1&&this.endOffset==0){if(this.endContainer.previousSibling){if(this.endContainer.previousSibling.nodeType==3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else{if(this.endContainer.previousSibling.nodeType==1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.childNodes.length}}}}if(this.endContainer.nodeType==1){if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType==3){this.endContainer=this.endContainer.childNodes[this.endOffset-1];this.endOffset=this.endContainer.data.length}else{if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType==1){var textNode=false;var checkedElement=this.endContainer.childNodes[this.endOffset-1];while(textNode===false&&checkedElement.childNodes&&checkedElement.childNodes.length>0){checkedElement=checkedElement.childNodes[checkedElement.childNodes.length-1];if(checkedElement.nodeType==3){textNode=checkedElement}}if(textNode!==false){this.endContainer=textNode;this.endOffset=this.endContainer.data.length}}}}}};GENTICS.Utils.RangeObject.prototype.clearCaches=function(){this.rangeTree=[];this.startParents=[];this.endParents=[];this.commonAncestorContainer=undefined};GENTICS.Utils.RangeObject.prototype.getRangeTree=function(root){if(typeof root=="undefined"){root=this.getCommonAncestorContainer()}if(this.rangeTree[root]){return this.rangeTree[root]}this.inselection=false;this.rangeTree[root]=this.recursiveGetRangeTree(root);return this.rangeTree[root]};GENTICS.Utils.RangeObject.prototype.recursiveGetRangeTree=function(currentObject){var jQueryCurrentObject=jQuery(currentObject);var childCount=0;var that=this;var currentElements=new Array();jQueryCurrentObject.contents().each(function(index){var type="none";var startOffset=false;var endOffset=false;var collapsedFound=false;if(that.isCollapsed()&&currentObject===that.startContainer&&that.startOffset==index){currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].type="collapsed";currentElements[childCount].domobj=undefined;that.inselection=false;collapsedFound=true;childCount++}if(!that.inselection&&!collapsedFound){switch(this.nodeType){case 3:if(this===that.startContainer){that.inselection=true;type=that.startOffset>0?"partial":"full";startOffset=that.startOffset;endOffset=this.length}break;case 1:if(this===that.startContainer&&that.startOffset==0){that.inselection=true;type="full"}if(currentObject===that.startContainer&&that.startOffset==index){that.inselection=true;type="full"}break}}if(that.inselection&&!collapsedFound){if(type=="none"){type="full"}switch(this.nodeType){case 3:if(this===that.endContainer){that.inselection=false;if(that.endOffset<this.length){type="partial"}if(startOffset===false){startOffset=0}endOffset=that.endOffset}break;case 1:if(this===that.endContainer&&that.endOffset==0){that.inselection=false}break}if(currentObject===that.endContainer&&that.endOffset<=index){that.inselection=false;type="none"}}currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].domobj=this;currentElements[childCount].type=type;if(type=="partial"){currentElements[childCount].startOffset=startOffset;currentElements[childCount].endOffset=endOffset}currentElements[childCount].children=that.recursiveGetRangeTree(this);if(currentElements[childCount].children.length>0){var noneFound=false;var partialFound=false;var fullFound=false;for(var i=0;i<currentElements[childCount].children.length;++i){switch(currentElements[childCount].children[i].type){case"none":noneFound=true;break;case"full":fullFound=true;break;case"partial":partialFound=true;break}}if(partialFound||(fullFound&&noneFound)){currentElements[childCount].type="partial"}else{if(fullFound&&!partialFound&&!noneFound){currentElements[childCount].type="full"}}}childCount++});if(this.isCollapsed()&&currentObject===this.startContainer&&this.startOffset==currentObject.childNodes.length){currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].type="collapsed";currentElements[childCount].domobj=undefined}return currentElements};GENTICS.Utils.RangeObject.prototype.findMarkup=function(comparator,limit,atEnd){var parents=this.getContainerParents(limit,atEnd);var returnValue=false;jQuery.each(parents,function(index,domObj){if(comparator.apply(domObj)){returnValue=domObj;return false}});return returnValue};GENTICS.Utils.RangeObject.prototype.getText=function(){if(this.isCollapsed()){return""}else{return this.recursiveGetText(this.getRangeTree())}};GENTICS.Utils.RangeObject.prototype.recursiveGetText=function(tree){if(!tree){return""}else{var that=this;var text="";jQuery.each(tree,function(){if(this.type=="full"){text+=jQuery(this.domobj).text()}else{if(this.type=="partial"&&this.domobj.nodeType==3){text+=jQuery(this.domobj).text().substring(this.startOffset,this.endOffset)}else{if(this.type=="partial"&&this.domobj.nodeType==1&&this.children){text+=that.recursiveGetText(this.children)}}}});return text}};GENTICS.Utils.RangeTree=function(){this.domobj=new Object();this.type;this.children=new Array()};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS=="undefined"||!GENTICS){var GENTICS={}}if(typeof GENTICS.Utils=="undefined"||!GENTICS){GENTICS.Utils={}}GENTICS.Utils.Position={};GENTICS.Utils.Position.w=jQuery(window);GENTICS.Utils.Position.Scroll={top:0,left:0,isScrolling:false};GENTICS.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:false,triggeredMouseStop:true};GENTICS.Utils.Position.mouseStopCallbacks=new Array();GENTICS.Utils.Position.mouseMoveCallbacks=new Array();GENTICS.Utils.Position.update=function(){var st=this.w.scrollTop();var sl=this.w.scrollLeft();if(this.Scroll.isScrolling){if(this.Scroll.top==st&&this.Scroll.left==sl){this.Scroll.isScrolling=false}}else{if(this.Scroll.top!=st||this.Scroll.left!=sl){this.Scroll.isScrolling=true}}this.Scroll.top=st;this.Scroll.left=sl;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=false;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=true;for(var i=0;i<this.mouseStopCallbacks.length;i++){this.mouseStopCallbacks[i].call()}}}else{this.Mouse.isMoving=true;this.Mouse.triggeredMouseStop=false;for(var i=0;i<this.mouseMoveCallbacks.length;i++){this.mouseMoveCallbacks[i].call()}}this.Mouse.oldX=this.Mouse.x;this.Mouse.oldY=this.Mouse.y};GENTICS.Utils.Position.addMouseStopCallback=function(callback){this.mouseStopCallbacks.push(callback);return(this.mouseStopCallbacks.length-1)};GENTICS.Utils.Position.addMouseMoveCallback=function(callback){this.mouseMoveCallbacks.push(callback);return(this.mouseMoveCallbacks.length-1)};jQuery(document).ready(function(){setInterval("GENTICS.Utils.Position.update()",500)});jQuery("html").mousemove(function(e){GENTICS.Utils.Position.Mouse.x=e.pageX;GENTICS.Utils.Position.Mouse.y=e.pageY});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS=="undefined"||!GENTICS){var GENTICS={}}if(typeof GENTICS.Utils=="undefined"||!GENTICS.Utils){GENTICS.Utils={}}if(typeof GENTICS.Utils.Dom=="undefined"||!GENTICS.Utils.Dom){GENTICS.Utils.Dom=function(){}}GENTICS.Utils.Dom.prototype.mergeableTags=["b","code","del","em","i","ins","strong","sub","sup","#text"];GENTICS.Utils.Dom.prototype.nonWordBoundaryTags=["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"];GENTICS.Utils.Dom.prototype.nonEmptyTags=["br"];GENTICS.Utils.Dom.prototype.tags={flow:["a","abbr","address","area","article","aside","audio","b","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","samp","script","section","select","small","span","strong","style","sub","sup","svg","table","textarea","time","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","var","video","wbr","#text"]};GENTICS.Utils.Dom.prototype.children={a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"flow",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",div:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",ul:"li","var":"phrasing",video:"source",wbr:"empty"};GENTICS.Utils.Dom.prototype.blockLevelElements=["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"];GENTICS.Utils.Dom.prototype.listElements=["li","ol","ul"];GENTICS.Utils.Dom.prototype.wordRegex=/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/;GENTICS.Utils.Dom.prototype.nonWordRegex=/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/;GENTICS.Utils.Dom.prototype.split=function(range,limit,atEnd){var splitElement=jQuery(range.startContainer);var splitPosition=range.startOffset;if(atEnd){splitElement=jQuery(range.endContainer);splitPosition=range.endOffset}if(limit.length<1){limit=jQuery(document.body)}var updateRange=(!range.isCollapsed()&&!atEnd);var path;var parents=splitElement.parents().get();parents.unshift(splitElement.get(0));jQuery.each(parents,function(index,element){var isLimit=limit.filter(function(){return this==element}).length;if(isLimit){if(index>0){path=parents.slice(0,index)}return false}});if(!path){return true}path=path.reverse();var newDom;var insertElement;for(var i=0;i<path.length;i++){var element=path[i];if(i===path.length-1){var secondPart;if(element.nodeType===3){secondPart=document.createTextNode(element.data.substring(splitPosition,element.data.length));element.data=element.data.substring(0,splitPosition)}else{var newElement=jQuery(element).clone(false).empty();var children=jQuery(element).contents();secondPart=newElement.append(children.slice(splitPosition,children.length)).get(0)}if(updateRange&&range.endContainer===element){range.endContainer=secondPart;range.endOffset-=splitPosition;range.clearCaches()}if(insertElement){insertElement.prepend(secondPart)}else{jQuery(element).after(secondPart)}}else{var newElement=jQuery(element).clone(false).empty();if(!newDom){newDom=newElement;insertElement=newElement}else{insertElement.prepend(newElement);insertElement=newElement}var next;while(next=path[i+1].nextSibling){insertElement.append(next)}if(updateRange&&range.endContainer===element){range.endContainer=newElement.get(0);var prev=path[i+1];var offset=0;while(prev=prev.previousSibling){offset++}range.endOffset-=offset;range.clearCaches()}}}jQuery(path[0]).after(newDom);return jQuery([path[0],newDom?newDom.get(0):secondPart])};GENTICS.Utils.Dom.prototype.allowsNesting=function(outerDOMObject,innerDOMObject){if(!outerDOMObject||!outerDOMObject.nodeName||!innerDOMObject||!innerDOMObject.nodeName){return false}var outerNodeName=outerDOMObject.nodeName.toLowerCase();var innerNodeName=innerDOMObject.nodeName.toLowerCase();if(!this.children[outerNodeName]){return false}if(this.children[outerNodeName]==innerNodeName){return true}if(jQuery.isArray(this.children[outerNodeName])&&jQuery.inArray(innerNodeName,this.children[outerNodeName])>=0){return true}if(jQuery.isArray(this.tags[this.children[outerNodeName]])&&jQuery.inArray(innerNodeName,this.tags[this.children[outerNodeName]])>=0){return true}return false};GENTICS.Utils.Dom.prototype.addMarkup=function(rangeObject,markup,nesting){if(rangeObject.startContainer.nodeType==3&&rangeObject.startOffset>0&&rangeObject.startOffset<rangeObject.startContainer.data.length){this.split(rangeObject,jQuery(rangeObject.startContainer).parent(),false)}if(rangeObject.endContainer.nodeType==3&&rangeObject.endOffset>0&&rangeObject.endOffset<rangeObject.endContainer.data.length){this.split(rangeObject,jQuery(rangeObject.endContainer).parent(),true)}var rangeTree=rangeObject.getRangeTree();this.recursiveAddMarkup(rangeTree,markup,rangeObject,nesting);this.doCleanup({merge:true,removeempty:true},rangeObject)};GENTICS.Utils.Dom.prototype.recursiveAddMarkup=function(rangeTree,markup,rangeObject,nesting){for(var i=0;i<rangeTree.length;++i){if(rangeTree[i].type=="full"&&this.allowsNesting(markup.get(0),rangeTree[i].domobj)){if((nesting||rangeTree[i].domobj.nodeName!=markup.get(0).nodeName)&&(rangeTree[i].domobj.nodeType!=3||jQuery.trim(rangeTree[i].domobj.data).length!=0)){jQuery(rangeTree[i].domobj).wrap(markup);if(!nesting&&rangeTree[i].domobj.nodeType!=3){var innerRange=new GENTICS.Utils.RangeObject();innerRange.startContainer=innerRange.endContainer=rangeTree[i].domobj.parentNode;innerRange.startOffset=0;innerRange.endOffset=innerRange.endContainer.childNodes.length;this.removeMarkup(innerRange,markup,jQuery(rangeTree[i].domobj.parentNode))}}}else{if(false){}else{if(nesting||rangeTree[i].domobj.nodeName!=markup.get(0).nodeName){if(rangeTree[i].children&&rangeTree[i].children.length>0){this.recursiveAddMarkup(rangeTree[i].children,markup)}}}}}};GENTICS.Utils.Dom.prototype.findHighestElement=function(start,nodeName,limit){var testObject=start;nodeName=nodeName.toLowerCase();var isLimit=limit?function(){return limit.filter(function(){return testObject==this}).length}:function(){return false};var highestObject=undefined;while(!isLimit()&&testObject){if(testObject.nodeName.toLowerCase()==nodeName){highestObject=testObject}testObject=testObject.parentNode}return highestObject};GENTICS.Utils.Dom.prototype.removeMarkup=function(rangeObject,markup,limit){var nodeName=markup.get(0).nodeName;var startSplitLimit=this.findHighestElement(rangeObject.startContainer,nodeName,limit);var endSplitLimit=this.findHighestElement(rangeObject.endContainer,nodeName,limit);var didSplit=false;if(startSplitLimit&&rangeObject.startOffset>0){this.split(rangeObject,jQuery(startSplitLimit).parent(),false);didSplit=true}if(endSplitLimit){if(rangeObject.endContainer.nodeType==3&&rangeObject.endOffset<rangeObject.endContainer.data.length){this.split(rangeObject,jQuery(endSplitLimit).parent(),true);didSplit=true}if(rangeObject.endContainer.nodeType==1&&rangeObject.endOffset<rangeObject.childNodes.length){this.split(rangeObject,jQuery(endSplitLimit).parent(),true);didSplit=true}}if(didSplit){rangeObject.correctRange()}var highestObject=this.findHighestElement(rangeObject.getCommonAncestorContainer(),nodeName,limit);var root=highestObject?highestObject.parentNode:undefined;var rangeTree=rangeObject.getRangeTree(root);this.recursiveRemoveMarkup(rangeTree,markup);this.doCleanup({merge:true,removeempty:true},rangeObject,root)};GENTICS.Utils.Dom.prototype.recursiveRemoveMarkup=function(rangeTree,markup){for(var i=0;i<rangeTree.length;++i){if(rangeTree[i].type=="full"&&rangeTree[i].domobj.nodeName==markup.get(0).nodeName){var content=jQuery(rangeTree[i].domobj).contents();if(content.length>0){content.first().unwrap()}else{jQuery(rangeTree[i].domobj).remove()}}if(rangeTree[i].children){this.recursiveRemoveMarkup(rangeTree[i].children,markup)}}};GENTICS.Utils.Dom.prototype.doCleanup=function(cleanup,rangeObject,start){var that=this;if(typeof cleanup=="undefined"){cleanup={merge:true,removeempty:true}}if(typeof start=="undefined"){if(rangeObject){start=rangeObject.getCommonAncestorContainer()}}var prevNode=false;var modifiedRange=false;var startObject=jQuery(start);startObject.contents().each(function(index){switch(this.nodeType){case 1:if(prevNode&&prevNode.nodeName==this.nodeName){if(rangeObject.startContainer===startObject&&rangeObject.startOffset>index){rangeObject.startOffset-=1;modifiedRange=true}if(rangeObject.endContainer===startObject&&rangeObject.endOffset>index){rangeObject.endOffset-=1;modifiedRange=true}jQuery(prevNode).append(jQuery(this).contents());modifiedRange|=that.doCleanup(cleanup,rangeObject,prevNode);jQuery(this).remove()}else{modifiedRange|=that.doCleanup(cleanup,rangeObject,this);var removed=false;if(cleanup.removeempty){if(GENTICS.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length==0){jQuery(this).remove();removed=true}if(jQuery.inArray(this.nodeName.toLowerCase(),that.mergeableTags)>=0&&jQuery(this).text().length==0&&this.childNodes.length==0){jQuery(this).remove();removed=true}}if(!removed){if(jQuery.inArray(this.nodeName.toLowerCase(),that.mergeableTags)>=0){prevNode=this}else{prevNode=false}}}break;case 3:if(prevNode&&prevNode.nodeType==3&&cleanup.merge){if(rangeObject.startContainer===this){rangeObject.startContainer=prevNode;rangeObject.startOffset+=prevNode.length;modifiedRange=true}if(rangeObject.endContainer===this){rangeObject.endContainer=prevNode;rangeObject.endOffset+=prevNode.length;modifiedRange=true}if(rangeObject.startContainer===startObject&&rangeObject.startOffset>index){rangeObject.startOffset-=1;modifiedRange=true}if(rangeObject.endContainer===startObject&&rangeObject.endOffset>index){rangeObject.endOffset-=1;modifiedRange=true}prevNode.data+=this.data;jQuery(this).remove()}else{prevNode=this}break}});if(cleanup.removeempty&&GENTICS.Utils.Dom.isBlockLevelElement(start)&&(!start.childNodes||start.childNodes.length==0)){if(rangeObject.startContainer==start){rangeObject.startContainer=start.parentNode;rangeObject.startOffset=GENTICS.Utils.Dom.getIndexInParent(start)}if(rangeObject.endContainer==start){rangeObject.endContainer=start.parentNode;rangeObject.endOffset=GENTICS.Utils.Dom.getIndexInParent(start)}startObject.remove();modifiedRange=true}if(modifiedRange){rangeObject.clearCaches()}return modifiedRange};GENTICS.Utils.Dom.prototype.getIndexInParent=function(node){if(!node){return false}var index=0;var check=node.previousSibling;while(check){index++;check=check.previousSibling}return index};GENTICS.Utils.Dom.prototype.isBlockLevelElement=function(node){if(!node){return false}if(node.nodeType==1&&jQuery.inArray(node.nodeName.toLowerCase(),this.blockLevelElements)>=0){return true}else{return false}};GENTICS.Utils.Dom.prototype.isLineBreakElement=function(node){if(!node){return false}return node.nodeType==1&&node.nodeName.toLowerCase()=="br"};GENTICS.Utils.Dom.prototype.isListElement=function(node){if(!node){return false}return node.nodeType==1&&jQuery.inArray(node.nodeName.toLowerCase(),this.listElements)>=0};GENTICS.Utils.Dom.prototype.isSplitObject=function(el){if(el.nodeType===1){switch(el.nodeName.toLowerCase()){case"p":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"li":return true}}return false};GENTICS.Utils.Dom.prototype.searchAdjacentTextNode=function(parent,index,searchleft,stopat){if(!parent||parent.nodeType!=1||index<0||index>parent.childNodes.length){return false}if(typeof stopat=="undefined"){stopat={blocklevel:true,list:true,linebreak:true}}if(stopat.blocklevel=="undefined"){stopal.blocklevel=true}if(stopat.list=="undefined"){stopal.list=true}if(stopat.linebreak=="undefined"){stopal.linebreak=true}if(typeof searchleft=="undefined"){searchleft=true}var nextNode=undefined;var currentParent=parent;if(searchleft&&index>0){nextNode=parent.childNodes[index-1]}if(!searchleft&&index<parent.childNodes.length){nextNode=parent.childNodes[index]}while(typeof currentParent!="undefined"){if(!nextNode){if(stopat.blocklevel&&this.isBlockLevelElement(currentParent)){return false}else{if(stopat.list&&this.isListElement(currentParent)){return false}else{nextNode=searchleft?currentParent.previousSibling:currentParent.nextSibling;currentParent=currentParent.parentNode}}}else{if(nextNode.nodeType==3&&jQuery.trim(nextNode.data).length>0){return nextNode}else{if(stopat.blocklevel&&this.isBlockLevelElement(nextNode)){return false}else{if(stopat.linebreak&&this.isLineBreakElement(nextNode)){return false}else{if(stopat.list&&this.isListElement(nextNode)){return false}else{if(nextNode.nodeType==3){nextNode=searchleft?nextNode.previousSibling:nextNode.nextSibling}else{currentParent=nextNode;nextNode=searchleft?nextNode.lastChild:nextNode.firstChild}}}}}}}};GENTICS.Utils.Dom.prototype.insertIntoDOM=function(object,range,limit,atEnd,force){var parentElements=range.getContainerParents(limit,atEnd);var that=this;var newParent;if(!limit){limit=jQuery(document.body)}if(parentElements.length==0){newParent=limit.get(0)}else{jQuery.each(parentElements,function(index,parent){if(that.allowsNesting(parent,object.get(0))){newParent=parent;return false}})}if(typeof newParent=="undefined"&&limit.length>0){newParent=limit.get(0)}if(!this.allowsNesting(newParent,object.get(0))&&!force){return false}if(typeof newParent!="undefined"){var splitParts=this.split(range,jQuery(newParent),atEnd);if(splitParts===true){var container=range.startContainer;var offset=range.startOffset;if(atEnd){container=range.endContainer;offset=range.endOffset}if(offset==0){var contents=jQuery(container).contents();if(contents.length>0){contents.eq(0).before(object)}else{jQuery(container).append(object)}return true}else{jQuery(container).contents().eq(offset-1).after(object);return true}}else{if(splitParts){splitParts.eq(0).after(object);return true}else{return false}}}else{return false}};GENTICS.Utils.Dom.prototype.removeFromDOM=function(object,range,preserveContent){if(preserveContent){var indexInParent=this.getIndexInParent(object);var numChildren=jQuery(object).contents().length;var parent=object.parentNode;if(range.startContainer==parent&&range.startOffset>indexInParent){range.startOffset+=numChildren-1}else{if(range.startContainer==object){range.startContainer=parent;range.startOffset=indexInParent+range.startOffset}}if(range.endContainer==parent&&range.endOffset>indexInParent){range.endOffset+=numChildren-1}else{if(range.endContainer==object){range.endContainer=parent;range.endOffset=indexInParent+range.endOffset}}jQuery(object).contents().unwrap();this.doCleanup({merge:true},range,parent)}else{}};GENTICS.Utils.Dom.prototype.extendToWord=function(range,fromBoundaries){var leftBoundary=this.searchWordBoundary(range.startContainer,range.startOffset,true);var rightBoundary=this.searchWordBoundary(range.endContainer,range.endOffset,false);if(!fromBoundaries){if(range.startContainer==leftBoundary.container&&range.startOffset==leftBoundary.offset){return}if(range.endContainer==rightBoundary.container&&range.endOffset==rightBoundary.offset){return}}range.startContainer=leftBoundary.container;range.startOffset=leftBoundary.offset;range.endContainer=rightBoundary.container;range.endOffset=rightBoundary.offset;range.correctRange();range.clearCaches()};GENTICS.Utils.Dom.prototype.isWordBoundaryElement=function(object){if(!object||!object.nodeName){return false}return jQuery.inArray(object.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1};GENTICS.Utils.Dom.prototype.searchWordBoundary=function(container,offset,searchleft){if(typeof searchleft=="undefined"){searchleft=true}var boundaryFound=false;while(!boundaryFound){if(container.nodeType==3){if(!searchleft){var wordBoundaryPos=container.data.substring(offset).search(this.nonWordRegex);if(wordBoundaryPos!=-1){offset=offset+wordBoundaryPos;boundaryFound=true}else{offset=this.getIndexInParent(container)+1;container=container.parentNode}}else{var wordBoundaryPos=container.data.substring(0,offset).search(this.nonWordRegex);var tempWordBoundaryPos=wordBoundaryPos;while(tempWordBoundaryPos!=-1){wordBoundaryPos=tempWordBoundaryPos;tempWordBoundaryPos=container.data.substring(wordBoundaryPos+1,offset).search(this.nonWordRegex);if(tempWordBoundaryPos!=-1){tempWordBoundaryPos=tempWordBoundaryPos+wordBoundaryPos+1}}if(wordBoundaryPos!=-1){offset=wordBoundaryPos+1;boundaryFound=true}else{offset=this.getIndexInParent(container);container=container.parentNode}}}else{if(container.nodeType==1){if(!searchleft){if(offset<container.childNodes.length){if(this.isWordBoundaryElement(container.childNodes[offset])){boundaryFound=true}else{container=container.childNodes[offset];offset=0}}else{if(this.isWordBoundaryElement(container)){boundaryFound=true}else{offset=this.getIndexInParent(container)+1;container=container.parentNode}}}else{if(offset>0){if(this.isWordBoundaryElement(container.childNodes[offset-1])){boundaryFound=true}else{container=container.childNodes[offset-1];offset=container.nodeType==3?container.data.length:container.childNodes.length}}else{if(this.isWordBoundaryElement(container)){boundaryFound=true}else{offset=this.getIndexInParent(container);container=container.parentNode}}}}}}if(container.nodeType!=3){var textNode=this.searchAdjacentTextNode(container,offset,!searchleft);if(textNode){container=textNode;offset=searchleft?0:container.data.length}}return{container:container,offset:offset}};GENTICS.Utils.Dom.prototype.isEmpty=function(domObject){if(!domObject){return true}if(jQuery.inArray(domObject.nodeName.toLowerCase(),this.nonEmptyTags)!=-1){return false}if(domObject.nodeType==3){return domObject.data.search(/\S/)==-1}for(var i=0;i<domObject.childNodes.length;++i){if(!this.isEmpty(domObject.childNodes[i])){return false}}return true};GENTICS.Utils.Dom.prototype.setCursorAfter=function(domObject){var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=domObject.parentNode;newRange.startOffset=newRange.endOffset=this.getIndexInParent(domObject);newRange.select()};GENTICS.Utils.Dom.prototype.setCursorInto=function(domObject){var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=domObject;newRange.startOffset=newRange.endOffset=0;newRange.select()};GENTICS.Utils.Dom=new GENTICS.Utils.Dom();
/*
*	Aloha Editor is free software: you can redistribute it and/or modify
*   it under the terms of the GNU Affero General Public License as published by
*   the Free Software Foundation, either version 3 of the License, or
*   (at your option) any later version.*

*   Aloha Editor is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*   GNU Affero General Public License for more details.

*   You should have received a copy of the GNU Affero General Public License
*   along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
Ext.data.AlohaProxy=function(){var api={};api[Ext.data.Api.actions.read]=true;Ext.data.AlohaProxy.superclass.constructor.call(this,{api:api});this.params={queryString:null,objectTypeFilter:null,filter:null,inFolderId:null,orderBy:null,maxItems:null,skipCount:null,renditionFilter:null,repositoryId:null}};Ext.extend(Ext.data.AlohaProxy,Ext.data.DataProxy,{doRequest:function(action,rs,params,reader,cb,scope,arg){var p=this.params;jQuery.extend(p,params);try{GENTICS.Aloha.RepositoryManager.query(p,function(items){var result=reader.readRecords(items);cb.call(scope,result,arg,true)})}catch(e){this.fireEvent("loadexception",this,null,arg,e);this.fireEvent("exception",this,"response",action,arg,null,e);return false}},setObjectTypeFilter:function(otFilter){this.params.objectTypeFilter=otFilter},getObjectTypeFilter:function(){return this.params.objectTypeFilter},setParams:function(p){jQuery.extend(this.params,p)}});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
Ext.data.AlohaObjectReader=function(meta,recordType){meta={};Ext.applyIf(meta,{idProperty:"id",root:"items",totalProperty:"results",fields:["id","url","name","type","weight","path","repositoryId"]});Ext.data.JsonReader.superclass.constructor.call(this,meta,meta.fields)};Ext.extend(Ext.data.AlohaObjectReader,Ext.data.JsonReader,{});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
Ext.tree.AlohaTreeLoader=function(config){Ext.apply(this,config);Ext.tree.AlohaTreeLoader.superclass.constructor.call(this)};Ext.extend(Ext.tree.AlohaTreeLoader,Ext.tree.TreeLoader,{paramOrder:["node","id"],nodeParameter:"id",directFn:function(node,id,callback){var params={inFolderId:node.id,objectTypeFilter:this.objectTypeFilter,repositoryId:node.repositoryId};GENTICS.Aloha.RepositoryManager.getChildren(params,function(items){var response={};response={status:true,scope:this,argument:{callback:callback,node:node}};if(typeof callback=="function"){callback(items,response)}})},createNode:function(node){if(node.name){node.text=node.name}if(node.hasMoreItems){node.leaf=!node.hasMoreItems}if(node.objectType){node.cls=node.objectType}return Ext.tree.TreeLoader.prototype.createNode.call(this,node)},objectTypeFilter:null,setObjectTypeFilter:function(otFilter){this.objectTypeFilter=otFilter},getObjectTypeFilter:function(){return this.objectTypeFilter}});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS=="undefined"||!GENTICS){var GENTICS={}}GENTICS.Aloha=function(){};GENTICS.Aloha.setAutobase=function(){var scriptTags=document.getElementsByTagName("script");var path=scriptTags[scriptTags.length-1].src.split("?")[0];path=path.split("/");var substitute=1;if("core"===path[path.length-2]){substitute=2}GENTICS.Aloha.prototype.autobase=path.slice(0,substitute*-1).join("/")+"/"};GENTICS.Aloha.setAutobase();GENTICS.Aloha.prototype.version="0.9.3";GENTICS.Aloha.prototype.editables=new Array();GENTICS.Aloha.prototype.activeEditable=null;GENTICS.Aloha.prototype.ready=false;GENTICS.Aloha.prototype.dictionaries={};GENTICS.Aloha.prototype.settings={};GENTICS.Aloha.prototype.OSName="Unknown";GENTICS.Aloha.prototype.readyCallbacks=new Array();GENTICS.Aloha.prototype.init=function(){if(jQuery.browser.webkit&&parseFloat(jQuery.browser.version)<532.5||jQuery.browser.mozilla&&parseFloat(jQuery.browser.version)<1.9||jQuery.browser.msie&&jQuery.browser.version<7||jQuery.browser.opera){alert("Sorry, your browser is not supported at the moment.");return}var that=this;jQuery("html").mousedown(function(){if(that.activeEditable&&!that.isMessageVisible()){that.activeEditable.blur();that.FloatingMenu.setScope("GENTICS.Aloha.empty");that.activeEditable=null}});if(typeof this.settings.base=="undefined"||!this.settings.base){this.settings.base=GENTICS.Aloha.autobase;if(typeof GENTICS_Aloha_base!="undefined"){this.settings.base=GENTICS_Aloha_base}}this.Log.init();if(!(this.settings.errorhandling==false)){window.onerror=function(msg,url,linenumber){GENTICS.Aloha.Log.error(GENTICS.Aloha,"Error message: "+msg+"\nURL: "+url+"\nLine Number: "+linenumber);return true}}if(navigator.appVersion.indexOf("Win")!=-1){this.OSName="Win"}if(navigator.appVersion.indexOf("Mac")!=-1){this.OSName="Mac"}if(navigator.appVersion.indexOf("X11")!=-1){this.OSName="Unix"}if(navigator.appVersion.indexOf("Linux")!=-1){this.OSName="Linux"}this.initI18n();this.PluginRegistry.init();this.RepositoryManager.init();this.Ribbon.init();this.FloatingMenu.init();Ext.MessageBox.buttonText.yes=GENTICS.Aloha.i18n(this,"yes");Ext.MessageBox.buttonText.no=GENTICS.Aloha.i18n(this,"no");Ext.MessageBox.buttonText.cancel=GENTICS.Aloha.i18n(this,"cancel");Ext.ux.AlohaAttributeField.prototype.listEmptyText=GENTICS.Aloha.i18n(GENTICS.Aloha,"repository.no_item_found");Ext.ux.AlohaAttributeField.prototype.loadingText=GENTICS.Aloha.i18n(GENTICS.Aloha,"repository.loading")+"...";this.ready=true;for(var i=0;i<this.editables.length;i++){if(!this.editables[i].ready){this.editables[i].init()}}GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("ready",GENTICS.Aloha,null))};GENTICS.Aloha.prototype.activateEditable=function(editable){for(var i=0;i<this.editables.length;i++){if(this.editables[i]!=editable&&this.editables[i].isActive){var oldActive=this.editables[i];this.editables[i].blur()}}this.activeEditable=editable};GENTICS.Aloha.prototype.getActiveEditable=function(){return this.activeEditable};GENTICS.Aloha.prototype.deactivateEditable=function(){if(typeof this.activeEditable=="undefined"||this.activeEditable==null){return}this.activeEditable.blur();this.FloatingMenu.setScope("GENTICS.Aloha.empty");this.activeEditable=null};GENTICS.Aloha.prototype.getEditableById=function(id){if(jQuery("#"+id).get(0).nodeName.toLowerCase()=="textarea"){id=id+"-aloha"}for(var i=0;i<GENTICS.Aloha.editables.length;i++){if(GENTICS.Aloha.editables[i].getId()==id){return GENTICS.Aloha.editables[i]}}return null};GENTICS.Aloha.prototype.isEditable=function(obj){for(var i=0;i<this.editables.length;i++){if(this.editables[i].originalObj.get(0)===obj){return true}}return false};GENTICS.Aloha.prototype.log=function(level,component,message){GENTICS.Aloha.Log.log(level,component,message)};GENTICS.Aloha.prototype.identStr=function(object){if(object instanceof jQuery){object=object[0]}if(!(object instanceof HTMLElement)){GENTICS.Aloha.Log.warn(this,"{"+object.toString()+"} provided is not an HTML element");return object.toString()}var out=object.tagName.toLowerCase();if(object.id){return out+"#"+object.id}if(object.className){return out+"."+object.className}return out};GENTICS.Aloha.prototype.trim=function(str){str=str.replace(/^\s+/,"");for(var i=str.length-1;i>=0;i--){if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break}}return str};GENTICS.Aloha.prototype.initI18n=function(){if(typeof this.settings.i18n=="undefined"||!this.settings.i18n){this.settings.i18n={}}if(typeof this.settings.i18n.available=="undefined"||!this.settings.i18n.available||!this.settings.i18n.available instanceof Array){this.settings.i18n.available=["en","de","fr","eo","fi","ru","it","pl"]}if((typeof this.settings.i18n.current=="undefined"||!this.settings.i18n.current)&&typeof this.settings.i18n.acceptLanguage=="string"){var acceptLanguage=[];var preferredLanugage=this.settings.i18n.acceptLanguage.split(",");for(i=0;i<preferredLanugage.length;i++){var lang=preferredLanugage[i].split(";");if(typeof lang[1]=="undefined"||!lang[1]){lang[1]=1}else{lang[1]=parseFloat(lang[1].substring(2,lang[1].length))}acceptLanguage.push(lang)}acceptLanguage.sort(function(a,b){return b[1]-a[1]});for(i=0;i<acceptLanguage.length;i++){if(jQuery.inArray(acceptLanguage[i][0],this.settings.i18n.available)>=0){this.settings.i18n.current=acceptLanguage[i][0];break}}}if(typeof this.settings.i18n.current=="undefined"||!this.settings.i18n.current){this.settings.i18n.current=(navigator.language?navigator.language:navigator.userLanguage)}var actualLanguage=this.getLanguage(this.settings.i18n.current,this.settings.i18n.available);if(!actualLanguage){GENTICS.Aloha.Log.error(this,"Could not determine actual language.")}else{var fileUrl=this.settings.base+"i18n/"+actualLanguage+".dict";this.loadI18nFile(fileUrl,this)}};GENTICS.Aloha.prototype.getLanguage=function(language,availableLanguages){if(!availableLanguages instanceof Array){GENTICS.Aloha.Log.error(this,"Available languages must be an Array");return null}if(typeof language=="undefined"||!language){return availableLanguages[0]}for(var i=0;i<availableLanguages.length;++i){if(language==availableLanguages[i]){return language}}return availableLanguages[0]};GENTICS.Aloha.prototype.loadI18nFile=function(fileUrl,component){jQuery.ajax({async:false,datatype:"text",url:fileUrl,error:function(request,textStatus,error){GENTICS.Aloha.Log.error(component,"Error while getting dictionary file "+fileUrl+": server returned "+textStatus)},success:function(data,textStatus,request){if(GENTICS.Aloha.Log.isInfoEnabled()){GENTICS.Aloha.Log.info(component,"Loaded dictionary file "+fileUrl)}GENTICS.Aloha.parseI18nFile(data,component)}})};GENTICS.Aloha.prototype.parseI18nFile=function(data,component){data=data.replace(/\r/g,"");var entries=data.split("\n");var dictionary=this.dictionaries[component.toString()]||new Object();for(var i=0;i<entries.length;++i){var entry=entries[i];var equal=entry.indexOf("=");if(equal>0){var key=GENTICS.Aloha.trim(entry.substring(0,equal));var value=GENTICS.Aloha.trim(entry.substring(equal+1,entry.length));value=value.replace(/\\n/g,"\n");value=value.replace(/\\\\/g,"\\");if(dictionary[key]){GENTICS.Aloha.Log.warn(component,"Found duplicate key "+key+" in dictionary file, ignoring")}else{dictionary[key]=value}}}this.dictionaries[component.toString()]=dictionary};GENTICS.Aloha.prototype.i18n=function(component,key,replacements){var value=null;if(this.dictionaries[component.toString()]){if(this.dictionaries[component.toString()][key]){value=this.dictionaries[component.toString()][key]}}if(!value&&component!=GENTICS.Aloha){if(this.dictionaries[GENTICS.Aloha.toString()]){if(this.dictionaries[GENTICS.Aloha.toString()][key]){value=this.dictionaries[GENTICS.Aloha.toString()][key]}}}if(!value){return"??? "+key+" ???"}else{if(typeof replacements!="undefined"&&replacements!=null){for(var i=0;i<replacements.length;++i){if(typeof replacements[i]!="undefined"&&replacements[i]!=null){var regEx=new RegExp("\\{"+(i)+"\\}","g");var safeArgument=replacements[i].toString().replace(/\{/g,"\\{");safeArgument=safeArgument.replace(/\}/g,"\\}");value=value.replace(regEx,safeArgument)}}}value=value.replace(/\{\d\}/g,"");value=value.replace(/\\\{/g,"{");value=value.replace(/\\\}/g,"}");return value}};GENTICS.Aloha.prototype.registerEditable=function(editable){this.editables.push(editable)};GENTICS.Aloha.prototype.unregisterEditable=function(editable){var id=this.editables.indexOf(editable);if(id!=-1){this.editables.splice(id,1)}};GENTICS.Aloha.prototype.showMessage=function(message){if(GENTICS.Aloha.FloatingMenu.obj){GENTICS.Aloha.FloatingMenu.obj.css("z-index",8900)}switch(message.type){case GENTICS.Aloha.Message.Type.ALERT:Ext.MessageBox.alert(message.title,message.text,message.callback);break;case GENTICS.Aloha.Message.Type.CONFIRM:Ext.MessageBox.confirm(message.title,message.text,message.callback);break;case GENTICS.Aloha.Message.Type.WAIT:Ext.MessageBox.wait(message.text,message.title);break;default:this.log("warn",this,"Unknown message type for message {"+message.toString()+"}");break}};GENTICS.Aloha.prototype.hideMessage=function(){Ext.MessageBox.hide()};GENTICS.Aloha.prototype.isMessageVisible=function(){return Ext.MessageBox.isVisible()};GENTICS.Aloha.prototype.toString=function(){return"GENTICS.Aloha"};GENTICS.Aloha.prototype.isModified=function(){for(var i in this.editables){if(this.editables[i].isModified){if(this.editables[i].isModified()){return true}}}return false};GENTICS.Aloha=new GENTICS.Aloha();if(!Array.indexOf){Array.prototype.indexOf=function(obj){for(var i=0;i<this.length;i++){if(this[i]===obj){return i}}return -1}}jQuery.isAloha=true;jQuery(document).ready(function(){if(!jQuery.isAloha&&window.console&&console.error){console.error("Aloha ERROR: jQuery was included at least a second time after loading Aloha. This will cause serious problems. You must not load other versions of jQuery with Aloha.")}if(Ext.isReady){GENTICS.Aloha.init()}else{Ext.onReady(function(){GENTICS.Aloha.init()})}});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
if(typeof GENTICS.Aloha.ui=="undefined"){GENTICS.Aloha.ui=function(){}}Ext.ux.GENTICSMenu=Ext.extend(Ext.menu.Menu,{onRender:function(){Ext.ux.GENTICSMenu.superclass.onRender.apply(this,arguments);jQuery(this.el.dom).mousedown(function(e){e.stopPropagation()})}});GENTICS.Aloha.ui.Button=function(properties){this.init(properties)};GENTICS.Aloha.ui.Button.prototype.init=function(properties){this.label;this.iconClass;this.icon;this.onclick;this.menu;this.toggle;this.pressed=false;this.visible=true;this.enabled=true;this.tooltip;this.extButton;this.listenerQueue=[];GENTICS.Utils.applyProperties(this,properties);this.id=this.generateId()};GENTICS.Aloha.ui.Button.idCounter=0;GENTICS.Aloha.ui.Button.prototype.generateId=function(){GENTICS.Aloha.ui.Button.idCounter=GENTICS.Aloha.ui.Button.idCounter+1;return"GENTICS_Aloha_ui_Button_"+GENTICS.Aloha.ui.Button.idCounter};GENTICS.Aloha.ui.Button.prototype.setPressed=function(pressed){if(this.toggle){this.pressed=pressed;if(typeof this.extButton=="object"&&this.extButton.pressed!=pressed){this.extButton.toggle(this.pressed)}}};GENTICS.Aloha.ui.Button.prototype.isPressed=function(){if(this.toggle){return this.pressed}else{return false}};GENTICS.Aloha.ui.Button.prototype.show=function(){this.visible=true};GENTICS.Aloha.ui.Button.prototype.hide=function(){this.visible=false};GENTICS.Aloha.ui.Button.prototype.isVisible=function(){return this.visible};GENTICS.Aloha.ui.Button.prototype.enable=function(){this.enabled=true;if(typeof this.extButton=="object"){this.extButton.enable()}};GENTICS.Aloha.ui.Button.prototype.disable=function(){this.enabled=false;if(typeof this.extButton=="object"){this.extButton.disable()}};GENTICS.Aloha.ui.Button.prototype.isEnabled=function(){return this.enabled};GENTICS.Aloha.ui.Button.prototype.getExtMenu=function(){if(typeof this.menu==="object"){var menu=new Ext.ux.GENTICSMenu();for(var i=0;i<this.menu.length;++i){var entry=this.menu[i];menu.addItem(new Ext.menu.Item(entry.getExtMenuConfigProperties()))}}return menu};GENTICS.Aloha.ui.Button.prototype.getExtMenuConfigProperties=function(){var that=this;var submenu=this.getExtMenu();return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){if(typeof that.onclick=="function"){that.onclick()}},menu:submenu}};GENTICS.Aloha.ui.Button.prototype.getExtConfigProperties=function(){var that=this;var menu=this.getExtMenu();var buttonConfig={text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||((this.size=="large"||this.size=="medium")?2:1),menu:menu,handler:function(element,event){if(typeof that.onclick==="function"){that.onclick.apply(that,[element,event])}that.pressed=!that.pressed},xtype:(menu&&typeof this.onclick=="function")?"splitbutton":"button",tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")};return buttonConfig};Ext.ux.GENTICSMultiSplitButton=Ext.extend(Ext.Component,{autoEl:{cls:"GENTICS_multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:false,onRender:function(){Ext.ux.GENTICSMultiSplitButton.superclass.onRender.apply(this,arguments);this.wrapper=jQuery(this.el.dom);var item;var html='<ul class="GENTICS_multisplit">';for(var i=0;i<this.items.length;i++){item=this.items[i];if(item.visible==undefined){item.visible=true}if(item.wide){continue}html+='<li><button xmlns:ext="http://www.extjs.com/" class="'+item.iconClass+'" ext:qtip="'+item.tooltip+'" gtxmultisplititem="'+i+'">&#160;</button></li>'}for(var i=0;i<this.items.length;i++){item=this.items[i];if(!item.wide){continue}html+='<li><button xmlns:ext="http://www.extjs.com/" class="GENTICS_multisplit-wide '+item.iconClass+'" ext:qtip="'+item.tooltip+'" gtxmultisplititem="'+i+'">'+item.text+"</button></li>"}html+="</ul>";var that=this;GENTICS.Aloha.FloatingMenu.extTabPanel.on("move",function(){that.closePanel()});GENTICS.Aloha.FloatingMenu.extTabPanel.on("tabchange",function(){that.closePanel()});this.ulObj=jQuery(this.el.createChild(html).dom);this.ulObj.click(function(event){that.onClick(event)});this.panelButton=jQuery(this.el.createChild('<button class="GENTICS_multisplit_toggle GENTICS_multisplit_toggle_open">&#160;</button>').dom);this.panelButton.click(function(){that.togglePanel()})},onClick:function(event){if(!event.target.attributes.gtxmultisplititem){return}var el=jQuery(event.target);this.closePanel();if(!el.hasClass("GENTICS_multisplit-wide")){this.setActiveDOMElement(el)}this.items[event.target.attributes.gtxmultisplititem.value].click()},setActiveItem:function(name){this.closePanel();if(this.activeItem==name){return}for(var i=0;i<this.items.length;i++){if(this.items[i].name==name){var button=jQuery(this.ulObj).find("[gtxmultisplititem="+i+"]");this.setActiveDOMElement(button);this.activeItem=name;return}}this.activeItem=null;this.setActiveDOMElement(null)},setActiveDOMElement:function(el){var ct=this;while(typeof ct!="undefined"){if(ct.hidden){this.activeDOMElement=el;return}ct=ct.ownerCt}jQuery(this.ulObj).find(".GENTICS_multisplit-activeitem").removeClass("GENTICS_multisplit-activeitem");if(el){el.addClass("GENTICS_multisplit-activeitem")}if(el==null||el.parent().is(":hidden")){return}if(el&&this.ulObj){this.ulObj.css("margin-top",0);var top=el.position().top;this.ulObj.css("margin-top",-top+6);this.ulObj.css("height",46+top-6)}this.activeDOMElement=undefined},togglePanel:function(){if(this.panelOpened){this.closePanel()}else{this.openPanel()}},openPanel:function(){if(this.panelOpened){return}this.ulObj.appendTo(jQuery(document.body));this.ulObj.addClass("GENTICS_multisplit-expanded");this.ulObj.mousedown(function(e){e.stopPropagation()});var o=this.wrapper.offset();this.ulObj.css("top",o.top-1);this.ulObj.css("left",o.left-1);this.ulObj.animate({height:this.ulObj.attr("scrollHeight")});this.panelButton.removeClass("GENTICS_multisplit_toggle_open");this.panelButton.addClass("GENTICS_multisplit_toggle_close");this.panelOpened=true},closePanel:function(){if(!this.panelOpened){return}this.ulObj.removeClass("GENTICS_multisplit-expanded");this.ulObj.appendTo(this.wrapper);this.panelButton.addClass("GENTICS_multisplit_toggle_open");this.panelButton.removeClass("GENTICS_multisplit_toggle_close");this.panelOpened=false},hideItem:function(name){for(var i=0;i<this.items.length;i++){if(this.items[i].name==name){this.items[i].visible=false;jQuery("#"+this.id+" [gtxmultisplititem="+i+"]").parent().hide();return}}},showItem:function(name){for(var i=0;i<this.items.length;i++){if(this.items[i].name==name){this.items[i].visible=true;jQuery("#"+this.id+" [gtxmultisplititem="+i+"]").parent().show();return}}}});Ext.reg("genticsmultisplitbutton",Ext.ux.GENTICSMultiSplitButton);GENTICS.Aloha.ui.MultiSplitButton=function(properties){this.items;GENTICS.Utils.applyProperties(this,properties);this.id=this.generateId()};GENTICS.Aloha.ui.MultiSplitButton.idCounter=0;GENTICS.Aloha.ui.MultiSplitButton.prototype.generateId=function(){GENTICS.Aloha.ui.MultiSplitButton.idCounter=GENTICS.Aloha.ui.MultiSplitButton.idCounter+1;return"GENTICS_Aloha_ui_MultiSplitButton_"+GENTICS.Aloha.ui.MultiSplitButton.idCounter};GENTICS.Aloha.ui.MultiSplitButton.prototype.getExtConfigProperties=function(){return{xtype:"genticsmultisplitbutton",items:this.items,id:this.id}};GENTICS.Aloha.ui.MultiSplitButton.prototype.setActiveItem=function(name){if(this.extButton){this.extButton.setActiveItem(name)}};GENTICS.Aloha.ui.MultiSplitButton.prototype.isVisible=function(){for(var i=0;i<this.items.length;i++){if(this.items[i].visible){return true}}return false};GENTICS.Aloha.ui.MultiSplitButton.prototype.showItem=function(name){this.extButton.showItem(name)};GENTICS.Aloha.ui.MultiSplitButton.prototype.hideItem=function(name){this.extButton.hideItem(name)};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
Ext.ux.AlohaAttributeField=Ext.extend(Ext.form.ComboBox,{typeAhead:false,mode:"remote",triggerAction:"all",width:300,hideTrigger:true,minChars:3,valueField:"id",displayField:"name",enableKeyEvents:true,store:new Ext.data.Store({proxy:new Ext.data.AlohaProxy(),reader:new Ext.data.AlohaObjectReader()}),clickAttached:false,tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">','<tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl>','<tpl if="!this.hasRepositoryTemplate(values)"><span><b>{name}</b></span></tpl>',"</div></tpl>",{hasRepositoryTemplate:function(values){var rep=GENTICS.Aloha.RepositoryManager.getRepository(values.repositoryId);return rep&&rep.hasTemplate()},renderRepositoryTemplate:function(values){var rep=GENTICS.Aloha.RepositoryManager.getRepository(values.repositoryId);if(rep&&rep.hasTemplate()){return rep.getTemplate().apply(values)}}}),onSelect:function(item){this.setItem(item.data);if(typeof this.alohaButton.onSelect=="function"){this.alohaButton.onSelect.call(this.alohaButton,item.data)}this.collapse()},listeners:{beforequery:function(event){if(this.noQuery){event.cancel=true;return}if(this.store!=null&&this.store.proxy!=null){this.store.proxy.setParams({objectTypeFilter:this.getObjectTypeFilter(),queryString:event.query})}},afterrender:function(obj,event){var that=this;jQuery(this.wrap.dom.children[0]).blur(function(e){that.triggerBlur()})},keydown:function(obj,event){this.resourceItem=null;if(event.keyCode==13||event.keyCode==27){if(this.isExpanded()){this.ALOHAwasExpanded=true}else{this.ALOHAwasExpanded=false}}},keyup:function(obj,event){if((event.keyCode==13||event.keyCode==27)&&!this.ALOHAwasExpanded){setTimeout(function(){GENTICS.Aloha.activeEditable.obj[0].focus();GENTICS.Aloha.Selection.getRangeObject().select()},0)}if(!this.resourceItem){var v=this.wrap.dom.children[0].value;this.setAttribute(this.targetAttribute,v)}},focus:function(obj,event){var target=jQuery(this.getTargetObject());var s=target.css("background-color");if(target&&target.context.style&&target.context.style["background-color"]){target.attr("data-original-background-color",target.context.style["background-color"])}target.css("background-color","Highlight")},blur:function(obj,event){var target=jQuery(this.getTargetObject());if(target){if(color=target.attr("data-original-background-color")){jQuery(target).css("background-color",color)}else{jQuery(target).removeCss("background-color")}jQuery(target).removeAttr("data-original-background-color")}},expand:function(combo){if(this.noQuery){this.collapse()}if(!this.clickAttached){var that=this;this.mon(this.innerList,"mousedown",function(event){this.onViewClick(true);event.stopEvent()},this);this.clickAttached=true}}},setItem:function(item,displayField){this.resourceItem=item;if(item){displayField=(displayField)?displayField:this.displayField;var v=item[displayField];this.setValue(v);this.setAttribute(this.targetAttribute,item[this.valueField]);GENTICS.Aloha.RepositoryManager.markObject(this.targetObject,item)}},getItem:function(){return this.resourceItem},setAttribute:function(attr,value,regex,reference){if(this.targetObject){var setAttr=true;if(typeof reference!="undefined"){var regxp=new RegExp(regex);if(!reference.match(regxp)){setAttr=false}}if(setAttr){jQuery(this.targetObject).attr(attr,value)}else{jQuery(this.targetObject).removeAttr(attr)}}},setTargetObject:function(obj,attr){this.targetObject=obj;this.targetAttribute=attr;if(this.targetObject&&this.targetAttribute){this.setValue(jQuery(this.targetObject).attr(this.targetAttribute))}else{this.setValue("")}var that=this;GENTICS.Aloha.RepositoryManager.getObject(obj,function(items){if(items&&items.length>0){that.setItem(items[0])}})},getTargetObject:function(){return this.targetObject},setObjectTypeFilter:function(otFilter){this.objectTypeFilter=otFilter},getObjectTypeFilter:function(){return this.objectTypeFilter},noQuery:true});Ext.reg("alohaattributefield",Ext.ux.AlohaAttributeField);GENTICS.Aloha.ui.AttributeField=function(properties){this.onSelect=null;this.listenerQueue=[];this.objectTypeFilter=null;this.tpl=null;this.displayField=null;this.valueField=null;this.init(properties)};GENTICS.Aloha.ui.AttributeField.prototype=new GENTICS.Aloha.ui.Button();GENTICS.Aloha.ui.AttributeField.prototype.getExtConfigProperties=function(){var props={alohaButton:this,xtype:"alohaattributefield",rowspan:this.rowspan||undefined,width:this.width||undefined,id:this.id};if(this.valueField){props.valueField=this.valueField}if(this.displayField){props.displayField=this.displayField}return props};GENTICS.Aloha.ui.AttributeField.prototype.setTargetObject=function(obj,attr){if(this.extButton){this.extButton.setTargetObject(obj,attr)}};GENTICS.Aloha.ui.AttributeField.prototype.getTargetObject=function(){if(this.extButton){return this.extButton.getTargetObject()}else{return null}};GENTICS.Aloha.ui.AttributeField.prototype.focus=function(){if(this.extButton){this.extButton.focus();if(this.extButton.getValue().length>0){this.extButton.selectText(0,this.extButton.getValue().length)}}};GENTICS.Aloha.ui.AttributeField.prototype.addListener=function(eventName,handler,scope){if(this.extButton){this.extButton.addListener(eventName,handler,null)}else{listener={eventName:eventName,handler:handler,scope:scope,options:null};this.listenerQueue.push(listener)}};GENTICS.Aloha.ui.AttributeField.prototype.setAttribute=function(attr,value,regex,reference){if(this.extButton){this.extButton.setAttribute(attr,value,regex,reference)}};GENTICS.Aloha.ui.AttributeField.prototype.setObjectTypeFilter=function(objectTypeFilter){if(this.extButton){this.noQuery=false;this.extButton.setObjectType(objectTypeFilter)}else{if(!objectTypeFilter){objectTypeFilter="all"}this.objectTypeFilter=objectTypeFilter}};GENTICS.Aloha.ui.AttributeField.prototype.setItem=function(item,displayField){if(this.extButton){this.extButton.setItem(item,displayField)}};GENTICS.Aloha.ui.AttributeField.prototype.getItem=function(){if(this.extButton){return this.extButton.getItem()}return null};GENTICS.Aloha.ui.AttributeField.prototype.getValue=function(){if(this.extButton){return this.extButton.getValue()}return null};GENTICS.Aloha.ui.AttributeField.prototype.setValue=function(v){if(this.extButton){this.extButton.setValue(v)}};GENTICS.Aloha.ui.AttributeField.prototype.getQueryValue=function(){if(this.extButton){return this.extButton.wrap.dom.children[0].value}return null};GENTICS.Aloha.ui.AttributeField.prototype.setDisplayField=function(displayField){if(this.extButton){return this.extButton.displayField=displayField}else{return this.displayField=displayField}return null};GENTICS.Aloha.ui.AttributeField.prototype.setTemplate=function(tpl){var template=new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">','<tpl if="this.hasRepositoryTemplate(values)">{[ this.renderRepositoryTemplate(values) ]}</tpl>','<tpl if="!this.hasRepositoryTemplate(values)">'+tpl+"</tpl>","</div></tpl>",{hasRepositoryTemplate:function(values){var rep=GENTICS.Aloha.RepositoryManager.getRepository(values.repositoryId);return rep&&rep.hasTemplate()},renderRepositoryTemplate:function(values){var rep=GENTICS.Aloha.RepositoryManager.getRepository(values.repositoryId);if(rep&&rep.hasTemplate()){return rep.getTemplate().apply(values)}}});if(this.extButton){return this.extButton.tpl=template}else{return this.tpl=template}};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.ui.Browser=function(){this.onSelect=null;var that=this;this.grid=new Ext.grid.GridPanel({region:"center",autoScroll:true,store:new Ext.data.Store({proxy:new Ext.data.AlohaProxy(),reader:new Ext.data.AlohaObjectReader()}),columns:[{id:"name",header:"Name",width:100,sortable:true,dataIndex:"name"},{header:"URL",renderer:function(val){return val},width:300,sortable:true,dataIndex:"url"}],stripeRows:true,autoExpandColumn:"name",height:350,width:600,title:"Objectlist",stateful:true,stateId:"grid",selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),listeners:{dblclick:function(e){that.onItemSelect()}}});this.grid.getSelectionModel().on({selectionchange:function(sm,n,node){var resourceItem=that.grid.getSelectionModel().getSelected();if(resourceItem){this.win.buttons[1].enable()}else{this.win.buttons[1].disable()}},scope:this});this.tree=new Ext.tree.TreePanel({region:"center",useArrows:true,autoScroll:true,animate:true,enableDD:true,containerScroll:true,border:false,loader:new Ext.tree.AlohaTreeLoader(),root:{nodeType:"async",text:"Aloha Repositories",draggable:false,id:"aloha"},rootVisible:false,listeners:{beforeload:function(node){this.loader.baseParams={node:node.attributes}}}});this.tree.getSelectionModel().on({selectionchange:function(sm,node){if(node){var resourceItem=node.attributes;that.grid.store.load({params:{inFolderId:resourceItem.id,objectTypeFilter:that.objectTypeFilter,repositoryId:resourceItem.repositoryId}})}},scope:this});this.nav=new Ext.Panel({title:"Navigation",region:"west",width:300,layout:"fit",collapsible:true,items:[this.tree]});this.win=new Ext.Window({title:"Resource Selector",layout:"border",width:800,height:300,closeAction:"hide",onEsc:function(){this.hide()},defaultButton:this.nav,plain:true,initHidden:true,items:[this.nav,this.grid],buttons:[{text:"Close",handler:function(){that.win.hide()}},{text:"Select",disabled:true,handler:function(){that.onItemSelect()}}],toFront:function(e){this.manager=this.manager||Ext.WindowMgr;this.manager.bringToFront(this);this.setZIndex(9999999999);return this}});this.onItemSelect=function(){var sm=this.grid.getSelectionModel();var sel=(sm)?sm.getSelected():null;var resourceItem=(sel)?sel.data:null;this.win.hide();if(typeof this.onSelect=="function"){this.onSelect.call(this,resourceItem)}}};GENTICS.Aloha.ui.Browser.prototype.setObjectTypeFilter=function(otf){this.objectTypeFilter=otf};GENTICS.Aloha.ui.Browser.prototype.getObjectTypeFilter=function(){return this.objectTypeFilter};GENTICS.Aloha.ui.Browser.prototype.show=function(){this.win.show();this.win.toFront(true);this.win.focus()};(function(){if(typeof this.GENTICS_Aloha_autoloadcss=="undefined"||!(this.GENTICS_Aloha_autoloadcss==false)){var base=GENTICS.Aloha.autobase;if(typeof GENTICS_Aloha_base!="undefined"){base=GENTICS_Aloha_base}var header=document.getElementsByTagName("head")[0];header.appendChild(cssElement(base+"css/aloha.css?v="+GENTICS.Aloha.version));header.appendChild(cssElement(base+"deps/extjs/resources/css/ext-all.css?v="+GENTICS.Aloha.version));header.appendChild(cssElement(base+"deps/extjs/resources/css/xtheme-gray.css?v="+GENTICS.Aloha.version));header.appendChild(cssElement(base+"plugins/com.gentics.aloha.plugins.Table/resources/table.css?v="+GENTICS.Aloha.version));header.appendChild(cssElement(base+"plugins/com.gentics.aloha.plugins.Link/css/Link.css?v="+GENTICS.Aloha.version))}function cssElement(link){var csslink=document.createElement("link");csslink.setAttribute("rel","stylesheet");csslink.setAttribute("type","text/css");csslink.setAttribute("href",link);csslink.setAttribute("media","all");return csslink}})();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Editable=function(obj){if(!obj.attr("id")){obj.attr("id",GENTICS.Utils.guid())}this.obj=obj;this.originalObj=obj;this.ready=false;GENTICS.Aloha.registerEditable(this);this.init()};GENTICS.Aloha.Editable.prototype.isActive=false;GENTICS.Aloha.Editable.prototype.originalContent=null;GENTICS.Aloha.Editable.prototype.range=undefined;GENTICS.Aloha.Editable.prototype.check=function(){var that=this;var obj=this.obj,el=obj.get(0),nodeName=el.nodeName.toLowerCase();var textElements=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"];for(var i=0;i<textElements.length;i++){var e=nodeName;if(nodeName==textElements[i]){return true}}switch(nodeName){case"label":case"button":break;case"textarea":var div=jQuery('<div id="'+this.getId()+'-aloha" class="GENTICS_textarea"/>').insertAfter(obj);div.height(obj.height());div.width(obj.width());div.html(obj.val());obj.hide();var updateFunction=function(){var val=that.getContents();obj.val(val)};obj.parents("form:first").submit(updateFunction);this.obj=div;return true;default:break}return false};GENTICS.Aloha.Editable.prototype.init=function(){var that=this;if(!this.check(this.obj)){this.destroy();return}if(GENTICS.Aloha.ready){this.obj.addClass("GENTICS_editable");this.obj.attr("contentEditable",true);this.obj.mousedown(function(e){return that.activate(e)});this.obj.focus(function(e){return that.activate(e)});this.obj.keydown(function(event){return GENTICS.Aloha.Markup.preProcessKeyStrokes(event)});this.obj.keyup(function(event){if(event.keyCode==27){GENTICS.Aloha.deactivateEditable();return false}});this.obj.GENTICS_contentEditableSelectionChange(function(event){GENTICS.Aloha.Selection.onChange(that.obj,event);return that.obj});GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableCreated",GENTICS.Aloha,[this]));this.setUnmodified();this.ready=true}};GENTICS.Aloha.Editable.prototype.destroy=function(){var that=this;this.blur();var oo=this.originalObj.get(0),onn=oo.nodeName.toLowerCase();switch(onn){case"label":case"button":break;case"textarea":var val=this.getContents();this.originalObj.val(val);this.obj.remove();this.originalObj.show();default:break}this.ready=false;this.obj.removeClass("GENTICS_editable");this.obj.removeAttr("contentEditable");this.obj.unbind("mousedown");this.obj.unbind("focus");this.obj.unbind("keydown");this.obj.unbind("keyup");if(this.isActive){GENTICS.Aloha.FloatingMenu.obj.hide();GENTICS.Aloha.FloatingMenu.shadow.hide()}GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDestroyed",GENTICS.Aloha,[this]));GENTICS.Aloha.unregisterEditable(this)};GENTICS.Aloha.Editable.prototype.setUnmodified=function(){this.originalContent=this.getContents()};GENTICS.Aloha.Editable.prototype.isModified=function(){if(this.originalContent!=this.getContents()){return true}else{return false}};GENTICS.Aloha.Editable.prototype.toString=function(){return"GENTICS.Aloha.Editable"};GENTICS.Aloha.Editable.prototype.isDisabled=function(){if(this.obj.attr("contentEditable")=="false"||!this.obj.attr("contentEditable")){return true}else{return false}};GENTICS.Aloha.Editable.prototype.disable=function(){if(this.isDisabled()){return}this.obj.attr("contentEditable","false")};GENTICS.Aloha.Editable.prototype.enable=function(){if(!this.isDisabled()){return}this.obj.attr("contentEditable","true")};GENTICS.Aloha.Editable.prototype.activate=function(e){if(e){e.stopPropagation()}var oldActive=GENTICS.Aloha.getActiveEditable();if(e&&e.type=="focus"&&oldActive!=null&&oldActive.obj.parent().get(0)==e.currentTarget){return}if(this.isActive||this.isDisabled()){return}GENTICS.Aloha.activateEditable(this);if(document.selection&&document.selection.createRange){this.obj.mouseup()}this.isActive=true;GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableActivated",GENTICS.Aloha,{oldActive:oldActive,editable:this}));GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableActivated",this,{oldActive:GENTICS.Aloha.getActiveEditable()}))};GENTICS.Aloha.Editable.prototype.blur=function(){this.obj.blur();this.isActive=false;GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDeactivated",GENTICS.Aloha,{editable:this}));GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDeactivated",this))};GENTICS.Aloha.Editable.prototype.empty=function(str){if(null===str){return true}return(GENTICS.Aloha.trim(str)==""||str=="<br>")};GENTICS.Aloha.Editable.prototype.getContents=function(){var clonedObj=this.obj.clone(true);clonedObj.find(".GENTICS_cleanme").remove();GENTICS.Aloha.PluginRegistry.makeClean(clonedObj);return clonedObj.html()};GENTICS.Aloha.Editable.prototype.getId=function(){return this.obj.attr("id")};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Ribbon=function(){var that=this;this.visible=false;this.toolbar=new Ext.Toolbar({height:30,cls:"GENTICS_ribbon ext-root"});this.toolbar.add(new Ext.Toolbar.Spacer({width:"5"}));this.icon=new Ext.Toolbar.Spacer();this.toolbar.add(this.icon);this.toolbar.add(new Ext.Toolbar.Fill());this.toolbar.add(new Ext.Toolbar.Separator());var fadeButton=new Ext.Button({iconCls:"GENTICS_fade_out",handler:function(button){var toolbar=jQuery(that.toolbar.getEl().dom);if(button.iconCls=="GENTICS_fade_out"){toolbar.css("marginLeft","34px");toolbar.animate({left:"-100%"});jQuery("body").animate({paddingTop:0});button.setIconClass("GENTICS_fade_in")}else{toolbar.css("marginLeft","0px");toolbar.animate({left:"0%"});jQuery("body").animate({paddingTop:30});button.setIconClass("GENTICS_fade_out")}that.toolbar.doLayout()}});this.toolbar.add(fadeButton);this.toolbar.add(new Ext.Toolbar.Spacer({width:"5"}))};GENTICS.Aloha.Ribbon.prototype.setIcon=function(iconClass){if(typeof this.icon.cls!="undefined"){this.icon.removeClass(this.icon.cls)}this.icon.addClass(iconClass)};GENTICS.Aloha.Ribbon.prototype.addButton=function(button){if(typeof button.menu==="object"){var menu=new Ext.menu.Menu();jQuery.each(button.menu,function(index,entry){menu.addItem(new Ext.menu.Item({text:entry.label,icon:entry.icon,iconCls:entry.iconClass,handler:function(){entry.onclick.apply(entry)}}))})}var buttonConfig={text:button.label,enableToggle:button.toggle,icon:button.icon,pressed:button.pressed,iconCls:button.iconClass,menu:menu,handler:function(){if(typeof button.onclick==="function"){button.onclick.apply(button)}button.pressed=!button.pressed}};var extButton;if(menu&&typeof button.onclick=="function"){extButton=new Ext.SplitButton(buttonConfig)}else{extButton=new Ext.Button(buttonConfig)}this.toolbar.insert(this.toolbar.items.getCount()-3,extButton)};GENTICS.Aloha.Ribbon.prototype.addSeparator=function(){this.toolbar.insert(this.toolbar.items.getCount()-3,new Ext.Toolbar.Separator())};GENTICS.Aloha.Ribbon.prototype.init=function(){this.toolbar.render(document.body,0);if(GENTICS.Aloha.settings.ribbon===true||GENTICS.Aloha.settings.ribbon=="true"||GENTICS.Aloha.settings.ribbon==1){jQuery("body").css("paddingTop","30px !important");this.show()}};GENTICS.Aloha.Ribbon.prototype.hide=function(){jQuery(".GENTICS_ribbon").fadeOut();this.visible=false};GENTICS.Aloha.Ribbon.prototype.show=function(){jQuery(".GENTICS_ribbon").fadeIn();this.visible=true};GENTICS.Aloha.Ribbon.prototype.isVisible=function(){return this.visible};GENTICS.Aloha.Ribbon=new GENTICS.Aloha.Ribbon();
/*
* 
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Event=function(eventName,eventSource,properties){this.name=eventName;if(eventSource){this.source=eventSource}else{this.source=GENTICS.Aloha}this.properties=properties};GENTICS.Aloha.EventRegistry=function(){};GENTICS.Aloha.EventRegistry.prototype.subscribe=function(eventSource,eventName,handleMethod){jQuery(eventSource).bind(eventName,handleMethod)};GENTICS.Aloha.EventRegistry.prototype.trigger=function(event){jQuery(event.source).trigger(event.name,event.properties)};GENTICS.Aloha.EventRegistry=new GENTICS.Aloha.EventRegistry();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.FloatingMenu={};GENTICS.Aloha.FloatingMenu.scopes={"GENTICS.Aloha.empty":{name:"GENTICS.Aloha.empty",extendedScopes:[],buttons:[]},"GENTICS.Aloha.global":{name:"GENTICS.Aloha.global",extendedScopes:["GENTICS.Aloha.empty"],buttons:[]},"GENTICS.Aloha.continuoustext":{name:"GENTICS.Aloha.continuoustext",extendedScopes:["GENTICS.Aloha.global"],buttons:[]}};GENTICS.Aloha.FloatingMenu.tabs=new Array();GENTICS.Aloha.FloatingMenu.tabMap={};GENTICS.Aloha.FloatingMenu.initialized=false;GENTICS.Aloha.FloatingMenu.allButtons=new Array();GENTICS.Aloha.FloatingMenu.top=100;GENTICS.Aloha.FloatingMenu.left=100;GENTICS.Aloha.FloatingMenu.pinned=false;GENTICS.Aloha.FloatingMenu.window=jQuery(window);GENTICS.Aloha.FloatingMenu.behaviour="float";GENTICS.Aloha.FloatingMenu.marginTop=0;GENTICS.Aloha.FloatingMenu.init=function(){if(GENTICS.Aloha.settings.floatingmenu){if(typeof GENTICS.Aloha.settings.floatingmenu.behaviour==="string"){this.behaviour=GENTICS.Aloha.settings.floatingmenu.behaviour}if(typeof GENTICS.Aloha.settings.floatingmenu.marginTop==="number"){this.marginTop=GENTICS.Aloha.settings.floatingmenu.marginTop}}this.currentScope="GENTICS.Aloha.global";var that=this;this.window.unload(function(){if(that.pinned){jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned","true");jQuery.cookie("GENTICS.Aloha.FloatingMenu.top",that.obj.offset().top);jQuery.cookie("GENTICS.Aloha.FloatingMenu.left",that.obj.offset().left);if(GENTICS.Aloha.Log.isInfoEnabled()){GENTICS.Aloha.Log.info(this,"stored FloatingMenu pinned position {"+that.obj.offset().left+", "+that.obj.offset().top+"}")}}else{jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned",null);jQuery.cookie("GENTICS.Aloha.FloatingMenu.top",null);jQuery.cookie("GENTICS.Aloha.FloatingMenu.left",null)}if(that.userActivatedTab){jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab",that.userActivatedTab)}}).resize(function(){if(this.behaviour==="float"){var target=that.calcFloatTarget(GENTICS.Aloha.Selection.getRangeObject());if(target){that.floatTo(target)}}});this.generateComponent();this.initialized=true};GENTICS.Aloha.FloatingMenu.obj=null;GENTICS.Aloha.FloatingMenu.shadow=null;GENTICS.Aloha.FloatingMenu.panelBody=null;GENTICS.Aloha.FloatingMenu.generateComponent=function(){var that=this;Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{minWidth:10});if(this.extTabPanel){}this.extTabPanel=new Ext.TabPanel({activeTab:0,width:400,plain:false,draggable:{insertProxy:false,onDrag:function(e){var pel=this.proxy.getEl();this.x=pel.getLeft(true);this.y=pel.getTop(true);GENTICS.Aloha.FloatingMenu.shadow.hide()},endDrag:function(e){if(GENTICS.Aloha.FloatingMenu.pinned){var top=this.y-jQuery(document).scrollTop()}else{var top=this.y}that.left=this.x;that.top=top;this.panel.setPosition(this.x,top);GENTICS.Aloha.FloatingMenu.refreshShadow();GENTICS.Aloha.FloatingMenu.shadow.show()}},floating:true,defaults:{autoScroll:true},layoutOnTabChange:true,shadow:false,cls:"GENTICS_floatingmenu ext-root",listeners:{tabchange:{fn:function(tabPanel,tab){if(tab.title!=that.autoActivatedTab){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(that,"User selected tab "+tab.title)}that.userActivatedTab=tab.title}else{if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(that,"Tab "+tab.title+" was activated automatically")}}that.autoActivatedTab=undefined;jQuery.each(that.allButtons,function(index,buttonInfo){if(typeof buttonInfo.button!="undefined"&&typeof buttonInfo.button.extButton!="undefined"&&typeof buttonInfo.button.extButton.setActiveDOMElement=="function"){if(typeof buttonInfo.button.extButton.activeDOMElement!="undefined"){buttonInfo.button.extButton.setActiveDOMElement(buttonInfo.button.extButton.activeDOMElement)}}});GENTICS.Aloha.FloatingMenu.shadow.show();GENTICS.Aloha.FloatingMenu.refreshShadow()}}},enableTabScroll:true});jQuery.each(this.tabs,function(index,tab){that.extTabPanel.add(tab.getExtComponent())});jQuery("body").append('<div id="GENTICS_floatingmenu_shadow" class="GENTICS_shadow">&#160;</div>');this.shadow=jQuery("#GENTICS_floatingmenu_shadow");var pinTab=this.extTabPanel.add({title:"&#160;"});this.extTabPanel.render(document.body);jQuery(pinTab.tabEl).addClass("GENTICS_floatingmenu_pin").html("&#160;").mousedown(function(e){that.togglePin();e.stopPropagation()});this.panelBody=jQuery(".GENTICS_floatingmenu .x-tab-panel-bwrap");this.doLayout();this.obj=jQuery(this.extTabPanel.getEl().dom);if(jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned")=="true"){this.togglePin();this.top=parseInt(jQuery.cookie("GENTICS.Aloha.FloatingMenu.top"));this.left=parseInt(jQuery.cookie("GENTICS.Aloha.FloatingMenu.left"));if(this.top<30){this.top=30}if(this.left<0){this.left=0}if(GENTICS.Aloha.Log.isInfoEnabled()){GENTICS.Aloha.Log.info(this,"restored FloatingMenu pinned position {"+this.left+", "+this.top+"}")}this.refreshShadow()}if(jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab")){this.userActivatedTab=jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab")}this.extTabPanel.setPosition(this.left,this.top);this.obj.mousedown(function(e){e.stopPropagation()});if(this.behaviour==="float"){GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(event,rangeObject){if(!that.pinned){var pos=that.calcFloatTarget(rangeObject);if(pos){that.floatTo(pos)}}})}else{if(this.behaviour==="topalign"){this.togglePin(false);var d=jQuery(document);GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableActivated",function(event,data){var p=data.editable.obj.offset();p.top-=90;if(p.top<d.scrollTop()){that.obj.css("top",d.scrollTop()+that.marginTop);that.obj.css("left",p.left);that.togglePin(true)}else{that.floatTo(p)}});jQuery(window).scroll(function(){if(!GENTICS.Aloha.activeEditable){return}var pos=GENTICS.Aloha.activeEditable.obj.offset();var fmHeight=that.obj.height();var scrollTop=d.scrollTop();if(scrollTop>(pos.top-fmHeight-6-that.marginTop)){that.togglePin(true);that.obj.css("top",that.marginTop)}else{if(scrollTop<=(pos.top-fmHeight-6-that.marginTop)){pos.top-=fmHeight+6;that.togglePin(false);that.floatTo(pos)}else{if(scrollTop>pos.top+GENTICS.Aloha.activeEditable.obj.height()-fmHeight){that.togglePin(false)}}}})}}};GENTICS.Aloha.FloatingMenu.refreshShadow=function(){if(!this.panelBody){return}GENTICS.Aloha.FloatingMenu.shadow.css("top",this.top+24);GENTICS.Aloha.FloatingMenu.shadow.css("left",this.left);GENTICS.Aloha.FloatingMenu.shadow.width(this.panelBody.width());GENTICS.Aloha.FloatingMenu.shadow.height(this.panelBody.height())};GENTICS.Aloha.FloatingMenu.togglePin=function(pinned){var el=jQuery(".GENTICS_floatingmenu_pin");if(typeof pinned==="boolean"){this.pinned=!pinned}if(this.pinned){el.removeClass("GENTICS_floatingmenu_pinned");this.top=this.obj.offset().top;this.obj.css("top",this.top);this.obj.css("position","absolute");this.shadow.css("position","absolute");this.refreshShadow();this.pinned=false}else{el.addClass("GENTICS_floatingmenu_pinned");this.top=this.obj.offset().top-this.window.scrollTop();this.obj.css("top",this.top);this.obj.css("position","fixed");this.shadow.css("position","fixed");this.refreshShadow();this.pinned=true}};GENTICS.Aloha.FloatingMenu.createScope=function(scope,extendedScopes){if(typeof extendedScopes=="undefined"){extendedScopes=["GENTICS.Aloha.empty"]}else{if(typeof extendedScopes=="string"){extendedScopes=[extendedScopes]}}var scopeObject=this.scopes[scope];if(scopeObject){}else{this.scopes[scope]={name:scope,extendedScopes:extendedScopes,buttons:[]}}};GENTICS.Aloha.FloatingMenu.addButton=function(scope,button,tab,group){var scopeObject=this.scopes[scope];if(typeof scopeObject=="undefined"){}var buttonInfo={button:button,scopeVisible:false};this.allButtons.push(buttonInfo);scopeObject.buttons.push(buttonInfo);var tabObject=this.tabMap[tab];if(typeof tabObject=="undefined"){tabObject=new GENTICS.Aloha.FloatingMenu.Tab(tab);this.tabs.push(tabObject);this.tabMap[tab]=tabObject}var groupObject=tabObject.getGroup(group);groupObject.addButton(buttonInfo);if(this.initialized){this.generateComponent()}};GENTICS.Aloha.FloatingMenu.doLayout=function(){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"doLayout called for FloatingMenu, scope is "+this.currentScope)}var that=this;var firstVisibleTab=false;var activeExtTab=this.extTabPanel.getActiveTab();var activeTab=false;var floatingMenuVisible=false;var showUserActivatedTab=false;jQuery.each(this.tabs,function(index,tab){if(tab.extPanel==activeExtTab){activeTab=tab}var tabVisible=tab.visible;if(tab.doLayout()){floatingMenuVisible=true;if(!tabVisible){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(that,"showing tab strip for tab "+tab.label)}that.extTabPanel.unhideTabStripItem(tab.extPanel)}if(firstVisibleTab==false){firstVisibleTab=tab}if(that.userActivatedTab==tab.extPanel.title&&tab.extPanel!=activeExtTab){showUserActivatedTab=tab}}else{if(tabVisible){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(that,"hiding tab strip for tab "+tab.label)}that.extTabPanel.hideTabStripItem(tab.extPanel)}}});if(showUserActivatedTab){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"Setting active tab to "+showUserActivatedTab.label)}this.extTabPanel.setActiveTab(showUserActivatedTab.extPanel)}else{if(typeof activeTab=="object"&&typeof firstVisibleTab=="object"){if(!activeTab.visible){if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"Setting active tab to "+firstVisibleTab.label)}this.autoActivatedTab=firstVisibleTab.extPanel.title;this.extTabPanel.setActiveTab(firstVisibleTab.extPanel)}}}if(floatingMenuVisible&&this.extTabPanel.hidden){this.extTabPanel.show();this.refreshShadow();this.shadow.show();this.extTabPanel.setPosition(this.left,this.top)}else{if(!floatingMenuVisible&&!this.extTabPanel.hidden){var pos=this.extTabPanel.getPosition(true);this.left=pos[0]<0?100:pos[0];this.top=pos[1]<0?100:pos[1];this.extTabPanel.hide();this.shadow.hide()}}this.extTabPanel.doLayout()};GENTICS.Aloha.FloatingMenu.setScope=function(scope){var scopeObject=this.scopes[scope];if(typeof scopeObject=="undefined"){}else{if(this.currentScope!=scope){this.currentScope=scope;jQuery.each(this.allButtons,function(index,buttonInfo){buttonInfo.scopeVisible=false});this.setButtonScopeVisibility(scopeObject);this.doLayout()}}};GENTICS.Aloha.FloatingMenu.setButtonScopeVisibility=function(scopeObject){var that=this;jQuery.each(scopeObject.buttons,function(index,buttonInfo){buttonInfo.scopeVisible=true});jQuery.each(scopeObject.extendedScopes,function(index,scopeName){var motherScopeObject=that.scopes[scopeName];if(typeof motherScopeObject=="object"){that.setButtonScopeVisibility(motherScopeObject)}})};GENTICS.Aloha.FloatingMenu.nextFloatTargetObj=function(obj,limitObj){if(!obj||obj==limitObj){return obj}switch(obj.nodeName.toLowerCase()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"p":case"div":case"td":case"pre":case"ul":case"ol":return obj;break;default:return this.nextFloatTargetObj(obj.parentNode,limitObj);break}};GENTICS.Aloha.FloatingMenu.calcFloatTarget=function(range){if(!GENTICS.Aloha.activeEditable||typeof range.getCommonAncestorContainer=="undefined"){return false}for(var i=0;i<GENTICS.Aloha.editables.length;i++){if(GENTICS.Aloha.editables[i].obj.get(0)==range.limitObject&&GENTICS.Aloha.editables[i].isDisabled()){return false}}var target=this.nextFloatTargetObj(range.getCommonAncestorContainer(),range.limitObject);if(!target){return false}var targetObj=jQuery(target);var scrollTop=GENTICS.Utils.Position.Scroll.top;var top=targetObj.offset().top-this.obj.height()-50;var ribbonOffset=0;if(GENTICS.Aloha.Ribbon&&(GENTICS.Aloha.settings.ribbon===true||GENTICS.Aloha.settings.ribbon=="true"||GENTICS.Aloha.settings.ribbon==1)){ribbonOffset=30}if(top<(scrollTop+ribbonOffset)){top=targetObj.offset().top+targetObj.height()+ribbonOffset}if(top>this.window.height()+this.window.scrollTop()){return false}return{left:GENTICS.Aloha.activeEditable.obj.offset().left,top:top}};GENTICS.Aloha.FloatingMenu.floatTo=function(position){if(this.pinned){return}var that=this;var fmpos=this.obj.offset();if(fmpos.left!=position.left||fmpos.top!=position.top){this.obj.animate({top:position.top,left:position.left},{queue:false,step:function(step,props){if(props.prop=="top"){that.top=props.now}else{if(props.prop=="left"){that.left=props.now}}that.refreshShadow()}})}};GENTICS.Aloha.FloatingMenu.Tab=function(label){this.label=label;this.groups=new Array();this.groupMap={};this.visible=true};GENTICS.Aloha.FloatingMenu.Tab.prototype.getGroup=function(group){var groupObject=this.groupMap[group];if(typeof groupObject=="undefined"){groupObject=new GENTICS.Aloha.FloatingMenu.Group();this.groupMap[group]=groupObject;this.groups.push(groupObject)}return groupObject};GENTICS.Aloha.FloatingMenu.Tab.prototype.getExtComponent=function(){var that=this;if(typeof this.extPanel=="undefined"){this.extPanel=new Ext.Panel({tbar:[],title:this.label,style:"margin-top:0px",bodyStyle:"display:none",autoScroll:true});jQuery.each(this.groups,function(index,group){that.extPanel.getTopToolbar().add(group.getExtComponent())})}return this.extPanel};GENTICS.Aloha.FloatingMenu.Tab.prototype.doLayout=function(){var that=this;if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"doLayout called for tab "+this.label)}this.visible=false;jQuery.each(this.groups,function(index,group){that.visible|=group.doLayout()});if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"tab "+this.label+(this.visible?" is ":" is not ")+"visible now")}return this.visible};GENTICS.Aloha.FloatingMenu.Group=function(){this.buttons=new Array()};GENTICS.Aloha.FloatingMenu.Group.prototype.addButton=function(buttonInfo){this.buttons.push(buttonInfo)};GENTICS.Aloha.FloatingMenu.Group.prototype.getExtComponent=function(){var that=this;if(typeof this.extButtonGroup=="undefined"){var items=new Array();var buttonCount=0;jQuery.each(this.buttons,function(index,button){items.push(button.button.getExtConfigProperties());buttonCount+=button.button.size=="small"?1:2});this.extButtonGroup=new Ext.ButtonGroup({columns:Math.ceil(buttonCount/2),items:items});jQuery.each(this.buttons,function(index,buttonInfo){buttonInfo.button.extButton=that.extButtonGroup.findById(buttonInfo.button.id);if(buttonInfo.button.listenerQueue&&buttonInfo.button.listenerQueue.length>0){while(l=buttonInfo.button.listenerQueue.shift()){buttonInfo.button.extButton.addListener(l.eventName,l.handler,l.scope,l.options)}}if(buttonInfo.button.extButton.setObjectTypeFilter){if(buttonInfo.button.objectTypeFilter){buttonInfo.button.extButton.noQuery=false}if(buttonInfo.button.objectTypeFilter=="all"){buttonInfo.button.objectTypeFilter=null}buttonInfo.button.extButton.setObjectTypeFilter(buttonInfo.button.objectTypeFilter);if(buttonInfo.button.displayField){buttonInfo.button.extButton.displayField=buttonInfo.button.displayField}if(buttonInfo.button.tpl){buttonInfo.button.extButton.tpl=buttonInfo.button.tpl}}})}return this.extButtonGroup};GENTICS.Aloha.FloatingMenu.Group.prototype.doLayout=function(){var groupVisible=false;var that=this;jQuery.each(this.buttons,function(index,button){var extButton=that.extButtonGroup.findById(button.button.id);var buttonVisible=button.button.isVisible()&&button.scopeVisible;if(buttonVisible&&extButton.hidden){extButton.show()}else{if(!buttonVisible&&!extButton.hidden){extButton.hide()}}groupVisible|=buttonVisible});if(groupVisible&&this.extButtonGroup.hidden){this.extButtonGroup.show()}else{if(!groupVisible&&!this.extButtonGroup.hidden){this.extButtonGroup.hide()}}return groupVisible};var rangy=(function(){var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var textRangeMethods=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"];function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||(!!(t==OBJECT&&o[p]))||t=="unknown"}function isHostObject(o,p){return !!(typeof o[p]==OBJECT&&o[p])}function isHostProperty(o,p){return typeof o[p]!=UNDEFINED}function createMultiplePropertyTest(testFunc){return function(o,props){var i=props.length;while(i--){if(!testFunc(o,props[i])){return false}}return true}}var areHostMethods=createMultiplePropertyTest(isHostMethod);var areHostObjects=createMultiplePropertyTest(isHostObject);var areHostProperties=createMultiplePropertyTest(isHostProperty);var api={initialized:false,supported:true,util:{isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties},features:{},modules:{},config:{alertOnWarn:false}};function fail(reason){window.alert("Rangy not supported in your browser. Reason: "+reason);api.initialized=true;api.supported=false}api.fail=fail;function warn(reason){var warningMessage="Rangy warning: "+reason;if(api.config.alertOnWarn){window.alert(warningMessage)}else{if(typeof window.console!=UNDEFINED&&typeof window.console.log!=UNDEFINED){window.console.log(warningMessage)}}}api.warn=warn;function init(){if(api.initialized){return}var testRange;var implementsDomRange=false,implementsTextRange=false;if(isHostMethod(document,"createRange")){testRange=document.createRange();if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){implementsDomRange=true}testRange.detach()}var body=isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0];if(body&&isHostMethod(body,"createTextRange")){testRange=body.createTextRange();if(areHostMethods(testRange,textRangeMethods)&&areHostProperties(testRange,textRangeProperties)){implementsTextRange=true}}if(!implementsDomRange&&!implementsTextRange){fail("Neither Range nor TextRange are implemented")}api.initialized=true;api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var allListeners=moduleInitializers.concat(initListeners);for(var i=0,len=allListeners.length;i<len;++i){try{allListeners[i](api)}catch(ex){if(isHostObject(window,"console")&&isHostMethod(window.console,"log")){console.log("Init listener threw an exception. Continuing.",ex)}}}}api.init=init;var initListeners=[];var moduleInitializers=[];api.addInitListener=function(listener){if(api.initialized){listener(api)}else{initListeners.push(listener)}};var createMissingNativeApiListeners=[];api.addCreateMissingNativeApiListener=function(listener){createMissingNativeApiListeners.push(listener)};function createMissingNativeApi(win){win=win||window;init();for(var i=0,len=createMissingNativeApiListeners.length;i<len;++i){createMissingNativeApiListeners[i](win)}}api.createMissingNativeApi=createMissingNativeApi;function Module(name){this.name=name;this.initialized=false;this.supported=false}Module.prototype.fail=function(reason){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+reason)};Module.prototype.createError=function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg)};api.createModule=function(name,initFunc){var module=new Module(name);api.modules[name]=module;moduleInitializers.push(function(api){initFunc(api,module);module.initialized=true;module.supported=true})};api.requireModules=function(modules){for(var i=0,len=modules.length,module,moduleName;i<len;++i){moduleName=modules[i];module=api.modules[moduleName];if(!module||!(module instanceof Module)){throw new Error("Module '"+moduleName+"' not found")}if(!module.supported){throw new Error("Module '"+moduleName+"' not supported")}}};var docReady=false;var loadHandler=function(e){if(!docReady){docReady=true;if(!api.initialized){init()}}};if(typeof window==UNDEFINED){fail("No window found");return}if(typeof document==UNDEFINED){fail("No document found");return}if(isHostMethod(document,"addEventListener")){document.addEventListener("DOMContentLoaded",loadHandler,false)}if(isHostMethod(window,"addEventListener")){window.addEventListener("load",loadHandler,false)}else{if(isHostMethod(window,"attachEvent")){window.attachEvent("onload",loadHandler)}else{fail("Window does not have required addEventListener or attachEvent method")}}return api})();rangy.createModule("DomUtil",function(api,module){var UNDEF="undefined";var util=api.util;if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method")}if(!util.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method")}var el=document.createElement("div");if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation")}var textNode=document.createTextNode("test");if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))){module.fail("Incomplete Text Node implementation")}var arrayContains=function(arr,val){var i=arr.length;while(i--){if(arr[i]===val){return true}}return false};function getNodeIndex(node){var i=0;while((node=node.previousSibling)){i++}return i}function getCommonAncestor(node1,node2){var ancestors=[],n;for(n=node1;n;n=n.parentNode){ancestors.push(n)}for(n=node2;n;n=n.parentNode){if(arrayContains(ancestors,n)){return n}}return null}function isAncestorOf(ancestor,descendant,selfIsAncestor){var n=selfIsAncestor?descendant:descendant.parentNode;while(n){if(n===ancestor){return true}else{n=n.parentNode}}return false}function getClosestAncestorIn(node,ancestor,selfIsAncestor){var p,n=selfIsAncestor?node:node.parentNode;while(n){p=n.parentNode;if(p===ancestor){return n}n=p}return null}function isCharacterDataNode(node){var t=node.nodeType;return t==3||t==4||t==8}function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;if(nextNode){parent.insertBefore(node,nextNode)}else{parent.appendChild(node)}return node}function splitDataNode(node,index){var newNode;if(node.nodeType==3){newNode=node.splitText(index)}else{newNode=node.cloneNode();newNode.deleteData(0,index);node.deleteData(0,node.length-index);insertAfter(newNode,node)}return newNode}function getDocument(node){if(node.nodeType==9){return node}else{if(typeof node.ownerDocument!=UNDEF){return node.ownerDocument}else{if(typeof node.document!=UNDEF){return node.document}else{if(node.parentNode){return getDocument(node.parentNode)}else{throw new Error("getDocument: no document found for node")}}}}}function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF){return doc.defaultView}else{if(typeof doc.parentWindow!=UNDEF){return doc.parentWindow}else{throw new Error("Cannot get a window object for node")}}}function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument}else{if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}}function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow}else{if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}}function getBody(doc){return util.isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0]}function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB){return offsetA===offsetB?0:(offsetA<offsetB)?-1:1}else{if((nodeC=getClosestAncestorIn(nodeB,nodeA,true))){return offsetA<=getNodeIndex(nodeC)?-1:1}else{if((nodeC=getClosestAncestorIn(nodeA,nodeB,true))){return getNodeIndex(nodeC)<offsetB?-1:1}else{root=getCommonAncestor(nodeA,nodeB);childA=(nodeA===root)?root:getClosestAncestorIn(nodeA,root,true);childB=(nodeB===root)?root:getClosestAncestorIn(nodeB,root,true);if(childA===childB){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{n=root.firstChild;while(n){if(n===childA){return -1}else{if(n===childB){return 1}}n=n.nextSibling}throw new Error("Should not be here!")}}}}}function inspectNode(node){if(!node){return"[No node]"}if(isCharacterDataNode(node)){return'"'+node.data+'"'}else{if(node.nodeType==1){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">["+node.childNodes.length+"]"}else{return node.nodeName}}}function NodeIterator(root){this.root=root;this._next=root}NodeIterator.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var n=this._current=this._next;var child,next;if(this._current){child=n.firstChild;if(child){this._next=child}else{next=null;while((n!==this.root)&&!(next=n.nextSibling)){n=n.parentNode}this._next=next}}return this._current},detach:function(){this._current=this._next=this.root=null}};function createIterator(root){return new NodeIterator(root)}function DomPosition(node,offset){this.node=node;this.offset=offset}DomPosition.prototype={equals:function(pos){return this.node===pos.node&this.offset==pos.offset},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"}};function DOMException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="DOMException: "+this.codeName}DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};DOMException.prototype.toString=function(){return this.message};api.dom={arrayContains:arrayContains,getNodeIndex:getNodeIndex,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:getBody,comparePoints:comparePoints,inspectNode:inspectNode,createIterator:createIterator,DomPosition:DomPosition};api.DOMException=DOMException});rangy.createModule("DomRange",function(api,module){api.requireModules(["DomUtil"]);var dom=api.dom;var DomPosition=dom.DomPosition;var DOMException=api.DOMException;function RangeIterator(range,clonePartiallySelectedTextNodes){this.range=range;this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;if(!range.collapsed){this.sc=range.startContainer;this.so=range.startOffset;this.ec=range.endContainer;this.eo=range.endOffset;var root=range.commonAncestorContainer;if(this.sc===this.ec&&dom.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===root&&!dom.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:dom.getClosestAncestorIn(this.sc,root,true);this._last=(this.ec===root&&!dom.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:dom.getClosestAncestorIn(this.ec,root,true)}}}RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var current=this._current=this._next;if(current){this._next=(current!==this._last)?current.nextSibling:null;if(dom.isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){if(current===this.ec){(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo)}if(this._current===this.sc){(current=current.cloneNode(true)).deleteData(0,this.so)}}}return current},remove:function(){var current=this._current,start,end;if(dom.isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){start=(current===this.sc)?this.so:0;end=(current===this.ec)?this.eo:current.length;if(start!=end){current.deleteData(start,end-start)}}else{if(current.parentNode){current.parentNode.removeChild(current)}else{}}},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range)},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode){subRange=this.range.cloneRange();subRange.collapse()}else{subRange=new Range(getRangeDocument(this.range));var current=this._current;var startContainer=current,startOffset=0,endContainer=current,endOffset=getEndOffset(current);if(dom.isAncestorOf(current,this.sc,true)){startContainer=this.sc;startOffset=this.so}if(dom.isAncestorOf(current,this.ec,true)){endContainer=this.ec;endOffset=this.eo}updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset)}return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes)},detach:function(detachRange){if(detachRange){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function RangeException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="RangeException: "+this.codeName}RangeException.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};RangeException.prototype.toString=function(){return this.message};function getRangeDocument(range){return dom.getDocument(range.startContainer)}function dispatchEvent(range,type,args){var listeners=range._listeners[type];if(listeners){for(var i=0,len=listeners.length;i<len;++i){listeners[i].call(range,{target:range,args:args})}}}function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node))}function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node)+1)}function getEndOffset(node){return dom.isCharacterDataNode(node)?node.length:(node.childNodes?node.childNodes.length:0)}function insertNodeAtPosition(node,n,o){var firstNodeInserted=node.nodeType==11?node.firstChild:node;if(dom.isCharacterDataNode(n)){if(o==n.length){dom.insertAfter(node,n)}else{n.parentNode.insertBefore(node,o==0?n:dom.splitDataNode(n,o))}}else{if(o>=n.childNodes.length){n.appendChild(node)}else{n.insertBefore(node,n.childNodes[o])}}return firstNodeInserted}function cloneSubtree(iterator){var partiallySelected;for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){partiallySelected=iterator.isPartiallySelectedSubtree();node=node.cloneNode(!partiallySelected);if(partiallySelected){subIterator=iterator.getSubtreeIterator();node.appendChild(cloneSubtree(subIterator));subIterator.detach(true)}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:false};for(var node,subRangeIterator;node=rangeIterator.next();){if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===false){iteratorState.stop=true;return}else{subRangeIterator=rangeIterator.getSubtreeIterator();iterateSubtree(subRangeIterator,func,iteratorState);subRangeIterator.detach(true);if(iteratorState.stop){return}}}else{it=dom.createIterator(node);while((n=it.next())){if(func(n)===false){iteratorState.stop=true;return}}}}}function deleteSubtree(iterator){var subIterator;while(iterator.next()){if(iterator.isPartiallySelectedSubtree()){subIterator=iterator.getSubtreeIterator();deleteSubtree(subIterator);subIterator.detach(true)}else{iterator.remove()}}}function extractSubtree(iterator){for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){if(iterator.isPartiallySelectedSubtree()){node=node.cloneNode(false);subIterator=iterator.getSubtreeIterator();node.appendChild(extractSubtree(subIterator));subIterator.detach(true)}else{iterator.remove()}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function getNodesInRange(range,nodeTypes,filter){var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;var filterExists=!!filter;if(filterNodeTypes){regex=new RegExp("^("+nodeTypes.join("|")+")$")}var nodes=[];iterateSubtree(new RangeIterator(range,false),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){nodes.push(node)}});return nodes}function inspect(range){var name=(typeof range.getName=="undefined")?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]"}function RangeNodeIterator(range,nodeTypes,filter){this.nodes=getNodesInRange(range,nodeTypes,filter);this._next=this.nodes[0];this._pointer=0}RangeNodeIterator.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._pointer];return this._current},detach:function(){this._current=this._next=this.nodes=null}};function isNonTextPartiallySelected(node,range){return(node.nodeType!=3)&&(dom.isAncestorOf(node,range.startContainer,true)||dom.isAncestorOf(node,range.endContainer,true))}var beforeAfterNodeTypes=[1,3,4,5,7,8,10];var rootContainerNodeTypes=[2,9,11];var readonlyNodeTypes=[5,6,10,12];var insertableNodeTypes=[1,3,4,5,7,8,10,11];var surroundNodeTypes=[1,3,4,5,7,8];function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){var t,n=selfIsAncestor?node:node.parentNode;while(n){t=n.nodeType;if(dom.arrayContains(nodeTypes,t)){return n}n=n.parentNode}return null}}function getRootContainer(node){var parent;while((parent=node.parentNode)){node=parent}return node}var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf)){throw new RangeException("INVALID_NODE_TYPE_ERR")}}function assertNotDetached(range){if(!range.startContainer){throw new DOMException("INVALID_STATE_ERR")}}function assertValidNodeType(node,invalidTypes){if(!dom.arrayContains(invalidTypes,node.nodeType)){throw new RangeException("INVALID_NODE_TYPE_ERR")}}function assertValidOffset(node,offset){if(offset<0||offset>(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)){throw new DOMException("INDEX_SIZE_ERR")}}function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){throw new DOMException("WRONG_DOCUMENT_ERR")}}function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,true)){throw new DOMException("NO_MODIFICATION_ALLOWED_ERR")}}function assertNode(node,codeName){if(!node){throw new DOMException(codeName)}}function isOrphan(node){return !getDocumentOrFragmentContainer(node,true)}function isValidOffset(node,offset){return offset<=(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)}function assertRangeValid(range){if(isOrphan(range.startContainer)||isOrphan(range.endContainer)||!isValidOffset(range.startContainer,range.startOffset)||!isValidOffset(range.endContainer,range.endOffset)){throw new Error("Range Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")")}}var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var s2s=0,s2e=1,e2e=2,e2s=3;var n_b=0,n_a=1,n_b_a=2,n_i=3;function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s;obj.START_TO_END=s2e;obj.END_TO_END=e2e;obj.END_TO_START=e2s;obj.NODE_BEFORE=n_b;obj.NODE_AFTER=n_a;obj.NODE_BEFORE_AND_AFTER=n_b_a;obj.NODE_INSIDE=n_i}function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor);copyComparisonConstantsToObject(constructor.prototype)}function createPrototypeRange(constructor,boundaryUpdater,detacher){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertNotDetached(this);assertValidNodeType(node,beforeAfterNodeTypes);assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset)}}function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;if(node!==range.startContainer||offset!==this.startOffset){if(getRootContainer(node)!=getRootContainer(ec)||dom.comparePoints(node,offset,ec,eo)==1){ec=node;eo=offset}boundaryUpdater(range,node,offset,ec,eo)}}function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;if(node!==range.endContainer||offset!==this.endOffset){if(getRootContainer(node)!=getRootContainer(sc)||dom.comparePoints(node,offset,sc,so)==-1){sc=node;so=offset}boundaryUpdater(range,sc,so,node,offset)}}function setRangeStartAndEnd(range,node,offset){if(node!==range.startContainer||offset!==this.startOffset||node!==range.endContainer||offset!==this.endOffset){boundaryUpdater(range,node,offset,node,offset)}}function createRangeContentRemover(remover){return function(){assertNotDetached(this);assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;var iterator=new RangeIterator(this,true);var node,boundary;if(sc!==root){node=dom.getClosestAncestorIn(sc,root,true);boundary=getBoundaryAfterNode(node);sc=boundary.node;so=boundary.offset}iterateSubtree(iterator,assertNodeNotReadOnly);iterator.reset();var returnValue=remover(iterator);iterator.detach();boundaryUpdater(this,sc,so,sc,so);return returnValue}}constructor.prototype={attachListener:function(type,listener){this._listeners[type].push(listener)},setStart:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStart(this,node,offset)},setEnd:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeEnd(this,node,offset)},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(isStart){assertNotDetached(this);assertRangeValid(this);if(isStart){boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);boundaryUpdater(this,node,0,node,getEndOffset(node))},selectNode:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,false);assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset)},compareBoundaryPoints:function(how,range){assertNotDetached(this);assertRangeValid(this);assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB;var prefixA=(how==e2s||how==s2s)?"start":"end";var prefixB=(how==s2e||how==s2s)?"start":"end";nodeA=this[prefixA+"Container"];offsetA=this[prefixA+"Offset"];nodeB=range[prefixB+"Container"];offsetB=range[prefixB+"Offset"];return dom.comparePoints(nodeA,offsetA,nodeB,offsetB)},insertNode:function(node){assertNotDetached(this);assertRangeValid(this);assertValidNodeType(node,insertableNodeTypes);assertNodeNotReadOnly(this.startContainer);if(dom.isAncestorOf(node,this.startContainer,true)){throw new DOMException("HIERARCHY_REQUEST_ERR")}var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted)},cloneContents:function(){assertNotDetached(this);assertRangeValid(this);var clone,frag;if(this.collapsed){return getRangeDocument(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&dom.isCharacterDataNode(this.startContainer)){clone=this.startContainer.cloneNode(true);clone.data=clone.data.slice(this.startOffset,this.endOffset);frag=getRangeDocument(this).createDocumentFragment();frag.appendChild(clone);return frag}else{var iterator=new RangeIterator(this,true);clone=cloneSubtree(iterator);iterator.detach()}return clone}},extractContents:createRangeContentRemover(extractSubtree),deleteContents:createRangeContentRemover(deleteSubtree),canSurroundContents:function(){assertNotDetached(this);assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));iterator.detach();return !boundariesInvalid},surroundContents:function(node){assertValidNodeType(node,surroundNodeTypes);if(!this.canSurroundContents()){throw new RangeException("BAD_BOUNDARYPOINTS_ERR")}var content=this.extractContents();if(node.hasChildNodes()){while(node.lastChild){node.removeChild(node.lastChild)}}insertNodeAtPosition(node,this.startContainer,this.startOffset);node.appendChild(content);this.selectNode(node)},cloneRange:function(){assertNotDetached(this);assertRangeValid(this);var range=new Range(getRangeDocument(this));var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=this[prop]}return range},detach:function(){detacher(this)},toString:function(){assertNotDetached(this);assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&dom.isCharacterDataNode(sc)){return(sc.nodeType==3||sc.nodeType==4)?sc.data.slice(this.startOffset,this.endOffset):""}else{var textBits=[],iterator=new RangeIterator(this,true);iterateSubtree(iterator,function(node){if(node.nodeType==3||node.nodeType==4){textBits.push(node.data)}});iterator.detach();return textBits.join("")}},compareNode:function(node){assertNotDetached(this);assertRangeValid(this);var parent=node.parentNode;var nodeIndex=dom.getNodeIndex(node);if(!parent){throw new DOMException("NOT_FOUND_ERR")}var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);if(startComparison<0){return(endComparison>0)?n_b_a:n_b}else{return(endComparison>0)?n_a:n_i}},comparePoint:function(node,offset){assertNotDetached(this);assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);if(dom.comparePoints(node,offset,this.startContainer,this.startOffset)<0){return -1}else{if(dom.comparePoints(node,offset,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:function(html){assertNotDetached(this);var doc=getRangeDocument(this);var container=doc.createElement("div");container.innerHTML=html;var frag=doc.createDocumentFragment(),n;while((n=container.firstChild)){frag.appendChild(n)}return frag},intersectsNode:function(node,touchingIsIntersecting){assertNotDetached(this);assertRangeValid(this);assertNode(node,"NOT_FOUND_ERR");if(dom.getDocument(node)!==getRangeDocument(this)){return false}var parent=node.parentNode,offset=dom.getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=dom.comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=dom.comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0},isPointInRange:function(node,offset){assertNotDetached(this);assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);return(dom.comparePoints(node,offset,this.startContainer,this.startOffset)>=0)&&(dom.comparePoints(node,offset,this.endContainer,this.endOffset)<=0)},intersectsRange:function(range){assertNotDetached(this);assertRangeValid(this);if(getRangeDocument(range)!=getRangeDocument(this)){throw new DOMException("WRONG_DOCUMENT_ERR")}return dom.comparePoints(this.startContainer,this.startOffset,range.endContainer,range.endOffset)<0&&dom.comparePoints(this.endContainer,this.endOffset,range.startContainer,range.startOffset)>0},intersection:function(range){if(this.intersectsRange(range)){var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);var intersectionRange=this.cloneRange();if(startComparison==-1){intersectionRange.setStart(range.startContainer,range.startOffset)}if(endComparison==1){intersectionRange.setEnd(range.endContainer,range.endOffset)}return intersectionRange}return null},containsNode:function(node,allowPartial){if(allowPartial){return this.intersectsNode(node,false)}else{return this.compareNode(node)==n_i}},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,getEndOffset(node))<=0},splitBoundaries:function(){assertNotDetached(this);assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var startEndSame=(sc===ec);if(dom.isCharacterDataNode(ec)&&eo<ec.length){dom.splitDataNode(ec,eo)}if(dom.isCharacterDataNode(sc)&&so>0){sc=dom.splitDataNode(sc,so);if(startEndSame){eo-=so;ec=sc}so=0}boundaryUpdater(this,sc,so,ec,eo)},normalizeBoundaries:function(){assertNotDetached(this);assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var mergeForward=function(node){var sibling=node.nextSibling;if(sibling&&sibling.nodeType==node.nodeType){ec=node;eo=node.length;node.appendData(sibling.data);sibling.parentNode.removeChild(sibling)}};var mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;so=sibling.length;node.insertData(0,sibling.data);sibling.parentNode.removeChild(sibling);if(sc==ec){eo+=so;ec=sc}}};var normalizeStart=true;if(dom.isCharacterDataNode(ec)){if(ec.length==eo){mergeForward(ec)}}else{if(eo>0){var endNode=ec.childNodes[eo-1];if(endNode&&dom.isCharacterDataNode(endNode)){mergeForward(endNode)}}normalizeStart=!this.collapsed}if(normalizeStart){if(dom.isCharacterDataNode(sc)){if(so==0){mergeBackward(sc)}}else{if(so<sc.childNodes.length){var startNode=sc.childNodes[so];if(startNode&&dom.isCharacterDataNode(startNode)){mergeBackward(startNode)}}}}else{sc=ec;so=eo}boundaryUpdater(this,sc,so,ec,eo)},createNodeIterator:function(nodeTypes,filter){assertNotDetached(this);assertRangeValid(this);return new RangeNodeIterator(this,nodeTypes,filter)},getNodes:function(nodeTypes,filter){assertNotDetached(this);assertRangeValid(this);return getNodesInRange(this,nodeTypes,filter)},collapseToPoint:function(node,offset){assertNotDetached(this);assertRangeValid(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStartAndEnd(this,node,offset)},collapseBefore:function(node){assertNotDetached(this);this.setEndBefore(node);this.collapse(false)},collapseAfter:function(node){assertNotDetached(this);this.setStartAfter(node);this.collapse(true)},getName:function(){return"DomRange"},equals:function(range){return Range.rangesEqual(this,range)},inspect:function(){return inspect(this)}};copyComparisonConstants(constructor)}function updateCollapsedAndCommonAncestor(range){range.collapsed=(range.startContainer===range.endContainer&&range.startOffset===range.endOffset);range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer)}function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!==startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!==endOffset);range.startContainer=startContainer;range.startOffset=startOffset;range.endContainer=endContainer;range.endOffset=endOffset;updateCollapsedAndCommonAncestor(range);dispatchEvent(range,"boundarychange",{startMoved:startMoved,endMoved:endMoved})}function detach(range){assertNotDetached(range);range.startContainer=range.startOffset=range.endContainer=range.endOffset=null;range.collapsed=range.commonAncestorContainer=null;dispatchEvent(range,"detach",null);range._listeners=null}function Range(doc){this.startContainer=doc;this.startOffset=0;this.endContainer=doc;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};updateCollapsedAndCommonAncestor(this)}createPrototypeRange(Range,updateBoundaries,detach);Range.fromRange=function(r){var range=new Range(getRangeDocument(r));updateBoundaries(range,r.startContainer,r.startOffset,r.endContainer,r.endOffset);return range};Range.rangeProperties=rangeProperties;Range.RangeIterator=RangeIterator;Range.copyComparisonConstants=copyComparisonConstants;Range.createPrototypeRange=createPrototypeRange;Range.inspect=inspect;Range.getRangeDocument=getRangeDocument;Range.rangesEqual=function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset};Range.getEndOffset=getEndOffset;api.DomRange=Range;api.RangeException=RangeException});rangy.createModule("WrappedRange",function(api,module){api.requireModules(["DomUtil","DomRange"]);var WrappedRange;var dom=api.dom;var DomPosition=dom.DomPosition;var DomRange=api.DomRange;function getTextRangeContainerElement(textRange){var parentEl=textRange.parentElement();var range=textRange.duplicate();range.collapse(true);var startEl=range.parentElement();range=textRange.duplicate();range.collapse(false);var endEl=range.parentElement();var startEndContainer=(startEl==endEl)?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer)}function textRangeIsCollapsed(textRange){return textRange.compareEndPoints("StartToEnd",textRange)==0}function getTextRangeBoundaryPosition(textRange,wholeRangeContainerElement,isStart,isCollapsed){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(!dom.isAncestorOf(wholeRangeContainerElement,containerElement,true)){containerElement=wholeRangeContainerElement}if(!containerElement.canHaveHTML){return new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement))}var workingNode=dom.getDocument(containerElement).createElement("span");var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";var previousNode,nextNode,boundaryPosition,boundaryNode;do{containerElement.insertBefore(workingNode,workingNode.previousSibling);workingRange.moveToElementText(workingNode)}while((comparison=workingRange.compareEndPoints(workingComparisonType,textRange))>0&&workingNode.previousSibling);boundaryNode=workingNode.nextSibling;if(comparison==-1&&boundaryNode&&dom.isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate();var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;offset=tempRange.moveStart("character",rangeLength);while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){offset++;tempRange.moveStart("character",1)}}else{offset=workingRange.text.length}boundaryPosition=new DomPosition(boundaryNode,offset)}else{previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;if(nextNode&&dom.isCharacterDataNode(nextNode)){boundaryPosition=new DomPosition(nextNode,0)}else{if(previousNode&&dom.isCharacterDataNode(previousNode)){boundaryPosition=new DomPosition(previousNode,previousNode.length)}else{boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode))}}}workingNode.parentNode.removeChild(workingNode);return boundaryPosition}function createBoundaryTextRange(boundaryPosition,isStart){var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;var doc=dom.getDocument(boundaryPosition.node);var workingNode,childNodes,workingRange=doc.body.createTextRange();var nodeIsDataNode=dom.isCharacterDataNode(boundaryPosition.node);if(nodeIsDataNode){boundaryNode=boundaryPosition.node;boundaryParent=boundaryNode.parentNode}else{childNodes=boundaryPosition.node.childNodes;boundaryNode=(boundaryOffset<childNodes.length)?childNodes[boundaryOffset]:null;boundaryParent=boundaryPosition.node}workingNode=doc.createElement("span");workingNode.innerHTML="&#feff;";if(boundaryNode){boundaryParent.insertBefore(workingNode,boundaryNode)}else{boundaryParent.appendChild(workingNode)}workingRange.moveToElementText(workingNode);workingRange.collapse(!isStart);boundaryParent.removeChild(workingNode);if(nodeIsDataNode){workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset)}return workingRange}if(api.features.implementsDomRange){(function(){var rangeProto;var rangeProperties=DomRange.rangeProperties;var canSetRangeStartAfterEnd;function updateRangeProperties(range){var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=range.nativeRange[prop]}}function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!=startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!=endOffset);if(endMoved){range.setEnd(endContainer,endOffset)}if(startMoved){range.setStart(startContainer,startOffset)}}function detach(range){range.nativeRange.detach();range.detached=true;var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=null}}var createBeforeAfterNodeSetter;WrappedRange=function(range){if(!range){throw new Error("Range must be specified")}this.nativeRange=range;updateRangeProperties(this)};DomRange.createPrototypeRange(WrappedRange,updateNativeRange,detach);rangeProto=WrappedRange.prototype;rangeProto.selectNode=function(node){this.nativeRange.selectNode(node);updateRangeProperties(this)};rangeProto.deleteContents=function(){this.nativeRange.deleteContents();updateRangeProperties(this)};rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();updateRangeProperties(this);return frag};rangeProto.cloneContents=function(){return this.nativeRange.cloneContents()};rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node);updateRangeProperties(this)};rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart);updateRangeProperties(this)};rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange())};rangeProto.refresh=function(){updateRangeProperties(this)};rangeProto.toString=function(){return this.nativeRange.toString()};var testTextNode=document.createTextNode("test");dom.getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0);range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1);canSetRangeStartAfterEnd=true;rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset);updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset);updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node);updateRangeProperties(this)}}}catch(ex){canSetRangeStartAfterEnd=false;rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset)}catch(ex){this.nativeRange.setEnd(node,offset);this.nativeRange.setStart(node,offset)}updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset)}catch(ex){this.nativeRange.setStart(node,offset);this.nativeRange.setEnd(node,offset)}updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node)}catch(ex){this.nativeRange[oppositeName](node);this.nativeRange[name](node)}updateRangeProperties(this)}}}rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");range.selectNodeContents(testTextNode);if(range.startContainer==testTextNode&&range.endContainer==testTextNode&&range.startOffset==0&&range.endOffset==testTextNode.length){rangeProto.selectNodeContents=function(node){this.nativeRange.selectNodeContents(node);updateRangeProperties(this)}}else{rangeProto.selectNodeContents=function(node){this.setStart(node,0);this.setEnd(node,DomRange.getEndOffset(node))}}range.selectNodeContents(testTextNode);range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode);range2.setEnd(testTextNode,4);range2.setStart(testTextNode,2);if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&&range.compareBoundaryPoints(range.END_TO_START,range2)==1){rangeProto.compareBoundaryPoints=function(type,range){range=range.nativeRange||range;if(type==range.START_TO_END){type=range.END_TO_START}else{if(type==range.END_TO_START){type=range.START_TO_END}}return this.nativeRange.compareBoundaryPoints(type,range)}}else{rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range)}}dom.getBody(document).removeChild(testTextNode);range.detach();range2.detach()})()}else{if(api.features.implementsTextRange){WrappedRange=function(textRange){this.textRange=textRange;this.refresh()};WrappedRange.prototype=new DomRange(document);WrappedRange.prototype.refresh=function(){var start,end;var rangeContainerElement=getTextRangeContainerElement(this.textRange);if(textRangeIsCollapsed(this.textRange)){end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true)}else{start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false)}this.setStart(start.node,start.offset);this.setEnd(end.node,end.offset)};WrappedRange.rangeToTextRange=function(range){if(range.collapsed){return createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true,true)}else{var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true,false);var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false,false);var textRange=dom.getDocument(range.startContainer).body.createTextRange();textRange.setEndPoint("StartToStart",startRange);textRange.setEndPoint("EndToEnd",endRange);return textRange}};DomRange.copyComparisonConstants(WrappedRange);var globalObj=(function(){return this})();if(typeof globalObj.Range=="undefined"){globalObj.Range=WrappedRange}}}WrappedRange.prototype.getName=function(){return"WrappedRange"};api.WrappedRange=WrappedRange;api.createNativeRange=function(doc){doc=doc||document;if(api.features.implementsDomRange){return doc.createRange()}else{if(api.features.implementsTextRange){return doc.body.createTextRange()}}};api.createRange=function(doc){doc=doc||document;return new WrappedRange(api.createNativeRange(doc))};api.createRangyRange=function(doc){doc=doc||document;return new DomRange(doc)};api.createIframeRange=function(iframeEl){return api.createRange(dom.getIframeDocument(iframeEl))};api.createIframeRangyRange=function(iframeEl){return api.createRangyRange(dom.getIframeDocument(iframeEl))};api.addCreateMissingNativeApiListener(function(win){var doc=win.document;if(typeof doc.createRange=="undefined"){doc.createRange=function(){return api.createRange(this)}}doc=win=null})});rangy.createModule("WrappedSelection",function(api,module){api.requireModules(["DomUtil","DomRange","WrappedRange"]);api.config.checkSelectionRanges=true;var BOOLEAN="boolean",windowPropertyName="_rangySelection";var dom=api.dom;var util=api.util;var DomRange=api.DomRange;var WrappedRange=api.WrappedRange;var DOMException=api.DOMException;var DomPosition=dom.DomPosition;var getSelection,selectionIsCollapsed;if(api.util.isHostMethod(window,"getSelection")){getSelection=function(winParam){return(winParam||window).getSelection()}}else{if(api.util.isHostObject(document,"selection")){getSelection=function(winParam){return((winParam||window).document.selection)}}else{module.fail("No means of obtaining a selection object")}}api.getNativeSelection=getSelection;var testSelection=getSelection();var testRange=api.createNativeRange(document);var body=dom.getBody(document);var selectionHasAnchorAndFocus=util.areHostObjects(testSelection,["anchorNode","focusNode"]&&util.areHostProperties(testSelection,["anchorOffset","focusOffset"]));api.features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=util.isHostMethod(testSelection,"extend");api.features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=(typeof testSelection.rangeCount=="number");api.features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=false;var collapsedNonEditableSelectionsSupported=true;if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount=="number"&&api.features.implementsDomRange){(function(){var textNode1=body.appendChild(document.createTextNode("One"));var textNode2=body.appendChild(document.createTextNode("Two"));var testRange2=api.createNativeRange(document);testRange2.selectNodeContents(textNode1);var testRange3=api.createNativeRange(document);testRange3.selectNodeContents(textNode2);testSelection.removeAllRanges();testSelection.addRange(testRange2);testSelection.addRange(testRange3);selectionSupportsMultipleRanges=(testSelection.rangeCount==2);testSelection.removeAllRanges();textNode1.parentNode.removeChild(textNode1);textNode2.parentNode.removeChild(textNode2);var el=document.createElement("p");el.contentEditable=false;var textNode3=el.appendChild(document.createTextNode("test"));body.appendChild(el);var testRange4=api.createRange();testRange4.collapseToPoint(textNode3,1);testSelection.addRange(testRange4.nativeRange);collapsedNonEditableSelectionsSupported=(testSelection.rangeCount==1);testSelection.removeAllRanges();body.removeChild(el)})()}api.features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;api.features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var selectionHasType=util.isHostProperty(testSelection,"type");var implementsControlRange=false,testControlRange;if(body&&util.isHostMethod(body,"createControlRange")){testControlRange=body.createControlRange();if(util.areHostProperties(testControlRange,["item","add"])){implementsControlRange=true}}api.features.implementsControlRange=implementsControlRange;if(selectionHasAnchorAndFocus){selectionIsCollapsed=function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset}}else{selectionIsCollapsed=function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false}}function updateAnchorAndFocusFromRange(sel,range,backwards){var anchorPrefix=backwards?"end":"start",focusPrefix=backwards?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"];sel.anchorOffset=range[anchorPrefix+"Offset"];sel.focusNode=range[focusPrefix+"Container"];sel.focusOffset=range[focusPrefix+"Offset"]}function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode;sel.anchorOffset=nativeSel.anchorOffset;sel.focusNode=nativeSel.focusNode;sel.focusOffset=nativeSel.focusOffset}function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null;sel.anchorOffset=sel.focusOffset=0;sel.rangeCount=0;sel.isCollapsed=true;sel._ranges.length=0}function getNativeRange(range){var nativeRange;if(range instanceof DomRange){nativeRange=range._selectionNativeRange;if(!nativeRange){nativeRange=api.createNativeRange(dom.getDocument(range.startContainer));nativeRange.setEnd(range.endContainer,range.endOffset);nativeRange.setStart(range.startContainer,range.startOffset);range._selectionNativeRange=nativeRange;range.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(range instanceof WrappedRange){nativeRange=range.nativeRange}else{if(window.Range&&(range instanceof Range)){nativeRange=range}}}return nativeRange}function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||rangeNodes[0].nodeType!=1){return false}for(var i=1,len=rangeNodes.length;i<len;++i){if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){return false}}return true}function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes)){throw new Error("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element")}return nodes[0]}function updateFromControlRange(sel){sel._ranges.length=0;if(sel.nativeSelection.type=="None"){updateEmptySelection(sel)}else{var controlRange=sel.nativeSelection.createRange();sel.rangeCount=controlRange.length;var range,doc=dom.getDocument(controlRange.item(0));for(var i=0;i<sel.rangeCount;++i){range=api.createRange(doc);range.selectNode(controlRange.item(i));sel._ranges.push(range)}sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false)}}var getSelectionRangeAt;if(util.isHostMethod(testSelection,"getRangeAt")){getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index)}catch(ex){return null}}}else{if(selectionHasAnchorAndFocus){getSelectionRangeAt=function(sel){var doc=dom.getDocument(sel.anchorNode);var range=api.createRange(doc);range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);if(range.collapsed!==this.isCollapsed){range.setStart(sel.focusNode,sel.focusOffset);range.setEnd(sel.anchorNode,sel.anchorOffset)}return range}}}function WrappedSelection(selection){this.nativeSelection=selection;this._ranges=[];this.refresh()}api.getSelection=function(win){win=win||window;var sel=win[windowPropertyName];if(sel){sel.nativeSelection=getSelection(win);sel.refresh()}else{sel=new WrappedSelection(getSelection(win));win[windowPropertyName]=sel}return sel};api.getIframeSelection=function(iframeEl){return api.getSelection(dom.getIframeWindow(iframeEl))};var selProto=WrappedSelection.prototype;if(selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges();updateEmptySelection(this)};var addRangeBackwards=function(sel,range){var doc=DomRange.getRangeDocument(range);var endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset);sel.nativeSelection.addRange(getNativeRange(endRange));sel.nativeSelection.extend(range.startContainer,range.startOffset);sel.refresh()};if(selectionHasRangeCount){selProto.addRange=function(range,backwards){if(backwards&&selectionHasExtend){addRangeBackwards(this,range)}else{var previousRangeCount;if(selectionSupportsMultipleRanges){previousRangeCount=this.rangeCount}else{this.removeAllRanges();previousRangeCount=0}this.nativeSelection.addRange(getNativeRange(range));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);if(nativeRange&&!DomRange.rangesEqual(nativeRange,range)){range=new WrappedRange(nativeRange)}}this._ranges[this.rangeCount-1]=range;updateAnchorAndFocusFromRange(this,range,selectionIsBackwards(this.nativeSelection));this.isCollapsed=selectionIsCollapsed(this)}else{this.refresh()}}}}else{selProto.addRange=function(range,backwards){if(backwards&&selectionHasExtend){addRangeBackwards(this,range)}else{this.nativeSelection.addRange(getNativeRange(range));this.refresh()}}}selProto.setRanges=function(ranges){this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){this.addRange(ranges[i])}}}else{if(util.isHostMethod(testSelection,"empty")&&util.isHostMethod(testRange,"select")&&selectionHasType&&implementsControlRange){selProto.removeAllRanges=function(){try{this.nativeSelection.empty();if(this.nativeSelection.type!="None"){var doc;if(this.anchorNode){doc=dom.getDocument(this.anchorNode)}else{if(this.nativeSelection.type=="Control"){var controlRange=this.nativeSelection.createRange();if(controlRange.length){doc=dom.getDocument(controlRange.item(0)).body.createTextRange()}}}if(doc){var textRange=doc.body.createTextRange();textRange.select();this.nativeSelection.empty()}}}catch(ex){}updateEmptySelection(this)};selProto.addRange=function(range){if(this.nativeSelection.type=="Control"){var controlRange=this.nativeSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();for(var i=0,len=controlRange.length;i<len;++i){newControlRange.add(controlRange.item(i))}try{newControlRange.add(rangeElement)}catch(ex){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlRange.select();updateFromControlRange(this)}else{WrappedRange.rangeToTextRange(range).select();this._ranges[0]=range;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;updateAnchorAndFocusFromRange(this,range,false)}};selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;if(rangeCount>1){var doc=dom.getDocument(ranges[0].startContainer);var controlRange=dom.getBody(doc).createControlRange();for(var i=0,el;i<rangeCount;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el)}catch(ex){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlRange.select();updateFromControlRange(this)}else{if(rangeCount){this.addRange(ranges[0])}}}}else{module.fail("No means of selecting a Range or TextRange was found");return false}}selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount){throw new DOMException("INDEX_SIZE_ERR")}else{return this._ranges[index]}};var refreshSelection;if(util.isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount=="number"){refreshSelection=function(sel){sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;if(sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i){sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i))}updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackwards(sel.nativeSelection));sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}else{if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&api.features.implementsDomRange){refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;if(nativeSel.anchorNode){range=getSelectionRangeAt(nativeSel,0);sel._ranges=[range];sel.rangeCount=1;updateAnchorAndFocusFromNativeSelection(sel);sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}else{if(util.isHostMethod(testSelection,"createRange")&&api.features.implementsTextRange){refreshSelection=function(sel){var range=sel.nativeSelection.createRange(),wrappedRange;if(sel.nativeSelection.type=="Control"){updateFromControlRange(sel)}else{if(range&&typeof range.text!="undefined"){wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange];updateAnchorAndFocusFromRange(sel,wrappedRange,false);sel.rangeCount=1;sel.isCollapsed=wrappedRange.collapsed}else{updateEmptySelection(sel)}}}}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null;refreshSelection(this);if(checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length){return false}while(i--){if(!DomRange.rangesEqual(oldRanges[i],this._ranges[i])){return false}}return true}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges(),removed=false;sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){if(removed||range!==ranges[i]){sel.addRange(ranges[i])}else{removed=true}}if(!sel.rangeCount){updateEmptySelection(sel)}};if(selectionHasType&&implementsControlRange){selProto.removeRange=function(range){if(this.nativeSelection.type=="Control"){var controlRange=this.nativeSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();var el,removed=false;for(var i=0,len=controlRange.length;i<len;++i){el=controlRange.item(i);if(el!==rangeElement||removed){newControlRange.add(controlRange.item(i))}else{removed=true}}newControlRange.select();updateFromControlRange(this)}else{removeRangeManually(this,range)}}}else{selProto.removeRange=function(range){removeRangeManually(this,range)}}var selectionIsBackwards;if(selectionHasAnchorAndFocus&&api.features.implementsDomRange){selectionIsBackwards=function(sel){var backwards=false;if(sel.anchorNode){backwards=(dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1)}return backwards};selProto.isBackwards=function(){return selectionIsBackwards(this)}}else{selectionIsBackwards=selProto.isBackwards=function(){return false}}selProto.toString=function(){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=""+this._ranges[i]}return rangeTexts.join("")};function assertNodeInSameDocument(sel,node){if(sel.anchorNode&&(dom.getDocument(sel.anchorNode)!==dom.getDocument(node))){throw new DOMException("WRONG_DOCUMENT_ERR")}}selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.collapseToPoint(node,offset);this.removeAllRanges();this.addRange(range);this.isCollapsed=true};selProto.collapseToStart=function(){if(this.rangeCount){var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.collapseToEnd=function(){if(this.rangeCount){var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.selectNodeContents(node);this.removeAllRanges();this.addRange(range)};selProto.deleteFromDocument=function(){if(this.rangeCount){var ranges=this.getAllRanges();this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){ranges[i].deleteContents()}this.addRange(ranges[len-1])}};selProto.getAllRanges=function(){return this._ranges.slice(0)};selProto.setSingleRange=function(range){this.setRanges([range])};selProto.containsNode=function(node,allowPartial){for(var i=0,len=this._ranges.length;i<len;++i){if(this._ranges[i].containsNode(node,allowPartial)){return true}}return false};function inspect(sel){var rangeInspects=[];var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);var focus=new DomPosition(sel.focusNode,sel.focusOffset);var name=(typeof sel.getName=="function")?sel.getName():"Selection";if(typeof sel.rangeCount!="undefined"){for(var i=0,len=sel.rangeCount;i<len;++i){rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i))}}return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]"}selProto.getName=function(){return"WrappedSelection"};selProto.inspect=function(){return inspect(this)};selProto.detach=function(){if(this.anchorNode){dom.getWindow(this.anchorNode)[windowPropertyName]=null}};WrappedSelection.inspect=inspect;api.Selection=WrappedSelection;api.addCreateMissingNativeApiListener(function(win){if(typeof win.getSelection=="undefined"){win.getSelection=function(){return api.getSelection(this)}}win=null})});
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
jQuery.fn.aloha=function(){return this.each(function(){if(!GENTICS.Aloha.isEditable(this)){new GENTICS.Aloha.Editable(jQuery(this))}})};jQuery.fn.GENTICS_aloha=function(){return this.each(function(){if(!GENTICS.Aloha.isEditable(this)){new GENTICS.Aloha.Editable(jQuery(this))}})};jQuery.fn.mahalo=function(){return this.each(function(){if(GENTICS.Aloha.isEditable(this)){GENTICS.Aloha.getEditableById(jQuery(this).attr("id")).destroy()}})};jQuery.fn.GENTICS_mahalo=function(){return this.each(function(){var that=this})};jQuery.fn.GENTICS_contentEditableSelectionChange=function(callback){var that=this;this.keyup(function(event){var rangeObject=GENTICS.Aloha.Selection.getRangeObject();callback(event)});this.dblclick(function(event){callback(event)});this.mousedown(function(event){that.selectionStarted=true});jQuery(document).mouseup(function(event){GENTICS.Aloha.Selection.eventOriginalTarget=that;if(that.selectionStarted){callback(event)}GENTICS.Aloha.Selection.eventOriginalTarget=false;that.selectionStarted=false});return this};jQuery.fn.outerHTML=function(s){if(s){return this.before(s).remove()}else{return jQuery("<p>").append(this.eq(0).clone()).html()}};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Log=function(){};GENTICS.Aloha.Log.prototype.logHistory=null;GENTICS.Aloha.Log.prototype.highWaterMarkReached=false;GENTICS.Aloha.Log.prototype.init=function(){if(typeof GENTICS.Aloha.settings.logLevels=="undefined"||!GENTICS.Aloha.settings.logLevels){GENTICS.Aloha.settings.logLevels={error:true,warn:true}}if(typeof GENTICS.Aloha.settings.logHistory=="undefined"||!GENTICS.Aloha.settings.logHistory){GENTICS.Aloha.settings.logHistory={}}if(!GENTICS.Aloha.settings.logHistory.maxEntries){GENTICS.Aloha.settings.logHistory.maxEntries=100}if(!GENTICS.Aloha.settings.logHistory.highWaterMark){GENTICS.Aloha.settings.logHistory.highWaterMark=90}if(!GENTICS.Aloha.settings.logHistory.levels){GENTICS.Aloha.settings.logHistory.levels={error:true,warn:true}}this.flushLogHistory()};GENTICS.Aloha.Log.prototype.log=function(level,component,message){if(typeof level=="undefined"||!level){level="error"}level=level.toLowerCase();if(!GENTICS.Aloha.settings.logLevels[level]){return}this.addToLogHistory({level:level,component:component.toString(),message:message,date:new Date()});switch(level){case"error":if(window.console&&console.error){console.error(component.toString()+": "+message)}break;case"warn":if(window.console&&console.warn){console.warn(component.toString()+": "+message)}break;case"info":if(window.console&&console.info){console.info(component.toString()+": "+message)}break;case"debug":if(window.console&&console.log){console.log(component.toString()+" ["+level+"]: "+message)}break;default:if(window.console&&console.log){console.log(component.toString()+" ["+level+"]: "+message)}break}};GENTICS.Aloha.Log.prototype.error=function(component,message){this.log("error",component,message)};GENTICS.Aloha.Log.prototype.warn=function(component,message){this.log("warn",component,message)};GENTICS.Aloha.Log.prototype.info=function(component,message){this.log("info",component,message)};GENTICS.Aloha.Log.prototype.debug=function(component,message){this.log("debug",component,message)};GENTICS.Aloha.Log.prototype.isLogLevelEnabled=function(level){return GENTICS.Aloha.settings&&GENTICS.Aloha.settings.logLevels&&(GENTICS.Aloha.settings.logLevels[level]==true)};GENTICS.Aloha.Log.prototype.isErrorEnabled=function(){return this.isLogLevelEnabled("error")};GENTICS.Aloha.Log.prototype.isWarnEnabled=function(){return this.isLogLevelEnabled("warn")};GENTICS.Aloha.Log.prototype.isInfoEnabled=function(){return this.isLogLevelEnabled("info")};GENTICS.Aloha.Log.prototype.isDebugEnabled=function(){return this.isLogLevelEnabled("debug")};GENTICS.Aloha.Log.prototype.addToLogHistory=function(entry){if(GENTICS.Aloha.settings.logHistory.maxEntries<=0){return}if(!GENTICS.Aloha.settings.logHistory.levels[entry.level]){return}this.logHistory.push(entry);if(this.highWaterMarkReached==false){if(this.logHistory.length>=GENTICS.Aloha.settings.logHistory.maxEntries*GENTICS.Aloha.settings.logHistory.highWaterMark/100){GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("logFull",GENTICS.Aloha.Log));this.highWaterMarkReached=true}}while(this.logHistory.length>GENTICS.Aloha.settings.logHistory.maxEntries){this.logHistory.shift()}};GENTICS.Aloha.Log.prototype.getLogHistory=function(){return this.logHistory};GENTICS.Aloha.Log.prototype.flushLogHistory=function(){this.logHistory=new Array();this.highWaterMarkReached=false};GENTICS.Aloha.Log=new GENTICS.Aloha.Log();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Markup=function(){};GENTICS.Aloha.Markup.prototype.keyHandlers={};GENTICS.Aloha.Markup.prototype.addKeyHandler=function(keyCode,handler){if(!this.keyHandlers[keyCode]){this.keyHandlers[keyCode]=[]}this.keyHandlers[keyCode].push(handler)};GENTICS.Aloha.Markup.prototype.insertBreak=function(){var range=GENTICS.Aloha.Selection.rangeObject;if(!range.isCollapsed()){this.removeSelectedMarkup()}var newBreak=jQuery("<br/>");GENTICS.Utils.Dom.insertIntoDOM(newBreak,range,GENTICS.Aloha.activeEditable.obj);var nextTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(newBreak.parent().get(0),GENTICS.Utils.Dom.getIndexInParent(newBreak.get(0))+1,false);if(nextTextNode){var nonWSIndex=nextTextNode.data.search(/\S/);if(nonWSIndex>0){nextTextNode.data=nextTextNode.data.substring(nonWSIndex)}}range.startContainer=range.endContainer=newBreak.get(0).parentNode;range.startOffset=range.endOffset=GENTICS.Utils.Dom.getIndexInParent(newBreak.get(0))+1;range.correctRange();range.clearCaches();range.select()};GENTICS.Aloha.Markup.prototype.preProcessKeyStrokes=function(event){if(event.type!="keydown"){return false}var rangeObject=GENTICS.Aloha.Selection.rangeObject;if(this.keyHandlers[event.keyCode]){var handlers=this.keyHandlers[event.keyCode];for(var i=0;i<handlers.length;++i){if(!handlers[i](event)){return false}}}switch(event.keyCode){case 13:if(event.shiftKey){GENTICS.Aloha.Log.debug(this,"... got a smoking Shift+Enter, Cowboy");if(!rangeObject.isCollapsed()){this.removeSelectedMarkup()}GENTICS.Aloha.Selection.updateSelection(false,true);this.processShiftEnter(rangeObject);return false}else{GENTICS.Aloha.Log.debug(this,"... got a lonely Enter, Mum");if(!rangeObject.isCollapsed()){this.removeSelectedMarkup()}GENTICS.Aloha.Selection.updateSelection(false,true);this.processEnter(rangeObject);return false}break}return true};GENTICS.Aloha.Markup.prototype.processShiftEnter=function(rangeObject){this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject)};GENTICS.Aloha.Markup.prototype.processEnter=function(rangeObject){if(rangeObject.splitObject){this.splitRangeObject(rangeObject)}else{this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject)}};GENTICS.Aloha.Markup.prototype.insertHTMLCode=function(html){var rangeObject=GENTICS.Aloha.Selection.rangeObject;this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject,jQuery(html))};GENTICS.Aloha.Markup.prototype.insertHTMLBreak=function(selectionTree,rangeObject,inBetweenMarkup){inBetweenMarkup=inBetweenMarkup?inBetweenMarkup:jQuery("<br />");for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];var jqEl=el.domobj?jQuery(el.domobj):undefined;if(el.selection!=="none"){if(el.selection=="collapsed"){if(i>0){var jqElBefore=jQuery(selectionTree[i-1].domobj);jqElBefore.after(inBetweenMarkup)}else{var jqElAfter=jQuery(selectionTree[1].domobj);jqElAfter.before(inBetweenMarkup)}rangeObject.startContainer=rangeObject.endContainer=inBetweenMarkup[0].parentNode;rangeObject.startOffset=rangeObject.endOffset=GENTICS.Utils.Dom.getIndexInParent(inBetweenMarkup[0])+1;rangeObject.correctRange()}else{if(el.domobj&&el.domobj.nodeType===3){if(el.domobj.nextSibling&&el.domobj.nextSibling.nodeType==1&&GENTICS.Aloha.Selection.replacingElements[el.domobj.nextSibling.nodeName.toLowerCase()]){jqEl.after("<br/>")}if(this.needEndingBreak()){var checkObj=el.domobj;while(checkObj){if(checkObj.nextSibling){checkObj=false}else{checkObj=checkObj.parentNode;if(GENTICS.Utils.Dom.isBlockLevelElement(checkObj)){break}if(checkObj===rangeObject.limitObject){checkObj=false}}}if(checkObj){jQuery(checkObj).append('<br class="GENTICS_cleanme"/>')}}jqEl.between(inBetweenMarkup,el.startOffset);var offset=0;var tmpObject=inBetweenMarkup[0];while(tmpObject){tmpObject=tmpObject.previousSibling;offset++}rangeObject.startContainer=inBetweenMarkup[0].parentNode;rangeObject.endContainer=inBetweenMarkup[0].parentNode;rangeObject.startOffset=offset;rangeObject.endOffset=offset;rangeObject.correctRange()}else{if(el.domobj&&el.domobj.nodeType===1){if(jqEl.parent().find("br.GENTICS_ephemera").length===0){jQuery(rangeObject.limitObject).find("br.GENTICS_ephemera").remove();jQuery(rangeObject.commonAncestorContainer).append(this.getFillUpElement(rangeObject.splitObject))}jqEl.after(inBetweenMarkup);rangeObject.startContainer=rangeObject.commonAncestorContainer;rangeObject.endContainer=rangeObject.startContainer;rangeObject.startOffset=i+2;rangeObject.endOffset=i+2;rangeObject.update()}}}}}rangeObject.select()};GENTICS.Aloha.Markup.prototype.needEndingBreak=function(){return !jQuery.browser.msie};GENTICS.Aloha.Markup.prototype.getSelectedText=function(){var rangeObject=GENTICS.Aloha.Selection.rangeObject;if(rangeObject.isCollapsed()){return false}return this.getFromSelectionTree(rangeObject.getSelectionTree(),true)};GENTICS.Aloha.Markup.prototype.getFromSelectionTree=function(selectionTree,astext){var text="";for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if(el.selection=="partial"){if(el.domobj.nodeType==3){text+=el.domobj.data.substring(el.startOffset,el.endOffset)}else{if(el.domobj.nodeType==1&&el.children){if(astext){text+=this.getFromSelectionTree(el.children,astext)}else{var clone=jQuery(el.domobj).clone(false).empty();clone.html(this.getFromSelectionTree(el.children,astext));text+=clone.outerHTML()}}}}else{if(el.selection=="full"){if(el.domobj.nodeType==3){text+=jQuery(el.domobj).text()}else{if(el.domobj.nodeType==1&&el.children){text+=astext?jQuery(el.domobj).text():jQuery(el.domobj).outerHTML()}}}}}return text};GENTICS.Aloha.Markup.prototype.getSelectedMarkup=function(){var rangeObject=GENTICS.Aloha.Selection.rangeObject;if(rangeObject.isCollapsed()){return false}return this.getFromSelectionTree(rangeObject.getSelectionTree(),false)};GENTICS.Aloha.Markup.prototype.removeSelectedMarkup=function(){var rangeObject=GENTICS.Aloha.Selection.rangeObject;if(rangeObject.isCollapsed()){return}var newRange=new GENTICS.Aloha.Selection.SelectionRange();this.removeFromSelectionTree(rangeObject.getSelectionTree(),newRange);newRange.update();GENTICS.Utils.Dom.doCleanup({merge:true,removeempty:true},GENTICS.Aloha.Selection.rangeObject);GENTICS.Aloha.Selection.rangeObject=newRange;newRange.correctRange();newRange.update();newRange.select();GENTICS.Aloha.Selection.updateSelection()};GENTICS.Aloha.Markup.prototype.removeFromSelectionTree=function(selectionTree,newRange){var firstPartialElement=undefined;for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if(el.selection=="partial"){if(el.domobj.nodeType==3){var newdata="";if(el.startOffset>0){newdata+=el.domobj.data.substring(0,el.startOffset)}if(el.endOffset<el.domobj.data.length){newdata+=el.domobj.data.substring(el.endOffset,el.domobj.data.length)}el.domobj.data=newdata;if(!newRange.startContainer){newRange.startContainer=newRange.endContainer=el.domobj;newRange.startOffset=newRange.endOffset=el.startOffset}}else{if(el.domobj.nodeType==1&&el.children){this.removeFromSelectionTree(el.children,newRange);if(firstPartialElement){if(firstPartialElement.nodeName==el.domobj.nodeName){jQuery(firstPartialElement).append(jQuery(el.domobj).contents());jQuery(el.domobj).remove()}}else{firstPartialElement=el.domobj}}}}else{if(el.selection=="full"){if(!newRange.startContainer){var adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(el.domobj.parentNode,GENTICS.Utils.Dom.getIndexInParent(el.domobj)+1,false,{blocklevel:false});if(adjacentTextNode){newRange.startContainer=newRange.endContainer=adjacentTextNode;newRange.startOffset=newRange.endOffset=0}else{newRange.startContainer=newRange.endContainer=el.domobj.parentNode;newRange.startOffset=newRange.endOffset=GENTICS.Utils.Dom.getIndexInParent(el.domobj)+1}}jQuery(el.domobj).remove()}}}};GENTICS.Aloha.Markup.prototype.splitRangeObject=function(rangeObject,markup){var splitObject=jQuery(rangeObject.splitObject);rangeObject.update(rangeObject.splitObject);var selectionTree=rangeObject.getSelectionTree();var followUpContainer=this.getSplitFollowUpContainer(rangeObject);this.splitRangeObjectHelper(selectionTree,rangeObject,followUpContainer);if(followUpContainer.hasClass("preparedForRemoval")){followUpContainer.removeClass("preparedForRemoval")}var insertAfterObject=this.getInsertAfterObject(rangeObject,followUpContainer);jQuery(followUpContainer).insertAfter(insertAfterObject);if(rangeObject.splitObject.nodeName.toLowerCase()==="li"&&!GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(rangeObject.splitObject,followUpContainer)){jQuery(rangeObject.splitObject).remove()}rangeObject.startContainer=followUpContainer.textNodes(true,true).first().get(0);if(!rangeObject.startContainer){rangeObject.startContainer=followUpContainer.textNodes(false).first().parent().get(0)}if(rangeObject.startContainer){rangeObject.endContainer=rangeObject.startContainer;rangeObject.startOffset=0;rangeObject.endOffset=0}else{rangeObject.startContainer=rangeObject.endContainer=followUpContainer.parent().get(0);rangeObject.startOffset=rangeObject.endOffset=GENTICS.Utils.Dom.getIndexInParent(followUpContainer.get(0))}rangeObject.update();rangeObject.select()};GENTICS.Aloha.Markup.prototype.getInsertAfterObject=function(rangeObject,followUpContainer){for(var i=0;i<rangeObject.markupEffectiveAtStart.length;i++){el=rangeObject.markupEffectiveAtStart[i];if(el===rangeObject.splitObject){var passedSplitObject=true}if(!passedSplitObject){continue}if(GENTICS.Aloha.Selection.canTag1WrapTag2(jQuery(el).parent()[0].nodeName,followUpContainer[0].nodeName)){return el}}return false};GENTICS.Aloha.Markup.prototype.getFillUpElement=function(splitObject){if(jQuery.browser.msie){return false}else{return jQuery('<br class="GENTICS_cleanme" />')}};GENTICS.Aloha.Markup.prototype.removeElementContentWhitespaceObj=function(domArray){var correction=0;var removeLater=[];for(var i=0;i<domArray.length;i++){var el=domArray[i];if(el.isElementContentWhitespace){removeLater[removeLater.length]=i}}for(var i=0;i<removeLater.length;i++){var removeIndex=removeLater[i];domArray.splice(removeIndex-correction,1);correction++}};GENTICS.Aloha.Markup.prototype.splitRangeObjectHelper=function(selectionTree,rangeObject,followUpContainer,inBetweenMarkup){if(!followUpContainer){GENTICS.Aloha.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...")}var fillUpElement=this.getFillUpElement(rangeObject.splitObject);var splitObject=jQuery(rangeObject.splitObject);var startMoving=false;if(selectionTree.length>0){var mirrorLevel=followUpContainer.contents();if(mirrorLevel.length!==selectionTree.length){this.removeElementContentWhitespaceObj(mirrorLevel)}for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if((el.selection==="none"&&startMoving===false)||(el.domobj&&el.domobj.nodeType===3&&el===selectionTree[(selectionTree.length-1)]&&el.startOffset===el.domobj.data.length)){if(followUpContainer.textNodes().length>1){mirrorLevel.eq(i).remove()}else{if(GENTICS.Utils.Dom.isSplitObject(followUpContainer[0])){if(fillUpElement){followUpContainer.html(fillUpElement)}else{followUpContainer.empty()}}else{followUpContainer.empty();followUpContainer.addClass("preparedForRemoval")}}continue}else{if(el.selection!=="none"){if(el.domobj&&el.domobj.nodeType===3&&el.startOffset!==undefined){var completeText=el.domobj.data;if(el.startOffset>0){el.domobj.data=completeText.substr(0,el.startOffset)}else{if(selectionTree.length>1){jQuery(el.domobj).remove()}else{var parent=jQuery(el.domobj).parent();if(GENTICS.Utils.Dom.isSplitObject(parent[0])){if(fillUpElement){parent.html(fillUpElement)}else{parent.empty()}}else{parent.remove()}}}if(completeText.length-el.startOffset>0){mirrorLevel[i].data=completeText.substr(el.startOffset,completeText.length)}else{if(mirrorLevel.length>1){mirrorLevel.eq((i)).remove()}else{if(GENTICS.Utils.Dom.isBlockLevelElement(followUpContainer[0])){if(fillUpElement){followUpContainer.html(fillUpElement)}else{followUpContainer.empty()}}else{followUpContainer.empty();followUpContainer.addClass("preparedForRemoval")}}}}startMoving=true;if(el.children.length>0){this.splitRangeObjectHelper(el.children,rangeObject,mirrorLevel.eq(i),inBetweenMarkup)}}else{if(el.selection==="none"&&startMoving===true){jqObj=jQuery(el.domobj).remove()}}}}}else{GENTICS.Aloha.Log.error(this,"can not split splitObject due to an empty selection tree")}splitObject.find("br.GENTICS_ephemera:gt(0)").remove();followUpContainer.find("br.GENTICS_ephemera:gt(0)").remove();splitObject.find(".preparedForRemoval").remove();followUpContainer.find(".preparedForRemoval").remove();if(splitObject.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(splitObject[0])&&fillUpElement){splitObject.html(fillUpElement)}if(followUpContainer.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(followUpContainer[0])&&fillUpElement){followUpContainer.html(fillUpElement)}};GENTICS.Aloha.Markup.prototype.getSplitFollowUpContainer=function(rangeObject){var tagName=rangeObject.splitObject.nodeName.toLowerCase();switch(tagName){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":var lastObj=jQuery(rangeObject.splitObject).textNodes().last()[0];if(lastObj&&rangeObject.startContainer===lastObj&&rangeObject.startOffset===lastObj.length){var returnObj=jQuery("<p></p>");var inside=jQuery(rangeObject.splitObject).clone().contents();returnObj.append(inside);return returnObj}break;case"li":if(rangeObject.startContainer.nodeName.toLowerCase()==="br"&&jQuery(rangeObject.startContainer).hasClass("GENTICS_ephemera")){var returnObj=jQuery("<p></p>");var inside=jQuery(rangeObject.splitObject).clone().contents();returnObj.append(inside);return returnObj}if(!rangeObject.splitObject.nextSibling&&jQuery.trim(jQuery(rangeObject.splitObject).text()).length==0){var returnObj=jQuery("<p></p>");return returnObj}}return jQuery(rangeObject.splitObject).clone()};GENTICS.Aloha.Markup.prototype.transformDomObject=function(domobj,nodeName){var jqOldObj=jQuery(domobj);var jqNewObj=jQuery("<"+nodeName+"></"+nodeName+">");if(jqOldObj[0].attributes){for(i=0;i<jqOldObj[0].attributes.length;i++){jqNewObj.attr(jqOldObj[0].attributes[i].nodeName,jqOldObj[0].attributes[i].nodeValue)}}jqNewObj[0].style.cssText=jqOldObj[0].style.cssText;jqOldObj.contents().appendTo(jqNewObj);jqOldObj.replaceWith(jqNewObj);return jqNewObj};GENTICS.Aloha.Markup.prototype.toString=function(){return"GENTICS.Aloha.Markup"};GENTICS.Aloha.Markup=new GENTICS.Aloha.Markup();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Message=function(data){this.title=data.title;this.text=data.text;this.type=data.type;this.callback=data.callback};GENTICS.Aloha.Message.Type={CONFIRM:"confirm",ALERT:"alert",WAIT:"wait"};GENTICS.Aloha.Message.prototype.toString=function(){return this.type+": "+this.message};GENTICS.Aloha.MessageLine=function(){this.messages=new Array()};GENTICS.Aloha.MessageLine.prototype.add=function(message){this.messages[this.messages.length]=message;while(this.messages.length>4){this.messages.shift()}jQuery("#gtx_aloha_messageline").html("");for(var i=0;i<this.messages.length;i++){jQuery("#gtx_aloha_messageline").append((this.messages[i].toString()+"<br/>"))}};GENTICS.Aloha.MessageLine=new GENTICS.Aloha.MessageLine();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.PluginRegistry=function(){this.plugins=new Array()};GENTICS.Aloha.PluginRegistry.prototype.register=function(plugin){if(plugin instanceof GENTICS.Aloha.Plugin){this.plugins.push(plugin)}};GENTICS.Aloha.PluginRegistry.prototype.init=function(){for(var i=0;i<this.plugins.length;i++){var plugin=this.plugins[i];if(GENTICS.Aloha.settings.plugins==undefined){GENTICS.Aloha.settings.plugins={}}plugin.settings=GENTICS.Aloha.settings.plugins[plugin.prefix];if(plugin.settings==undefined){plugin.settings={}}if(plugin.settings.enabled==undefined){plugin.settings.enabled=true}var actualLanguage=plugin.languages?GENTICS.Aloha.getLanguage(GENTICS.Aloha.settings.i18n.current,plugin.languages):null;if(!actualLanguage){GENTICS.Aloha.Log.warn(this,"Could not determine actual language, no languages available for plugin "+plugin)}else{if(plugin.settings.customDictsPath){if(!plugin.settings.customDictsPath.match(/\/$/)){plugin.settings.customDictsPath=plugin.settings.customDictsPath+"/"}GENTICS.Aloha.loadI18nFile(plugin.settings.customDictsPath+actualLanguage+".dict",plugin)}var fileUrl=GENTICS.Aloha.settings.base+"plugins/"+plugin.basePath+"/i18n/"+actualLanguage+".dict";GENTICS.Aloha.loadI18nFile(fileUrl,plugin)}if(plugin.settings.enabled==true){this.plugins[i].init()}}};GENTICS.Aloha.PluginRegistry.prototype.makeClean=function(obj){for(var i=0;i<this.plugins.length;i++){var plugin=this.plugins[i];if(GENTICS.Aloha.Log.isDebugEnabled()){GENTICS.Aloha.Log.debug(this,"Passing contents of HTML Element with id { "+obj.attr("id")+" } for cleaning to plugin { "+plugin.prefix+" }")}plugin.makeClean(obj)}};GENTICS.Aloha.PluginRegistry=new GENTICS.Aloha.PluginRegistry();GENTICS.Aloha.PluginRegistry.toString=function(){return"com.gentics.aloha.PluginRegistry"};GENTICS.Aloha.Plugin=function(pluginPrefix,basePath){this.prefix=pluginPrefix;this.basePath=basePath?basePath:pluginPrefix;GENTICS.Aloha.PluginRegistry.register(this)};GENTICS.Aloha.Plugin.prototype.settings=null;GENTICS.Aloha.Plugin.prototype.init=function(){};GENTICS.Aloha.Plugin.prototype.getEditableConfig=function(obj){var configObj=null;var configSpecified=false;if(this.settings.editables){var that=this;jQuery.each(this.settings.editables,function(selector,selectorConfig){if(obj.is(selector)){configSpecified=true;if(selectorConfig.constructor==(new Array).constructor){configObj=[];configObj=jQuery.merge(configObj,selectorConfig)}else{configObj={};configObj=jQuery.extend(true,configObj,that.config,selectorConfig)}}})}if(!configSpecified){if(typeof this.settings.config=="undefined"||!this.settings.config){configObj=this.config}else{configObj=this.settings.config}}return configObj};GENTICS.Aloha.Plugin.prototype.makeClean=function(obj){};GENTICS.Aloha.Plugin.prototype.getUID=function(id){return this.prefix+"."+id};GENTICS.Aloha.Plugin.prototype.i18n=function(key,replacements){return GENTICS.Aloha.i18n(this,key,replacements)};GENTICS.Aloha.Plugin.prototype.toString=function(){return this.prefix};GENTICS.Aloha.Plugin.prototype.log=function(level,message){GENTICS.Aloha.Log.log(level,this,message)};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
jQuery.fn.zap=function(){return this.each(function(){jQuery(this.childNodes).insertBefore(this)}).remove()};jQuery.fn.textNodes=function(excludeBreaks,includeEmptyTextNodes){var ret=[];(function(el){if((el.nodeType==3&&jQuery.trim(el.data)!=""&&!includeEmptyTextNodes)||(el.nodeType==3&&includeEmptyTextNodes)||(el.nodeName=="BR"&&!excludeBreaks)){ret.push(el)}else{for(var i=0;i<el.childNodes.length;++i){arguments.callee(el.childNodes[i])}}})(this[0]);return jQuery(ret)};GENTICS.Aloha.Selection=function(){this.rangeObject=new Object();this.tagHierarchy={textNode:[],abbr:["textNode"],b:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","strong"],pre:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","code"],blockquote:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","p","h1","h2","h3","h4","h5","h6"],ins:["textNode","b","i","em","sup","sub","br","span","img","a","u","p","h1","h2","h3","h4","h5","h6"],ul:["li"],ol:["li"],li:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","h1","h2","h3","h4","h5","h6","del","ins","u"],tr:["td","th"],table:["tr"],div:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","table","h1","h2","h3","h4","h5","h6","del","ins","u","p","div","pre","blockquote"],h1:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u"]};this.tagHierarchy={textNode:this.tagHierarchy.textNode,abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table};this.replacingElements={h1:["p","h1","h2","h3","h4","h5","h6","pre"],blockquote:["blockquote"]};this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.blockquote};this.allowedToStealElements={h1:["textNode"]};this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}};GENTICS.Aloha.Selection.prototype.SelectionTree=function(){this.domobj=new Object();this.selection;this.children=new Array()};GENTICS.Aloha.Selection.prototype.onChange=function(objectClicked,event){if(this.updateSelectionTimeout){window.clearTimeout(this.updateSelectionTimeout);this.updateSelectionTimeout=undefined}this.updateSelectionTimeout=window.setTimeout(function(){GENTICS.Aloha.Selection.updateSelection(event)},5)};GENTICS.Aloha.Selection.prototype.updateSelection=function(event){var rangeObject=this.rangeObject=new GENTICS.Aloha.Selection.SelectionRange(true);rangeObject.update();GENTICS.Aloha.FloatingMenu.setScope("GENTICS.Aloha.continuoustext");GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("selectionChanged",GENTICS.Aloha,[rangeObject,event]));return true};GENTICS.Aloha.Selection.prototype.getSelectionTree=function(rangeObject){if(!rangeObject){return this.rangeObject.getSelectionTree()}if(!rangeObject.commonAncestorContainer){GENTICS.Aloha.Log.error(this,"the rangeObject is missing the commonAncestorContainer");return false}this.inselection=false;if(GENTICS.Utils.Dom.doCleanup({mergetext:true},rangeObject)){this.rangeObject.update();this.rangeObject.select()}return this.recursiveGetSelectionTree(rangeObject,rangeObject.commonAncestorContainer)};GENTICS.Aloha.Selection.prototype.recursiveGetSelectionTree=function(rangeObject,currentObject){var jQueryCurrentObject=jQuery(currentObject);var childCount=0;var that=this;var currentElements=new Array();jQueryCurrentObject.contents().each(function(index){var selectionType="none";var startOffset=false;var endOffset=false;var collapsedFound=false;if(rangeObject.isCollapsed()&&currentObject===rangeObject.startContainer&&rangeObject.startOffset==index){currentElements[childCount]=new GENTICS.Aloha.Selection.SelectionTree();currentElements[childCount].selection="collapsed";currentElements[childCount].domobj=undefined;that.inselection=false;collapsedFound=true;childCount++}if(!that.inselection&&!collapsedFound){switch(this.nodeType){case 3:if(this===rangeObject.startContainer){that.inselection=true;selectionType=rangeObject.startOffset>0?"partial":"full";startOffset=rangeObject.startOffset;endOffset=this.length}break;case 1:if(this===rangeObject.startContainer&&rangeObject.startOffset==0){that.inselection=true;selectionType="full"}if(currentObject===rangeObject.startContainer&&rangeObject.startOffset==index){that.inselection=true;selectionType="full"}break}}if(that.inselection&&!collapsedFound){if(selectionType=="none"){selectionType="full"}switch(this.nodeType){case 3:if(this===rangeObject.endContainer){that.inselection=false;if(rangeObject.endOffset<this.length){selectionType="partial"}if(startOffset===false){startOffset=0}endOffset=rangeObject.endOffset}break;case 1:if(this===rangeObject.endContainer&&rangeObject.endOffset==0){that.inselection=false}break}if(currentObject===rangeObject.endContainer&&rangeObject.endOffset<=index){that.inselection=false;selectionType="none"}}currentElements[childCount]=new GENTICS.Aloha.Selection.SelectionTree();currentElements[childCount].domobj=this;currentElements[childCount].selection=selectionType;if(selectionType=="partial"){currentElements[childCount].startOffset=startOffset;currentElements[childCount].endOffset=endOffset}currentElements[childCount].children=that.recursiveGetSelectionTree(rangeObject,this);if(currentElements[childCount].children.length>0){var noneFound=false;var partialFound=false;var fullFound=false;for(var i=0;i<currentElements[childCount].children.length;++i){switch(currentElements[childCount].children[i].selection){case"none":noneFound=true;break;case"full":fullFound=true;break;case"partial":partialFound=true;break}}if(partialFound||(fullFound&&noneFound)){currentElements[childCount].selection="partial"}else{if(fullFound&&!partialFound&&!noneFound){currentElements[childCount].selection="full"}}}childCount++});if(rangeObject.isCollapsed()&&currentObject===rangeObject.startContainer&&rangeObject.startOffset==currentObject.childNodes.length){currentElements[childCount]=new GENTICS.Aloha.Selection.SelectionTree();currentElements[childCount].selection="collapsed";currentElements[childCount].domobj=undefined}return currentElements};GENTICS.Aloha.Selection.prototype.getRangeObject=function(){return this.rangeObject};GENTICS.Aloha.Selection.prototype.isRangeObjectWithinMarkup=function(rangeObject,startOrEnd,markupObject,tagComparator,limitObject){domObj=!startOrEnd?rangeObject.startContainer:rangeObject.endContainer;if(typeof tagComparator!=="undefined"&&typeof tagComparator!=="function"){GENTICS.Aloha.Log.error(this,"parameter tagComparator is not a function")}var that=this;if(typeof tagComparator==="undefined"){tagComparator=function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(domobj,markupObject)}}var parents=jQuery(domObj).parents();var returnVal=false;var i=-1;var that=this;if(parents.length>0){parents.each(function(){if(this===limitObject){GENTICS.Aloha.Log.debug(that,"reached limit dom obj");return false}if(tagComparator(this,markupObject)){if(returnVal===false){returnVal=new Array()}GENTICS.Aloha.Log.debug(that,"reached object equal to markup");i++;returnVal[i]=this;return true}})}return returnVal};GENTICS.Aloha.Selection.prototype.standardSectionsAndGroupingContentComparator=function(domobj,markupObject){if(domobj.nodeType===1){if(markupObject[0].tagName&&GENTICS.Aloha.Selection.replacingElements[domobj.tagName.toLowerCase()]&&GENTICS.Aloha.Selection.replacingElements[domobj.tagName.toLowerCase()].indexOf(markupObject[0].tagName.toLowerCase())!=-1){return true}}else{GENTICS.Aloha.Log.debug(this,"only element nodes (nodeType == 1) can be compared")}return false};GENTICS.Aloha.Selection.prototype.standardTextLevelSemanticsComparator=function(domobj,markupObject){if(domobj.nodeType===1){if(domobj.tagName.toLowerCase()!=markupObject[0].tagName.toLowerCase()){return false}if(!this.standardAttributesComparator(domobj,markupObject)){return false}return true}else{GENTICS.Aloha.Log.debug(this,"only element nodes (nodeType == 1) can be compared")}return false};GENTICS.Aloha.Selection.prototype.standardAttributesComparator=function(domobj,markupObject){if(domobj.attributes&&domobj.attributes.length&&domobj.attributes.length>0){for(var i=0;i<domobj.attributes.length;i++){var attr=domobj.attributes[i];if(attr.nodeName.toLowerCase()=="class"&&attr.nodeValue.length>0){var classString=attr.nodeValue;var classes=classString.split(" ")}}}if(markupObject[0].attributes&&markupObject[0].attributes.length&&markupObject[0].attributes.length>0){for(var i=0;i<markupObject[0].attributes.length;i++){var attr=markupObject[0].attributes[i];if(attr.nodeName.toLowerCase()=="class"&&attr.nodeValue.length>0){var classString=attr.nodeValue;var classes2=classString.split(" ")}}}if(classes&&!classes2||classes2&&!classes){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+domobj.tagName.toLowerCase()+"> failed because one element has classes and the other has not");return false}if(classes&&classes2&&classes.length!=classes.length){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+domobj.tagName.toLowerCase()+"> failed because of a different amount of classes");return false}if(classes&&classes2&&classes.length==classes2.length&&classes.length!=0){for(var i=0;i<classes.length;i++){if(!markupObject.hasClass(classes[i])){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+domobj.tagName.toLowerCase()+"> failed because of different classes");return false}}}return true};GENTICS.Aloha.Selection.prototype.changeMarkup=function(rangeObject,markupObject,tagComparator){var tagName=markupObject[0].tagName.toLowerCase();if(this.replacingElements[tagName]){var backupRangeObject=rangeObject;rangeObject=new this.SelectionRange(rangeObject);if(GENTICS.Aloha.activeEditable){var newCAC=GENTICS.Aloha.activeEditable.obj.get(0)}else{var newCAC=document.body}rangeObject.update(newCAC);markupObject.isReplacingElement=true}else{if(rangeObject.isCollapsed()){GENTICS.Aloha.Log.debug(this,"early returning from applying markup because nothing is currently selected");return false}}if(GENTICS.Aloha.activeEditable){var limitObject=GENTICS.Aloha.activeEditable.obj[0]}else{var limitObject=document.body}var relevantMarkupObjectsAtSelectionStart=this.isRangeObjectWithinMarkup(rangeObject,false,markupObject,tagComparator,limitObject);var relevantMarkupObjectsAtSelectionEnd=this.isRangeObjectWithinMarkup(rangeObject,true,markupObject,tagComparator,limitObject);if(!markupObject.isReplacingElement&&rangeObject.startOffset==0){var prevSibling;if(prevSibling=this.getTextNodeSibling(false,rangeObject.commonAncestorContainer.parentNode,rangeObject.startContainer)){var relevantMarkupObjectBeforeSelection=this.isRangeObjectWithinMarkup({startContainer:prevSibling,startOffset:0},false,markupObject,tagComparator,limitObject)}}if(!markupObject.isReplacingElement&&(rangeObject.endOffset==rangeObject.endContainer.length)){var nextSibling;if(nextSibling=this.getTextNodeSibling(true,rangeObject.commonAncestorContainer.parentNode,rangeObject.endContainer)){var relevantMarkupObjectAfterSelection=this.isRangeObjectWithinMarkup({startContainer:nextSibling,startOffset:0},false,markupObject,tagComparator,limitObject)}}if(!markupObject.isReplacingElement&&(relevantMarkupObjectsAtSelectionStart&&!relevantMarkupObjectsAtSelectionEnd)){GENTICS.Aloha.Log.info(this,"markup 2 non-markup");this.prepareForRemoval(rangeObject.getSelectionTree(),markupObject,tagComparator);jQuery(relevantMarkupObjectsAtSelectionStart).addClass("preparedForRemoval");this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionStart,rangeObject,false,tagComparator)}else{if(!markupObject.isReplacingElement&&relevantMarkupObjectsAtSelectionStart&&relevantMarkupObjectsAtSelectionEnd){GENTICS.Aloha.Log.info(this,"markup 2 markup");this.prepareForRemoval(rangeObject.getSelectionTree(),markupObject,tagComparator);this.splitRelevantMarkupObject(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject,tagComparator)}else{if(!markupObject.isReplacingElement&&((!relevantMarkupObjectsAtSelectionStart&&relevantMarkupObjectsAtSelectionEnd)||relevantMarkupObjectAfterSelection||relevantMarkupObjectBeforeSelection)){GENTICS.Aloha.Log.info(this,"non-markup 2 markup OR with next2markup");if(relevantMarkupObjectBeforeSelection&&relevantMarkupObjectAfterSelection){var extendedRangeObject=new GENTICS.Aloha.Selection.SelectionRange(rangeObject);extendedRangeObject.startContainer=jQuery(relevantMarkupObjectBeforeSelection[relevantMarkupObjectBeforeSelection.length-1]).textNodes()[0];extendedRangeObject.startOffset=0;extendedRangeObject.endContainer=jQuery(relevantMarkupObjectAfterSelection[relevantMarkupObjectAfterSelection.length-1]).textNodes().last()[0];extendedRangeObject.endOffset=extendedRangeObject.endContainer.length;extendedRangeObject.update();this.applyMarkup(extendedRangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator);GENTICS.Aloha.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")}else{if(relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection&&!relevantMarkupObjectsAtSelectionEnd){this.extendExistingMarkupWithSelection(relevantMarkupObjectBeforeSelection,rangeObject,false,tagComparator);GENTICS.Aloha.Log.info(this,"extending previous markup")}else{if(relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection&&relevantMarkupObjectsAtSelectionEnd){var extendedRangeObject=new GENTICS.Aloha.Selection.SelectionRange(rangeObject);extendedRangeObject.startContainer=jQuery(relevantMarkupObjectBeforeSelection[relevantMarkupObjectBeforeSelection.length-1]).textNodes()[0];extendedRangeObject.startOffset=0;extendedRangeObject.endContainer=jQuery(relevantMarkupObjectsAtSelectionEnd[relevantMarkupObjectsAtSelectionEnd.length-1]).textNodes().last()[0];extendedRangeObject.endOffset=extendedRangeObject.endContainer.length;extendedRangeObject.update();this.applyMarkup(extendedRangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator);GENTICS.Aloha.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")}else{if(!relevantMarkupObjectBeforeSelection&&relevantMarkupObjectAfterSelection){this.extendExistingMarkupWithSelection(relevantMarkupObjectAfterSelection,rangeObject,true,tagComparator);GENTICS.Aloha.Log.info(this,"extending following markup backwards")}else{this.extendExistingMarkupWithSelection(relevantMarkupObjectsAtSelectionEnd,rangeObject,true,tagComparator)}}}}}else{if(markupObject.isReplacingElement||(!relevantMarkupObjectsAtSelectionStart&&!relevantMarkupObjectsAtSelectionEnd&&!relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection)){GENTICS.Aloha.Log.info(this,"non-markup 2 non-markup");this.applyMarkup(rangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator,{setRangeObject2NewMarkup:true})}}}}jQuery(".preparedForRemoval").zap();rangeObject.update();if(markupObject.isReplacingElement){backupRangeObject.select()}else{rangeObject.select()}};GENTICS.Aloha.Selection.prototype.areMarkupObjectsAsLongAsRangeObject=function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject){if(rangeObject.startOffset!==0){return false}for(var i=0;i<relevantMarkupObjectsAtSelectionStart.length;i++){var el=relevantMarkupObjectsAtSelectionStart[i];if(jQuery(el).textNodes().first()[0]!==rangeObject.startContainer){return false}}for(var i=0;i<relevantMarkupObjectsAtSelectionEnd.length;i++){var el=relevantMarkupObjectsAtSelectionEnd[i];if(jQuery(el).textNodes().last()[0]!==rangeObject.endContainer||jQuery(el).textNodes().last()[0].length!=rangeObject.endOffset){return false}}return true};GENTICS.Aloha.Selection.prototype.splitRelevantMarkupObject=function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject,tagComparator){jQuery(relevantMarkupObjectsAtSelectionStart).addClass("preparedForRemoval");jQuery(relevantMarkupObjectsAtSelectionEnd).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject)){return true}var relevantMarkupObjectAtSelectionStartAndEnd=this.intersectRelevantMarkupObjects(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd);if(relevantMarkupObjectAtSelectionStartAndEnd){this.insertCroppedMarkups([relevantMarkupObjectAtSelectionStartAndEnd],rangeObject,false,tagComparator);this.insertCroppedMarkups([relevantMarkupObjectAtSelectionStartAndEnd],rangeObject,true,tagComparator)}else{this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionStart,rangeObject,false,tagComparator);this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionEnd,rangeObject,true,tagComparator)}return true};GENTICS.Aloha.Selection.prototype.intersectRelevantMarkupObjects=function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd){var intersection=false;if(!relevantMarkupObjectsAtSelectionStart||!relevantMarkupObjectsAtSelectionEnd){return intersection}for(var i=0;i<relevantMarkupObjectsAtSelectionStart.length;i++){var elStart=relevantMarkupObjectsAtSelectionStart[i];for(var j=0;j<relevantMarkupObjectsAtSelectionEnd.length;j++){var elEnd=relevantMarkupObjectsAtSelectionEnd[j];if(elStart===elEnd){intersection=elStart}}}return intersection};GENTICS.Aloha.Selection.prototype.extendExistingMarkupWithSelection=function(relevantMarkupObjects,rangeObject,startOrEnd,tagComparator){if(!startOrEnd){var extendMarkupsAtStart=true}if(startOrEnd){var extendMarkupsAtEnd=true}var objects=[];for(var i=0;i<relevantMarkupObjects.length;i++){objects[i]=new this.SelectionRange();el=relevantMarkupObjects[i];if(extendMarkupsAtEnd&&!extendMarkupsAtStart){objects[i].startContainer=rangeObject.startContainer;objects[i].startOffset=rangeObject.startOffset;textnodes=jQuery(el).textNodes(true);objects[i].endContainer=textnodes[textnodes.length-1];objects[i].endOffset=textnodes[textnodes.length-1].length;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NewMarkup:true})}if(!extendMarkupsAtEnd&&extendMarkupsAtStart){textnodes=jQuery(el).textNodes(true);objects[i].startContainer=textnodes[0];objects[i].startOffset=0;objects[i].endContainer=rangeObject.endContainer;objects[i].endOffset=rangeObject.endOffset;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NewMarkup:true})}}return true};GENTICS.Aloha.Selection.prototype.getClonedMarkup4Wrapping=function(domobj){var wrapper=jQuery(domobj).clone().removeClass("preparedForRemoval").empty();if(wrapper.attr("class").length==0){wrapper.removeAttr("class")}return wrapper};GENTICS.Aloha.Selection.prototype.insertCroppedMarkups=function(relevantMarkupObjects,rangeObject,startOrEnd,tagComparator){if(!startOrEnd){var cropMarkupsAtEnd=true}if(startOrEnd){var cropMarkupsAtStart=true}var objects=[];for(var i=0;i<relevantMarkupObjects.length;i++){objects[i]=new this.SelectionRange();var el=relevantMarkupObjects[i];if(cropMarkupsAtEnd&&!cropMarkupsAtStart){var textNodes=jQuery(el).textNodes(true);objects[i].startContainer=textNodes[0];objects[i].startOffset=0;if(objects[i].startContainer===rangeObject.startContainer&&objects[i].startOffset===rangeObject.startOffset){continue}if(rangeObject.startOffset==0){objects[i].endContainer=this.getTextNodeSibling(false,el,rangeObject.startContainer);objects[i].endOffset=objects[i].endContainer.length}else{objects[i].endContainer=rangeObject.startContainer;objects[i].endOffset=rangeObject.startOffset}objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NextSibling:true})}if(!cropMarkupsAtEnd&&cropMarkupsAtStart){objects[i].startContainer=rangeObject.endContainer;objects[i].startOffset=rangeObject.endOffset;textnodes=jQuery(el).textNodes(true);objects[i].endContainer=textnodes[textnodes.length-1];objects[i].endOffset=textnodes[textnodes.length-1].length;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2PreviousSibling:true})}}return true};GENTICS.Aloha.Selection.prototype.changeMarkupOnSelection=function(markupObject){this.changeMarkup(this.getRangeObject(),markupObject,this.getStandardTagComparator(markupObject));GENTICS.Utils.Dom.doCleanup({mergetext:true},this.rangeObject);this.rangeObject.update();this.rangeObject.select()};GENTICS.Aloha.Selection.prototype.applyMarkup=function(selectionTree,rangeObject,markupObject,tagComparator,options){options=options?options:new Object();this.prepareForRemoval(selectionTree,markupObject,tagComparator);var optimizedSelectionTree=this.optimizeSelectionTree4Markup(selectionTree,markupObject,tagComparator);breakpoint=true;for(var i=0;i<optimizedSelectionTree.length;i++){var el=optimizedSelectionTree[i];if(el.wrappable){this.wrapMarkupAroundSelectionTree(el.elements,rangeObject,markupObject,tagComparator,options)}else{GENTICS.Aloha.Log.debug(this,"dive further into non-wrappable object");this.applyMarkup(el.element.children,rangeObject,markupObject,tagComparator,options)}}};GENTICS.Aloha.Selection.prototype.getMarkupType=function(markupObject){var nn=jQuery(markupObject)[0].nodeName.toLowerCase();if(markupObject.outerHTML){GENTICS.Aloha.Log.debug(this,"Node name detected: "+nn+" for: "+markupObject.outerHTML())}if(nn=="#text"){return"textNode"}if(this.replacingElements[nn]){return"sectionOrGroupingContent"}if(this.tagHierarchy[nn]){return"textLevelSemantics"}GENTICS.Aloha.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+markupObject.outerHTML())};GENTICS.Aloha.Selection.prototype.getStandardTagComparator=function(markupObject){var that=this;switch(this.getMarkupType(markupObject)){case"textNode":return function(p1,p2){return false};break;case"sectionOrGroupingContent":return function(domobj,markupObject){return that.standardSectionsAndGroupingContentComparator(domobj,markupObject)};break;case"textLevelSemantics":default:return function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(domobj,markupObject)}}};GENTICS.Aloha.Selection.prototype.prepareForRemoval=function(selectionTree,markupObject,tagComparator){var that=this;if(typeof tagComparator!=="undefined"&&typeof tagComparator!=="function"){GENTICS.Aloha.Log.error(this,"parameter tagComparator is not a function")}if(typeof tagComparator==="undefined"){tagComparator=this.getStandardTagComparator(markupObject)}for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if(el.domobj&&(el.selection=="full"||(el.selection=="partial"&&markupObject.isReplacingElement))){if(el.domobj.nodeType===1&&tagComparator(el.domobj,markupObject)){GENTICS.Aloha.Log.debug(this,"Marking for removal: "+el.domobj.nodeName);jQuery(el.domobj).addClass("preparedForRemoval")}}if(el.selection!="none"&&el.children.length>0){this.prepareForRemoval(el.children,markupObject,tagComparator)}}};GENTICS.Aloha.Selection.prototype.wrapMarkupAroundSelectionTree=function(selectionTree,rangeObject,markupObject,tagComparator,options){var objects2wrap=new Array;var j=-1;GENTICS.Aloha.Log.debug(this,"The formatting <"+markupObject[0].tagName+"> will be wrapped around the selection");var preText="";var postText="";for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if(el.domobj&&!this.canTag1WrapTag2(el.domobj.parentNode.tagName.toLowerCase(),markupObject[0].tagName.toLowerCase())){GENTICS.Aloha.Log.info(this,"Skipping the wrapping of <"+markupObject[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+el.domobj.parentNode.tagName.toLowerCase()+">");continue}if(el.domobj&&el.domobj.nodeType==3&&jQuery.trim(jQuery(el.domobj).outerHTML()).length==0){continue}if(el.domobj&&el.selection=="partial"&&!markupObject.isReplacingElement){if(el.startOffset!==undefined&&el.endOffset===undefined){j++;preText+=el.domobj.data.substr(0,el.startOffset);el.domobj.data=el.domobj.data.substr(el.startOffset,el.domobj.data.length-el.startOffset);objects2wrap[j]=el.domobj}else{if(el.endOffset!==undefined&&el.startOffset===undefined){j++;postText+=el.domobj.data.substr(el.endOffset,el.domobj.data.length-el.endOffset);el.domobj.data=el.domobj.data.substr(0,el.endOffset);objects2wrap[j]=el.domobj}else{if(el.endOffset!==undefined&&el.startOffset!==undefined){if(el.startOffset==el.endOffset){GENTICS.Aloha.Log.debug(this,"skipping empty selection");continue}j++;preText+=el.domobj.data.substr(0,el.startOffset);var middleText=el.domobj.data.substr(el.startOffset,el.endOffset-el.startOffset);postText+=el.domobj.data.substr(el.endOffset,el.domobj.data.length-el.endOffset);el.domobj.data=middleText;objects2wrap[j]=el.domobj}else{GENTICS.Aloha.Log.debug(this,"diving into object");this.applyMarkup(el.children,rangeObject,markupObject,tagComparator,options)}}}}if(el.domobj&&(el.selection=="full"||(el.selection=="partial"&&markupObject.isReplacingElement))){j++;objects2wrap[j]=el.domobj}}breakpoint=true;if(objects2wrap.length>0){objects2wrap=jQuery(objects2wrap);jQuery.each(objects2wrap,function(index,element){if(jQuery.browser.msie&&element.nodeType==3&&!element.nextSibling&&!element.previousSibling&&element.parentNode&&element.parentNode.nodeName.toLowerCase()=="li"){element.data=jQuery.trim(element.data)}});var newMarkup=objects2wrap.wrapAll(markupObject).parent();newMarkup.before(preText).after(postText);var breakpoint=true;if(options.setRangeObject2NewMarkup){var textnodes=objects2wrap.textNodes();if(textnodes.index(rangeObject.startContainer)!=-1){rangeObject.startOffset=0}if(textnodes.index(rangeObject.endContainer)!=-1){rangeObject.endOffset=rangeObject.endContainer.length}var breakpoint=true}if(options.setRangeObject2NextSibling){var prevOrNext=true;var textNode2Start=newMarkup.textNodes(true).last()[0];if(objects2wrap.index(rangeObject.startContainer)!=-1){rangeObject.startContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.startOffset=0}if(objects2wrap.index(rangeObject.endContainer)!=-1){rangeObject.endContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.endOffset=rangeObject.endOffset-textNode2Start.length}}if(options.setRangeObject2PreviousSibling){var prevOrNext=false;var textNode2Start=newMarkup.textNodes(true).first()[0];if(objects2wrap.index(rangeObject.startContainer)!=-1){rangeObject.startContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.startOffset=0}if(objects2wrap.index(rangeObject.endContainer)!=-1){rangeObject.endContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.endOffset=rangeObject.endContainer.length}}}};GENTICS.Aloha.Selection.prototype.getTextNodeSibling=function(previousOrNext,commonAncestorContainer,currentTextNode){var textNodes=jQuery(commonAncestorContainer).textNodes(true);index=textNodes.index(currentTextNode);if(index==-1){return false}var newIndex=index+(!previousOrNext?-1:1);return textNodes[newIndex]?textNodes[newIndex]:false};GENTICS.Aloha.Selection.prototype.optimizeSelectionTree4Markup=function(selectionTree,markupObject,tagComparator){var groupMap=[];var outerGroupIndex=0;var innerGroupIndex=0;var that=this;if(typeof tagComparator==="undefined"){tagComparator=function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(markupObject)}}for(var i=0;i<selectionTree.length;i++){if(selectionTree[i].domobj&&selectionTree[i].selection!="none"){if(markupObject.isReplacingElement&&tagComparator(markupObject[0],jQuery(selectionTree[i].domobj))){if(groupMap[outerGroupIndex]!==undefined){outerGroupIndex++}groupMap[outerGroupIndex]=new Object();groupMap[outerGroupIndex].wrappable=true;groupMap[outerGroupIndex].elements=new Array();groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[i];outerGroupIndex++}else{if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[i]],markupObject)){if(groupMap[outerGroupIndex]===undefined){groupMap[outerGroupIndex]=new Object();groupMap[outerGroupIndex].wrappable=true;groupMap[outerGroupIndex].elements=new Array()}if(markupObject.isReplacingElement){var startPosition=i;for(var j=i-1;j>=0;j--){if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[j]],markupObject)&&this.isMarkupAllowedToStealSelectionTreeElement(selectionTree[j],markupObject)){startPosition=j}else{break}}var endPosition=i;for(var j=i+1;j<selectionTree.length;j++){if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[j]],markupObject)&&this.isMarkupAllowedToStealSelectionTreeElement(selectionTree[j],markupObject)){endPosition=j}else{break}}innerGroupIndex=0;for(var j=startPosition;j<=endPosition;j++){groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[j];groupMap[outerGroupIndex].elements[innerGroupIndex].selection="full";innerGroupIndex++}innerGroupIndex=0}else{groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[i];innerGroupIndex++}}else{if(groupMap[outerGroupIndex]!==undefined){outerGroupIndex++}groupMap[outerGroupIndex]=new Object();groupMap[outerGroupIndex].wrappable=false;groupMap[outerGroupIndex].element=selectionTree[i];innerGroupIndex=0;outerGroupIndex++}}}}return groupMap};GENTICS.Aloha.Selection.prototype.isMarkupAllowedToStealSelectionTreeElement=function(selectionTreeElement,markupObject){if(!selectionTreeElement.domobj){return false}var nodeName=selectionTreeElement.domobj.nodeName.toLowerCase();nodeName=(nodeName=="#text")?"textNode":nodeName;var markupName=markupObject[0].nodeName.toLowerCase();if(!this.allowedToStealElements[markupName]){return false}if(this.allowedToStealElements[markupName].indexOf(nodeName)==-1){return false}return true};GENTICS.Aloha.Selection.prototype.canMarkupBeApplied2ElementAsWhole=function(selectionTree,markupObject){if(markupObject.jquery){htmlTag=markupObject[0].tagName}if(markupObject.tagName){htmlTag=markupObject.tagName}returnVal=true;for(var i=0;i<selectionTree.length;i++){var el=selectionTree[i];if(el.domobj&&(el.selection!="none"||markupObject.isReplacingElement)){if(!this.canTag1WrapTag2(htmlTag,el.domobj.nodeName)){return false}if(el.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(el.children,markupObject)){return false}}}return returnVal};GENTICS.Aloha.Selection.prototype.canTag1WrapTag2=function(t1,t2){t1=(t1=="#text")?"textNode":t1.toLowerCase();t2=(t2=="#text")?"textNode":t2.toLowerCase();if(!this.tagHierarchy[t1]){return true}if(!this.tagHierarchy[t2]){return true}var t1Array=this.tagHierarchy[t1];var returnVal=(t1Array.indexOf(t2)!=-1)?true:false;return returnVal};GENTICS.Aloha.Selection.prototype.mayInsertTag=function(tagName){if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object"){for(var i=0;i<this.rangeObject.unmodifiableMarkupAtStart.length;++i){if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[i].nodeName,tagName)){return false}}return true}else{GENTICS.Aloha.Log.warn(this,"Unable to determine whether tag "+tagName+" may be inserted");return true}};GENTICS.Aloha.Selection.prototype.toString=function(){return"GENTICS.Aloha.Selection"};GENTICS.Aloha.Selection.prototype.SelectionRange=function(rangeObject){GENTICS.Utils.RangeObject.apply(this,arguments);this.commonAncestorContainer;this.selectionTree;this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];this.limitObject;this.splitObject;if(rangeObject){if(rangeObject.commonAncestorContainer){this.commonAncestorContainer=rangeObject.commonAncestorContainer}if(rangeObject.selectionTree){this.selectionTree=rangeObject.selectionTree}if(rangeObject.limitObject){this.limitObject=rangeObject.limitObject}if(rangeObject.markupEffectiveAtStart){this.markupEffectiveAtStart=rangeObject.markupEffectiveAtStart}if(rangeObject.unmodifiableMarkupAtStart){this.unmodifiableMarkupAtStart=rangeObject.unmodifiableMarkupAtStart}if(rangeObject.splitObject){this.splitObject=rangeObject.splitObject}}};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype=new GENTICS.Utils.RangeObject();GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.select=function(){GENTICS.Utils.RangeObject.prototype.select.apply(this,arguments);GENTICS.Aloha.Selection.updateSelection()};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.update=function(commonAncestorContainer){this.updatelimitObject();this.updateMarkupEffectiveAtStart();this.updateCommonAncestorContainer(commonAncestorContainer);this.selectionTree=undefined};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.getSelectionTree=function(){if(!this.selectionTree){this.selectionTree=GENTICS.Aloha.Selection.getSelectionTree(this)}return this.selectionTree};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.getSelectedSiblings=function(domobj){var selectionTree=this.getSelectionTree();return this.recursionGetSelectedSiblings(domobj,selectionTree)};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.recursionGetSelectedSiblings=function(domobj,selectionTree){var selectedSiblings=false;var foundObj=false;for(var i=0;i<selectionTree.length;++i){if(selectionTree[i].domobj===domobj){foundObj=true;selectedSiblings=[]}else{if(!foundObj&&selectionTree[i].children){selectedSiblings=this.recursionGetSelectedSiblings(domobj,selectionTree[i].children);if(selectedSiblings!==false){break}}else{if(foundObj&&selectionTree[i].domobj&&selectionTree[i].selection!="collapsed"&&selectionTree[i].selection!="none"){selectedSiblings.push(selectionTree[i].domobj)}else{if(foundObj&&selectionTree[i].selection=="none"){break}}}}}return selectedSiblings};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.updateMarkupEffectiveAtStart=function(){this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];var parents=this.getStartContainerParents();var limitFound=false;for(var i=0;i<parents.length;i++){var el=parents[i];if(!limitFound&&(el!==this.limitObject)){this.markupEffectiveAtStart[i]=el;if(!splitObjectWasSet&&GENTICS.Utils.Dom.isSplitObject(el)){var splitObjectWasSet=true;this.splitObject=el}}else{limitFound=true;this.unmodifiableMarkupAtStart.push(el)}}if(!splitObjectWasSet){this.splitObject=false}return};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.updatelimitObject=function(){if(GENTICS.Aloha.editables&&GENTICS.Aloha.editables.length>0){var parents=this.getStartContainerParents();var editables=GENTICS.Aloha.editables;for(var i=0;i<parents.length;i++){var el=parents[i];for(var j=0;j<editables.length;j++){var editable=editables[j].obj[0];if(el===editable){this.limitObject=el;return true}}}}this.limitObject=document.body;return true};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.toString=function(verbose){if(!verbose){return"GENTICS.Aloha.Selection.SelectionRange"}return"GENTICS.Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}"};GENTICS.Aloha.Selection=new GENTICS.Aloha.Selection();
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Sidebar=function(){};GENTICS.Aloha.Sidebar.prototype.add=function(panel){};GENTICS.Aloha.Sidebar.prototype.render=function(){};GENTICS.Aloha.Sidebar.prototype.openPanel=function(panel){};GENTICS.Aloha.Sidebar.prototype.closePanel=function(panel){};GENTICS.Aloha.Sidebar.prototype.togglePinPanel=function(panel){};GENTICS.Aloha.SidebarRight=new GENTICS.Aloha.Sidebar();GENTICS.Aloha.SidebarLeft=new GENTICS.Aloha.Sidebar();GENTICS.Aloha.Sidebar.Panel=function(){};GENTICS.Aloha.Sidebar.Panel.prototype.render=function(){};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.RepositoryManager=function(){this.repositories=new Array()};GENTICS.Aloha.RepositoryManager.prototype.openCallbacks=[];GENTICS.Aloha.RepositoryManager.prototype.init=function(){if(GENTICS.Aloha.settings.repositories==undefined){GENTICS.Aloha.settings.repositories={}}for(var i=0;i<this.repositories.length;i++){var repository=this.repositories[i];if(repository.settings==undefined){repository.settings={}}if(GENTICS.Aloha.settings.repositories[repository.repositoryId]){jQuery.extend(repository.settings,GENTICS.Aloha.settings.repositories[repository.repositoryId])}repository.init()}};GENTICS.Aloha.RepositoryManager.prototype.register=function(repository){if(repository instanceof GENTICS.Aloha.Repository){if(!this.getRepository(repository.repositoryId)){this.repositories.push(repository)}else{GENTICS.Aloha.Log.warn(this,"A repository with name { "+repository.repositoryId+" } already registerd. Ignoring this.")}}else{GENTICS.Aloha.Log.error(this,"Trying to register a repository which is not an instance of GENTICS.Aloha.Repository.")}};GENTICS.Aloha.RepositoryManager.prototype.getRepository=function(repositoryId){for(var i=0;i<this.repositories.length;i++){if(this.repositories[i].repositoryId==repositoryId){return this.repositories[i]}}return null};GENTICS.Aloha.RepositoryManager.prototype.query=function(params,callback){var that=this;var allitems=[];var repositories=[];this.openCallbacks=[];var timer=setTimeout(function(){that.openCallbacks=[];that.queryCallback(callback,allitems,timer)},5000);if(params.repositoryId){repositories.push(this.getRepository(params.repositoryId))}else{repositories=this.repositories}for(var i=0;i<repositories.length;i++){this.openCallbacks.push(repositories[i].repositoryId);try{var notImplemented=repositories[i].query(params,function(items){var id=that.openCallbacks.indexOf(this.repositoryId);if(id!=-1){that.openCallbacks.splice(id,1)}if(!items.length==0&&!items[0].repositoryId){for(var j=0;j<items.length;j++){items[j].repositoryId=this.repositoryId}}jQuery.merge(allitems,items);that.queryCallback(callback,allitems,timer)})}catch(e){notImplemented=true}if(notImplemented){var id=that.openCallbacks.indexOf(repositories[i].repositoryId);if(id!=-1){this.openCallbacks.splice(id,1);if(i==repositories.length-1){this.queryCallback(callback,allitems,timer)}}}}};GENTICS.Aloha.RepositoryManager.prototype.queryCallback=function(cb,items,timer){if(this.openCallbacks.length==0){clearTimeout(timer);items.sort(function(a,b){return b.weight-a.weight});var result={results:items.length,items:items};cb.call(this,result)}};GENTICS.Aloha.RepositoryManager.prototype.getChildren=function(params,callback){var that=this;var allitems=[];var repositories=[];this.openChildrenCallbacks=[];if(params.inFolderId=="aloha"&&this.repositories.length>0){var repos=[];for(var i=0;i<this.repositories.length;i++){repos.push(new GENTICS.Aloha.Repository.Folder({id:this.repositories[i].repositoryId,name:this.repositories[i].repositoryName,repositoryId:this.repositories[i].repositoryId,type:"repository",hasMoreItems:true}))}that.getChildrenCallback(callback,repos,null);return}var timer=setTimeout(function(){that.openChildrenCallbacks=[];that.getChildrenCallback(callback,allitems,timer)},5000);if(params.repositoryId){repositories.push(this.getRepository(params.repositoryId))}else{repositories=this.repositories}for(var i=0;i<repositories.length;i++){this.openChildrenCallbacks.push(repositories[i].repositoryId);try{var notImplemented=repositories[i].getChildren(params,function(items){var id=that.openChildrenCallbacks.indexOf(this.repositoryId);if(id!=-1){that.openChildrenCallbacks.splice(id,1)}jQuery.merge(allitems,items);that.getChildrenCallback(callback,allitems,timer)})}catch(e){notImplemented=true}if(notImplemented){var id=that.openChildrenCallbacks.indexOf(repositories[i].repositoryId);if(id!=-1){this.openChildrenCallbacks.splice(id,1);if(i==repositories.length-1){this.getChildrenCallback(callback,allitems,timer)}}}}};GENTICS.Aloha.RepositoryManager.prototype.getChildrenCallback=function(cb,items,timer){if(this.openChildrenCallbacks.length==0){if(timer){clearTimeout(timer)}cb.call(this,items)}};GENTICS.Aloha.RepositoryManager.prototype.makeClean=function(obj){var that=this;var repository={};obj.find("[data-GENTICS-aloha-repository="+this.prefix+"]").each(function(){for(var i=0;i<that.repositories.length;i++){repository.makeClean(obj)}GENTICS.Aloha.Log.debug(that,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+repository.repositoryId+" }");repository.makeClean(this)})};GENTICS.Aloha.RepositoryManager.prototype.markObject=function(obj,item){var repository=this.getRepository(item.repositoryId);if(repository){jQuery(obj).attr("data-GENTICS-aloha-repository",item.repositoryId);jQuery(obj).attr("data-GENTICS-aloha-object-id",item.id);repository.markObject(obj,item)}else{GENTICS.Aloha.Log.error(this,"Trying to apply a repository { "+item.name+" } to an object, but item has no repositoryId.")}};GENTICS.Aloha.RepositoryManager.prototype.getObject=function(obj,callback){var that=this;var jqObj=jQuery(obj);var repository=this.getRepository(jqObj.attr("data-GENTICS-aloha-repository"));var itemId=jqObj.attr("data-GENTICS-aloha-object-id");if(repository&&itemId){this.itemCache=this.itemCache||[];this.itemCache[repository.repositoryId]=this.itemCache[repository.repositoryId]||[];if(this.itemCache[repository.repositoryId][itemId]){callback.call(this,[this.itemCache[repository.repositoryId][itemId]])}else{repository.getObjectById(itemId,function(items){that.itemCache[repository.repositoryId][itemId]=items[0];callback.call(this,items)})}}};GENTICS.Aloha.RepositoryManager=new GENTICS.Aloha.RepositoryManager();GENTICS.Aloha.RepositoryManager.toString=function(){return"com.gentics.aloha.RepositoryManager"};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Repository=function(repositoryId,repositoryName){this.repositoryId=repositoryId;this.settings={};this.repositoryName=(repositoryName)?repositoryName:repositoryId;GENTICS.Aloha.RepositoryManager.register(this)};GENTICS.Aloha.Repository.prototype.init=function(){};GENTICS.Aloha.Repository.prototype.query=function(params,callback){return true};GENTICS.Aloha.Repository.prototype.getChildren=function(params,callback){return true};GENTICS.Aloha.Repository.prototype.makeClean=function(obj){};GENTICS.Aloha.Repository.prototype.markObject=function(obj,repositoryItem){};GENTICS.Aloha.Repository.prototype.setTemplate=function(template){if(template){this.extTpl=new Ext.XTemplate(template)}else{this.extTpl=null}};GENTICS.Aloha.Repository.prototype.hasTemplate=function(){return this.extTpl?true:false};GENTICS.Aloha.Repository.prototype.getTemplate=function(){return this.extTpl};GENTICS.Aloha.Repository.prototype.getObjectById=function(itemId,callback){return true};
/*
*   This file is part of Aloha Editor
*   Author & Copyright (c) 2010 Gentics Software GmbH, aloha@gentics.com
*   Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
GENTICS.Aloha.Repository.Object=function(){};GENTICS.Aloha.Repository.Document=function(properties){var p=properties;this.type="document";if(!p.id||!p.name||!p.repositoryId){return}GENTICS.Utils.applyProperties(this,properties);this.baseType="document"};GENTICS.Aloha.Repository.Folder=function(properties){var p=properties;this.type="folder";if(!p.id||!p.name||!p.repositoryId){return}GENTICS.Utils.applyProperties(this,properties);this.baseType="folder"};